<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Wang Peiyi" />

<meta name="date" content="2024-12-06" />

<title>Introduction to homework</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to homework</h1>
<h4 class="author">Wang Peiyi</h4>
<h4 class="date">2024-12-06</h4>



<div id="a-sc24002027-2024-09-09" class="section level1">
<h1>A-SC24002027-2024-09-09</h1>
<div id="question" class="section level2">
<h2>Question</h2>
<p>Use knitr to produce at least 3 examples. For each example, texts
should mix with figures and/or tables. Better to have mathematical
formulas.</p>
</div>
<div id="answer" class="section level2">
<h2>Answer</h2>
<div id="example-1" class="section level3">
<h3>Example 1</h3>
<p>使用R语言进行线性回归分析的一个例子。</p>
<p>Choosing to execute and show R code.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>ctl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.17</span>,<span class="fl">5.58</span>,<span class="fl">5.18</span>,<span class="fl">6.11</span>,<span class="fl">4.50</span>,<span class="fl">4.61</span>,<span class="fl">5.17</span>,<span class="fl">4.53</span>,<span class="fl">5.33</span>,<span class="fl">5.14</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>trt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.81</span>,<span class="fl">4.17</span>,<span class="fl">4.41</span>,<span class="fl">3.59</span>,<span class="fl">5.87</span>,<span class="fl">3.83</span>,<span class="fl">6.03</span>,<span class="fl">4.89</span>,<span class="fl">4.32</span>,<span class="fl">4.69</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Ctl&quot;</span>,<span class="st">&quot;Trt&quot;</span>)) <span class="co">#创建了一个包含20个元素的因子，其中前10个元素标记为&quot;Ctl&quot;，后10个元素标记为&quot;Trt&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">c</span>(ctl, trt)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>lm.D9 <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> group)<span class="co">#进行线性回归分析</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">summary</span>(lm.D9)<span class="sc">$</span>coef</span></code></pre></div>
<pre><code>##             Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept)    5.032  0.2202177 22.85012 9.547128e-15
## groupTrt      -0.371  0.3114349 -1.19126 2.490232e-01</code></pre>
<p>The <span class="math inline">\(R^2\)</span> is 0.0730776.</p>
<p>Choosing to execute but not show R code.</p>
<pre><code>##             Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept)    5.032  0.2202177 22.85012 9.547128e-15
## groupTrt      -0.371  0.3114349 -1.19126 2.490232e-01</code></pre>
<p>Choosing to show but not execute R code.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>ctl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.17</span>,<span class="fl">5.58</span>,<span class="fl">5.18</span>,<span class="fl">6.11</span>,<span class="fl">4.50</span>,<span class="fl">4.61</span>,<span class="fl">5.17</span>,<span class="fl">4.53</span>,<span class="fl">5.33</span>,<span class="fl">5.14</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>trt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.81</span>,<span class="fl">4.17</span>,<span class="fl">4.41</span>,<span class="fl">3.59</span>,<span class="fl">5.87</span>,<span class="fl">3.83</span>,<span class="fl">6.03</span>,<span class="fl">4.89</span>,<span class="fl">4.32</span>,<span class="fl">4.69</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Ctl&quot;</span>,<span class="st">&quot;Trt&quot;</span>))</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">c</span>(ctl, trt)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>lm.D9 <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> group)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="fu">summary</span>(lm.D9)<span class="sc">$</span>coef</span></code></pre></div>
</div>
<div id="example-2" class="section level3">
<h3>Example 2</h3>
<p>获取iris数据集的前六行数据转换为一个LaTeX格式的表格，将所得结果放进latex后得到表格。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">library</span>(xtable)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>xtable<span class="sc">::</span><span class="fu">xtable</span>(<span class="fu">head</span>(iris))</span></code></pre></div>
<pre><code>## % latex table generated in R 4.4.2 by xtable 1.8-4 package
## % Sat Dec  7 10:38:25 2024
## \begin{table}[ht]
## \centering
## \begin{tabular}{rrrrrl}
##   \hline
##  &amp; Sepal.Length &amp; Sepal.Width &amp; Petal.Length &amp; Petal.Width &amp; Species \\ 
##   \hline
## 1 &amp; 5.10 &amp; 3.50 &amp; 1.40 &amp; 0.20 &amp; setosa \\ 
##   2 &amp; 4.90 &amp; 3.00 &amp; 1.40 &amp; 0.20 &amp; setosa \\ 
##   3 &amp; 4.70 &amp; 3.20 &amp; 1.30 &amp; 0.20 &amp; setosa \\ 
##   4 &amp; 4.60 &amp; 3.10 &amp; 1.50 &amp; 0.20 &amp; setosa \\ 
##   5 &amp; 5.00 &amp; 3.60 &amp; 1.40 &amp; 0.20 &amp; setosa \\ 
##   6 &amp; 5.40 &amp; 3.90 &amp; 1.70 &amp; 0.40 &amp; setosa \\ 
##    \hline
## \end{tabular}
## \end{table}</code></pre>
</div>
<div id="example-3" class="section level3">
<h3>Example 3</h3>
<p>绘制example 1的线性模型的图。</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))<span class="co">#图形参数设置</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">plot</span>(lm.D9)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkAAAAGACAMAAAByRC0tAAAA0lBMVEUAAAAAACgAADoAAEkAAGYAOjoAOpAAZmYAZrYoAAA6AAA6ACg6ADo6AGY6OgA6OmY6OpA6ZmY6ZrY6kJA6kLY6kNtJOpBRDShmAABmADpmAGZmOgBmOjpmOpBmZmZmkJBmtrZmtv9/f3+B//+QOgCQOjqQOmaQZpCQkDqQkGaQkLaQnWaQtpCQ27aQ2/+2ZgC2Zjq2tma225C2/7a2//++vr7bkDrbtmbbtrbb25Db/7bb/9vb///fU2v/tmb/trb/25D//5z//7b//7z//9v///8pBKU/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAgAElEQVR4nO2dC3vctrGGWVV1VVVpfJpsKztNmrVlt05TMReJPUlkdrtd/v+/VAzu4PIyAAgusJr3sSUtFwQJ8ONgAAzBqiOICKpTnwBRNiQgIgoSEBEFCYiIggREREECIqIgARFRkICIKEhARBQkICIKEhARBQmIiIIERERBAiKiIAERUZCAiChIQEQUJCAiChIQEQUJiIiCBEREQQIioiABIWkvH5rq4v7Up5EdJCAch7vt/nbbvng69YnkBgkIx/7VPbNBu08eTn0iuUECwsEsUPPiqSEL1IcEhKRlDtDuhnygPiQgIgoSEBEFCQjB/raSXJIT3YMERERBAiKiIAEhaagJG4QEhEMMQ9ebU59HdpCAcOxf3e9f00j0MSQgHIe77eHdPQnoCBIQkt3NfVtV1IT1IQERUZCAiChIQDjkYDR14/uQgHyot6c+g+wgAflAvbAjSEA+tNSE9SEB4ZA+EDVhfUhARBQkICKKtAI63Ik4rKEB3P2tag/agcetzLej1DLIa8vTtvK/y1DW/qwYUNaygzjn7GxIWp9hpBbQFfxqp32HUAHZj0hA+oF9lhEQ0EBJUs/GH+5AobvrzciGpPUZxioCkr/GKEFA+1eQUepufCMs3O56O7whaX2GsYqAxLVupO3dXfPujCgS23jx4eKef+A/atHXgb9lwk5VIKsYs8kSEEvLtzPYJnUYlfWSJanTPhe2v5WWpr4a3rBUfS7IehaoYdcSbDEXQys9l5rdYfDElS5wLVNyUWyVtVaX7yezyRWQsUDqMDrrxYrCan/yxo9HP3emxpv6G5aqzwVZRUANv0HgbmEVoSpH3BNQnNoUmLcUsBUiAC2PFUw5y8EZyBsUkD6MzjppAZdFtz3qj/6GxepzOdbphW1VFbCy7G9FQaCMokytbXJ5v4MXWCXUiSGZVQm1ytsWkD6MzjppAZcFIaCF6nM5VrBAu2u4bVrV6Ra1IC53c1Rg1oZf/iDuGJWQw0wxWBxn05AF0odpFhQQxLOuMRuPa8IWqc/FWKMJa8HXcy+ltLJHdwy3wdLkqoT8d3v5o+pHqE3DArpwqrwsC2R85hdP3EW2N8Cv5epzMVbxgWrhxVlfcIuq2uwGCrwxDU9bmQKb31+pu1/XxbAPJA+js05awIUBC3K4Y32FzfCG5epzMVYR0P4WutdwLVnR+a2jbhLYCL0GVklPzMJuxc3C7jBw+mRCkVUNXSBnU09AG3EDq8PorBcqyjorlNVcMJUZLXA3LFifS7HOOFADRreRPoQcnHfGLfhswdeizb64VwbZHsUX/U97kyMgJrAXT7UaB+LGauFxoHVWKGv7UybOhgXrcylQAuKdwXZkDuZ5sPIKZd/1r/PRhlxAC6gF7TfPVkG0QtkIWkBTbTwTEKvA7lmHdNIKZcMoAU228SQgYgwloMk2HsYweThDk3gyiCgOywJNtfHMqWfNW+LJ6KyBvvRPZICPMD5QaBtfFQ22lIe7TRvmRJ+6hHHMF8+7QoZzwF+KrECfNTTxL55CfMAiK0ZdzqUFZFegI9JK5rR//SDW8iqkv+9pgULa8FIEZF+6StuF2d3EZY8JGq9ULhW0g3LE9G+FOEv4q8unskN8wEIEZF86dTmXt0BjOVRg86ru8M1/fv+WB+qUMoe5wtXNTkBgavQ1Um3V4ZvDey4gGPJeX0DK5rXVr952h3f/KKa37+MD+WaN9kPXhZuawztRnMpUgRAQn3DwbsKA4FVIHQv03z+/7fZ/+V3q4OEIxGwM3klUBC/MkZGAoOyHb6rqgV2ja7hGtpURApJzbv5O9OQqpJM+ku0DdSCg9td/empyfYicB2P53GGS8IjEfAQky354X/HIM3aNjgS0/9L18jwENL0KaT1uUpxeGAio2/2xazPthe1e/mvj18ZHk42AVNmZUvg5tXZ3SwqIXToHvIBmViFlvdjpHKTNg7OAE8vUArF7pH2uAtJlBwHpazTjonn4QN6rkA46iVzGdbbDQAHjHNHkIiBddmjCkNfozZvZJEuNRBdDG+hEB5NR/bhln4GLZ72pjGJwvbPnKKA53liWx6cXVn4vI4DnJaBZQDhOq+VrgUIGO0qqII1fExY91VMCg/6Or4Cey2xzgBMdvD5QJvUz7vm8mXCWfQUU8vx9JhXkQ0A3fnJ9oEELlddURjVY1qMma2C3+Yw5/quQ5lVBXsiZl84rnGNyfaC5gdZTM1BYRBd9zV5YWToKaMKm1weaHWg9MT0BocTj7hKeApXDsIXMlQALFHOwk1LpOwX+mPJ3BvfGpVggoExdkSJ4FgJyQ0W7atbfGcwEnyKql1GaMxTWhIU9lbFOtUi5mJ+VKWXlZ3WcbNEpwlchFQIqygsKcqKDn8rw3sMzf0cu6p8sXQVNVsQZ+MzGh65CWmQT5vzAkOVTGZUrl97PN9BsRTqnHk1Y8CqkBVqggCYsx6cyqmPRyJ9vQDy2rCIOEZ1idE/J42PXPT6q34v///j4+DHFf30MJPk9lWHbUavxAn9H3dTLHCMyBSqHqvqYiOjzmz/5RFmnHmjVBkbKRXfRFzwkthsfswppgT6QodRuvO05V4gpieDjLJACk0NpPpB/QNn+FvzDXJzoymqlgrvoyANFp8DkUNw4kDpbDwGBdc5AQKrN6pKLRx0EmWJ6FVK5KvzQOGOBAnKe6cfBWvmm2p5UQKbZqrynJIKPiU4xvQqp6r4OTToX2ISZ0/URULe7/s3KAlJ20pIOHxh8s4r31nmORE+sUKae6x1bnaMwJzpQQPL1b74H897DCEd1UdRYoexlrXe3elmg8RXKBgXk5BA54LkyAU1YxMGCdqk6XbPc2akqMb6zckX7+EBTK5SppmtoJNayssXg70RHHCtsD+0riy66ls66Fb1YL6yZdqILs0C+3fi5cbLZtQM8T079EHNZp5GOdSqRKTA5rNUcLIXW+1LnvGxIKz893mSd2rx7CCgq3qUwAVXujwUYCGlFTWU438oPa3XRMfg40Zh4l3EnuqRhIG8BJXsuzGn5q4RTEqH4deMj4l3KElBIE5biuTBHw8hn0dfF1wL5xLu440Cog+WD/1zYfMTmyCp4GAGpEIzs6tDPBwqPd8my8BjQ54yI2JwU0LCBrt6IbrpKmF0VrtULy7LwGPAnPR+xOSWggfrh/s6QE50T3gL6d+g4R4aFx7DSQGLfQmfTy5oDKyBQCH+971gvI/dHd0Px9IFCD2GcnYLEAyAFBA387ua+Dnt0t2jQVRm+zK/kDcxnnbKoQcwXD37w26sOGeSYzTpZ8tTZ9wgP+fU/uk/iZBljExsBLf4+0LMSUCTPQkBzg2S+bgAJKPDoJCCvMwhMvraAgl8F4X/0AgWEmut51gKafBXEwkcvT0BpOC8BTb8KYtGjk4CCss5bQDOvglj06CSgoKzzFpD/qyDCj04CIp4PJCAiChIQgqiIxDOHBIQkOCLxzCEB4QhfQ/LMIQHhCF9D8swhASEJXkPyzCEBEVGQgIgoSEBIWurGD0ICwrG/zfNF5icniYBUb1fctbNjJ7pzvLseX2RvJP1st4ilUYmYHxxsQcKD6tVJeAgQO1rgWSCPQQj8CScRUG0VC/ESRJUc7vIGUSMm/UaM703RmgT11dTTJTPMHmgCKFiLuTVUcqQs/AqEztbrhFMIqLWWEkSYfp0c7hDEne6X3gwe82UOQ0cCo4LqYenJwx3WBDXV/+HO0q9A6Gw7rxNOIKDD+x/Mmc6H6pvkcMpjy3wOpccI6PBOf4/UZyLwTtT/Y9e48CsQOlsJ8oQTCKjZmDNFyNhKDmsUzQ71mvS8yZtpqvev/qD8qtMKyOehlyQC8p2IQZ7w8gLaf2lJff6creTcp5lrJOzsmav3+YxCYdnH/esHdS7hAooLqkf5dpocBIQ94eUFVG+tM513Pa3kOJ9m61QEpgJlmigBBQfVN3wCpMF5pCJxDgJCnnACAbnvD5+tcTs5pkL6ryfHVIrMM86Jjgqq97I/6CvtWyCPtPgTTjoOhPTkVXJ4AB9z5rrJYxU4142FUYTdS73OfnA3PiqofnT55LH0yMN4Fgh/9h4nnE5AYHxwBlYn9xlIhPQtYkmsRjgu/GxuI6YiYoLqa9dqzh8LeaU9C4QXkMcJ01QGEQUJiIiCBISDQlpHIAFhgLlFDoW09iEB4TjdEHbmkICIKEhAKOBxjIaC6gcgAWGAiUUYkgwPJzpbSEAIeEwIiId6YUeQgBCAB80XOiYBHUECQsBnLWF6aD7c7dlBAsLAmi9wgyBgiXAhAWE43MEsbxu8QNkZQwIioiABEVGQgIgoSEBEFCQgIgoSEBEFCYiIggREREECIqI4oYBknOh2eIZyIATwPKcyZTVcfIso3VEN2E95T8fbspRJ6u+UAjLlgT97xXs2AupkweZKN/i9XsoLnqcbfShTpiIBkYBGNsqlWMbi3c5cQLtPfrytLv55C/OV8lnLtqp+q5+jOdxtW75Gs7TC/BF6nQ6/8Fe+SAF9zx8GlUUTT+nuPv3i8oFv2UP98OKL1ed0lUAGMsykvdQVpL7+e1Vt1K5JKu7kPpCjC3iWvnnxxBf+4QWEDbuXP4sV10xClY6J7BxCdISArq9AAVYVgB6ut6pSZNHhC/lLVAlkIBdBMRWkvr7eWKpKUnFZWCAtILk+B5RNNmGsasTbgNlnk1CmO5elU4WAbu6toqlfYqPawv5b111u7AYEpL42eYpfy1dcZgICo3Rx3xgB7V7+8u6eb7ctkEzHF3s5Aw1pH8gUTa5SaFWK/F4tHKarBD4cN2Hma1dAi1dcZgIy9aGc6O++ffnElxnrWyAJYhXY7HEEZBxeY3bUFmOBTJXAJ7Ao+9cP9ZXOxXx9ZIEkC1VcJgK6EUHH3OURLbhaIgvCAPkTNfx+kisBy3Swy7kJyKoCaVCswiof6ObeVAnPoeUBk9y08Aqyvja7mtwXrLg8BHS4q7bwv+MdBm6fP5MWCBY4hDflfC7seVNVn71+UOnOqxemO5iyCi7kAmRiC9SP6YVZVSKykKOysoKsr2X1ml7YshVHUxnnxL/Xt8YkICIKEhARBQmIiIIERERBAiKiIAERUZCAiChIQEQUJCAiChIQEQUJiIiCBEREQQIioiABEVGQgIgoSEBEFCQgIgoSEBEFCYiIggREREECIqIgARFRkICIKEhARBQkICIKEhARBQmIiIIERERBAiKiIAERUZCAiChIQEQUJCAiChIQEQUJiIiiIgURMYCAKotTnw9RGCQZIgotoPbyoTmLRZeJVVECOtxt97fbc3j1DbEqSkDwjpzLNC9FJM4ZywI1L54askCEH8YHgrcD3ZAPNAb5iMNQLwwH+YgjkIBwkI84AhcQvL9OcAYv30oD+YgjkAVCksZHhPd6VdOqbIdeTak21idXNAnolMDrGDt4teB4ksH34+qNGQmooSZsdeCl3h2YoQkZlCIg0cWoN6c9m0xJ5SMql4q/aLBl2W/gWF+LNyrzl1hu4SdLVfPXWaov5cbOFlDDdxeShDeoNjK7Vx/gpOX+Hfxx8QEsnvz+cHcVVwZrJHr/mnoZq+JcvJa/MfaK/Yerz/wtkALbyI1NzRI2/JW64stjCwTf7q43Iku2VX5me0AKtX9XMzHxl/Oq76OxRqIP7+5JQGuyvzUX8HAHf7egjQ1v29RLlfkbvV/di/ZOfXkkIJEVDHZewot1N/oz/0PvLwxULY+yyIubtQ8Er5LmRo0YJIGPaAtIXFqlDfZjf3upXwkPtBU3UerLnoBa7ofL3dkH57PZXyjG/j66ENQLw5HCR7SbMHEtlTbgB+/hS80w9V7+cD0lIOmjbaG1Yhv1Z5FS7d9oAen0sZCAcCTxERt9+bdHFoh/UQt3h3+5mxSQHgloL38URkie963clf/oWaAlML0w6sZPkcRHtLrxlg9kCUhqhV/3dqoJM539/e1X3A3aduYLvb84oO2FR+NaoHqpbM+PJD5iK3rSYA5ML0xohNsI6VQL41NtLAHJE3F6YWJEsq6urM/aAvH93V7Y9AgmEldA1AtbGW74hQj0OJC0QPBZCIJ1yuHP2jJPtRoHEq7MRjj5ooESjo38rH0gvj/f4fJ7SCe/X2wcSLBEv47InUWvcs8HoiZshPPwEbkPZI8exEO9MB+K9xHbxa0ECcgH8hGPoIAyH8hHPMKEc/BZOJrKGIF8xBGs2fiOTDThjZmNl3EAJz0bojh0E8bn7iIHlebg7cCgG3E8tI7QcrsdjtdbnFgfkddtNTyObUowND+FKF89Pi86GE49X7NelbpmL0yMkQ6On4cIaB3xKGJ8RDnc2067UKECGq2okZ3LFVDNq3Fw8Dx7AUX5iLLIM9MGBQsIYhXSj7Q69dfIBlMH+251mK7AFLNVm919eGDwz7ys/XDiZCcf6COqkvPdVSlFzLM1WfXBnoq36kUm7DoT8Ww2OeekI595TcnIaVU5Ijja2WEsjto56AzrNmFaQSLAd2MF+257Ybq6mGqaenAfEa3QCydOcvIxPqJtgVQp3ZhnOUluJktNGVXCzqj4J7PJ1oOOfJY11asclQ4RR20fdIZVR6JB1vwuUNMxVrDvthemq4rpBgv39pGhe71w4hVLhEMKqKm2JnjZjnm2QpVluIZVRnvwUkY8O+OZWg9u5HTXDVSOs8NEHPUWP2K69gpl7EbmOjdXWQX79sJ0VTF1qN7QPlb194P5ckL1wrZO8LKJedaBgnYJVBlVQp0YklnXt7Y7YW2lw8a6gcoROyDiqJ0jTHKCFcqYvdbPCFvBvr0wXVdAYFUH9rHqyA4nXppYH5FboN01mCFTSivmuTkSkF1GmZAjIp7dTbZLw3dSNXVcOc4Ok3HU9hEmWXGFMnVjtPKhp84K1tUWqFOu3agFcgKES7FAQjubfldLtlpHFsgNgu7M2IeIeHY2aQHpnbwskMnVjaO2jjDJiiuUqb6Ielqp65xg396VH/WBnADhXjOftYD4BXFPTxbbClW2HgrTQdCdHST9lTKC+jLr3obZadAH6gtoOo66Q1blmiuUtTwOk9+I4PCzanWCfd0w3eFemLvPpt8LSyigGB9RCoh3hFQpTczzVhQNLoAIrxfPaKh6UQlFVjzi2dnkWCAR+SxrigvJqRx3h4k4avegU6zaC+OOhDgrOabjBPs2tpNhon3740A6wLc+GgdKJ6AoH1HZ3sYOXpYxz844EK+hr4UPpOul1ZXWqa61vcnxgWTks6yp2h4HMgLCxFE7B52CAspw0AplI9iTqS9+ovoZg1YoG8E40ZuWKmgCWsV2GLsb/+KJTDThiWuBKKCM8MQNKIvWz/71g1gI5eyCq8lHHCa+F1YVDbaU4T6iPNBjmvNPlK3OF1E88VsETIVQ8f8sn6o7fPOf378V6/AV4m2iBRTuI8pDPHrviMIjWy9bIfPFCyj8ocuqU+89hK7Kr952h3f/SBxbvRyeFijERzylgGyPovJ6Qa63gPxnm7W1038zC/TfP7/t9n/5Xero/Aga7p2pYuOrNNhHPKGAWnk9D397EqeBL66/BQrGElDXgYDaX//pqclvRlMglvbWd+MK4/CnE5DjUUgvwzPf9QQkcwIBdbs/dm2mvbDdy39tOutu9PGBPA9lW+juVBbI8igSN2EzmAm44xy6zsj78P6BiydTC8R8gjZMQHE+Yhfk7TaIu3DaAlkexWktkHIe6wHfRl0I/hsEBGrL1ABph1IZBrwFCo5I9BaQqssWU4vT2VoexUl9IG2/h7qxFT6fHOCNq7+AwvE9hLrSorWNw/Yo/Jow+2SmUwQLyGnjg87uJIQ2YcEECki2tnE4HkXIPY4U0Oyz36rpGhoHqbr1LsZCZC0geTMuMiEU7VF4WKDpZ7+bOScadbBsyLsbr64JxgIl6twFDCQGP/tdWBMm8B9IDD+U+BVwpYsSUPiz34U50S5ZCwhDNgLCPfs96kSXhp8FilofKLwJw5CPgIIp0QIFdOOnfMRBgQWPRHu5A+cioLJ8ID3z4juVMeojDo2wqoOJX+gr7Xde+QgoOOKuwF6YGdZHn/OMjygeAB05GMdDQD5zDtkIKCLiTvz/OIl3rkkJsEDh6wNl04SlDSibjLibdCJRTdi0vNaWnjOCnppcLJCflxFogUZN9EAb7zqJyZzoFNILaMLCyURAyWfjpyPu5tr4HJ3oaXn59sKifMTu9E2Y55DL2gFluINlg383Ps5H7DKwQJXXxV5dQF728dQETKau91RGom586iaMr8DzXObCAgS04lMZqZqwtBaIdbRYDytUQIVZoJDZeO+nMvQjeuxasP+P8jfif/Xx8fEj9j8yT55vhU/7qP+eLab4zUx0U219BOQ81tN1RZmgMmbjMTz69EtTduNhqH53/ZvgJqywSdX1BXRqwhoJPwExMx0621yYgPybsEgf0W+PFFXp6QOpvVD5xlFgExYwkBjnI/rtkORmDAu9IQENEjYb7+kj6oOJX4lG/PIYSIxaib3EbnyQgGJ8xGT97Wy68f6sNBeWgpAmLM5HzEBAWT8bXxoB40AxxwJO3YQlnY1fIOa3KAuU9zhQiK+CyxefNsACBb8TtEAfyIA76SAfMTgmOlFQfUoL1M3H/J7Xg4WaLC1Qmrkw61zw+eIFNB3zO7c6Bwlo9hCnn433yXbh58LOaXEFF2QTtuZzYYkE5Dk+Scu74MCfdZyPePomLLWAppdwm1udo1j8xoFGfUQw35uR7zNxopM3YdNLuM2szlEs6JOf8RGvxHfLCMiHbAQUvYRbmeBPft5HHHmfWCYCSt2ND+eZCGgK2f63g49t5CKg1AOJKM5mdQ6Fpw80Rq1eabnE4gpeZPNos/RyQpqwokEXc9JH1C9FHXpyV3D2L1vhb5QN6aaOZ500eerse4T7iAEkMupJsrW68fvX4y+VnZjKGM/a80z8kq8sIAThLzzqU6KADnfbw7v7MQFNTWWMZ+15Jn7JSUB5ZKtbud3NfTtmYiZHosez9jwTv+RrC2jeR3zmApqCBJTCRxzn7AQ0OZUxnrXnmfglX1tA0z7ishQnoPnZ5ompjPGsPc/EL/nKApr2ERemOAEBwbPN41knTb62DzTlIy5NiQIKX6meGAXeFfjh4n7/6gOY9laYcOZN8R+7m2+vtSLVSGR5xK9UT4xRc9UwAd1CtbbVlj8grQV0zTbAxrLxW6n+mRIWkbi7BnHUIKCNWiSwhU9KQLAhZM2zrCh7LnRF/H3ElqtNSUbIif00AtqKr5Oc7mqQgHAE+IjNgIDYn8YHuu/OSUDtipOFBRLgI85ZoPMSEC8WMY6/jygk00gBWT7Qhn8nfKDiuy24oHoiBNML496O7IUd7l48MTUyATHjc0a9sIZ6YItTM5/g+8sHad3lOBDv030NTvRfryuln/LHgVYNmCqRUB+xHdtFtHDFQ70wHAE+IlcI93jGvy6fJAJSvd0WNwOrO8e76wrTKbHTz/qgLI1KxDyPYAsb4iPy4o+qZFBAcLayMVtsWgnyZCTq7sUH1Q9QW9mMmvDj5HCXD4Wlj6ffzLturUlQX/mFVDqs4iNCZYE7BOJZcl7S3HKLT3amCKpvraUEEaZfJ4fSIe50v/SmSHyZw9AKXMVHFJW1u7kvUUDLBUwd3v9gspmf6zHJD3fbrvVIjxHQ4Z3+HqnPE9Jq08oanMUFtPv0iwQtGS6o3otmY7IBTeCTwzu5ZsfVTHre5M0MpOxf/UHVWQECUqVPYoHA6UpngZYLmNp/ab0Vaf6EreTcp5lrJOzsmXv4+YxCYcKAmVZ1LuECWtJHHCOxgG4imvBRlu+F1bbO511PKznOp3FvI4wiZJooAa0SVK87HGkEtHCmgsUFJL1NaRdma9xOjrnCbvY4r1DmGedErxFUL5xomGgtT0CLhrRaTg1msEwlh/lGTDdeN3nsnOf65XBT717qxyKDu/HrBNU3zF2DubKlWxsjoJulfUAhIDnW5PdGtXH4+YLxwbUYOrnPQCKkbxEn3AjHhZ/NbYQPs05QfSum/PlkawoBQcaL5cqh2XgiCpoLI6KQAoK4poaC6sehx55GEAKC8WJwN8Onis6bhX3Ec4ILiI/3g3joDhuDfMQR1AvnRMwuCYjwRAuIjxDMT2U+U8hHHEP4QKz5AjdoPHzumUM+4ihCQIe7ij8iQPoZhHzEcWgcCAH5iOOQgBCQjziOeEew4dTnkyfkI45CksFAPuIoZHWIKEA9JCIiGKUccoCIIGzRkIYIb7RiSDxECNXRHwThQTXwF0GgIdkQUZCAiChOKCAZJzry/MpACOCZTGWqcs8nHC2v/XD3cJCSfCJvMItF6/GUAjLlGHho8owFNFiMga3zAlLrCR0z9kjn4nVIAlqd5QSk1xM6TvGcBLT75Mfb6uKfsCaOeni0rarf6udoWF2IBzbZB6U0k668hbr1NZSPoUIztOVLAslHc3effsGfoDWrlrDCypoQBZffmNXfxI6Hu79eV1fsb1hM+Ct4jpZX2d/5E7X8aHrlIXkk811oPZ7cB3J0AfdN8+KJL/zDSwQbdi9/Zp9bXnCZUKVjIisvREeVey9KBb9kyfgWphW5eqKUiSjsL7wmfhEFVwJSZZc7wmP18GogZpPEn+BfwoLmrVhruL1Qa5/pI4nvIuoxCwukBSTX54DCyCasueoaHkTBPpuEMl2Zy+v3VqeRV84qvmqTZEK5ldeEStETkNwMUpP/eRNWX0FdmYUa5J6mAuV3MfWYmYCu+SJsjREQu+necdNe2RZIpuOLvRSnIacLJQort4Ig2JW310uSyaD0UBPq714TJnfsC6i56tWttkDWkaRHEFqPmQnI3FnKif7u25d8tZMjCyRBrAKbGbrcolQDFqgnIPmR14SzyVlPaMgCbawq03VoW6BPBvwpPzIR0I0IOuYujzCpjfTqIAyQP1HD7x65ErBMB7uUKyBZKu4D3fDWRHkmroBkYXlNqILLFEIr8e8AAAC8SURBVGo9Ie0DWQJirtD11ghI1aFptOSRIusxDwHBsjV86RrRGQFz+5m0QLDAIbwp53NhcJuq+uz1g0pXdC9Mlkr0wsTKPapvJCvmWqzTLgvLl3qUvbVeR073wiwBmV6Y7Hfwo6mVh8yRhDZL7IUR5wAJiIiCBEREQQIioiABEVGQgIgoSEBEFCQgIgoSEBEFCYiIggREREECIqIgARFRkICIKEhARBQkICIKEhARBQmIiIIERERBAiKi+B+R+KTjZhtQiQAAAABJRU5ErkJggg==" /><!-- --></p>
</div>
<div id="mathematical-formulas" class="section level3">
<h3>Mathematical formulas</h3>
<p><span class="math display">\[
\begin{align*}
\bigtriangledown \times H=J+\frac{\partial D}{\partial t} \\
\bigtriangledown \times E=-\frac{\partial B}{\partial t} \\
\bigtriangledown \cdot B=0 \\
\bigtriangledown \cdot D=\rho
\end{align*}
\]</span></p>
</div>
</div>
</div>
<div id="a-sc24002027-2024-09-14" class="section level1">
<h1>A-SC24002027-2024-09-14</h1>
<div id="question-1" class="section level2">
<h2>Question 1</h2>
<p>3.4</p>
<p>The Rayleigh density is <span class="math display">\[
f(x) = \frac { x } { \sigma ^ {2} }e ^ {- x ^ {2} / ( 2 \sigma ^ {2} )}
, \quad x \ge 0\quad  \sigma &gt; 0
\]</span> Develop an algorithm to generate random samples from a
Rayleigh ( <span class="math inline">\(\sigma\)</span> ) distribution.
Generate Rayleigh ( <span class="math inline">\(\sigma\)</span> )
samples for several choices of <span class="math inline">\(\sigma\)</span> &gt; 0 and check that the mode of
the generated samples is close to the theoretical mode <span class="math inline">\(\sigma\)</span> (check the histogram).</p>
</div>
<div id="answer-1" class="section level2">
<h2>Answer</h2>
<p>考虑到瑞利分布分布函数(CDF)的逆函数容易得到，使用逆变换法来获得瑞利分布的随机数。
<span class="math display">\[
\int f(x) dx = \int \frac { x } { \sigma ^ {2} }e ^ {- x ^ {2} / ( 2
\sigma ^ {2} )} dx\\
= - e ^ { - x ^ { 2 } / 2 \sigma ^ { 2 } } + C
\]</span> 则瑞利分布的分布函数(CDF)为: <span class="math display">\[
F(x) = 1 - e ^ { - x ^ { 2 } / 2 \sigma ^ { 2 } }
\]</span> 其逆函数为: <span class="math display">\[
X = \sigma \sqrt{-2ln(1-u)}
\]</span> 接下来使用代码生成瑞利分布随机数:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># 设置参数</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">2</span> </span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">10000</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co"># 生成瑞利分布样本</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n) <span class="co"># 生成均匀分布的随机数</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>x <span class="ot">&lt;-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> u)) <span class="co"># 逆函数</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co"># 画出直方图和理论sigma线</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="fu">hist</span>(x, <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">ylab =</span> <span class="st">&quot;y&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">main =</span> <span class="st">&quot;瑞利分布随机数直方图&quot;</span>) </span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> sigma, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>可以看出理论值接近估计值。</p>
</div>
<div id="question-2" class="section level2">
<h2>Question 2</h2>
<p>3.11</p>
<p>Generate a random sample of size 1000 from a normal location mixture.
The components of the mixture have N (0, 1) and N (3, 1) distributions
with mixing probabilities p1 and <span class="math inline">\(p_2\)</span> = 1 − <span class="math inline">\(p_1\)</span>. Graph the histogram of the sample
with density superimposed, for <span class="math inline">\(p_1\)</span>
= 0.75. Repeat with different values for p1 and observe whether the
empirical distribution of the mixture appears to be bimodal. Make a
conjecture about the values of p1 that produce bimodal mixtures.</p>
</div>
<div id="answer-2" class="section level2">
<h2>Answer</h2>
<p>对于生成混合正态分布，考虑使用rbinom函数来生随机成概率概率为<span class="math inline">\(p_1\)</span>的二项分布来判别样本来自哪个正态分布，再使用rnorm函数生成正态分布并绘制直方图和密度函数。</p>
<p>接下来使用r语言绘制<span class="math inline">\(p_1=0.75\)</span>时的直方图和密度曲线。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># 设置参数</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co"># 生成混合正态分布样本</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, p1) <span class="co"># 生成概率为0.75的二项分布来决定样本是来自哪个正态分布的</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>sample <span class="ot">&lt;-</span> x <span class="sc">*</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> x) <span class="sc">*</span> <span class="fu">rnorm</span>(n, <span class="dv">3</span>, <span class="dv">1</span>) <span class="co"># 利用二项分布生成混合正态分布</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co"># 绘制直方图和密度曲线</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="fu">hist</span>(sample, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">probability =</span> <span class="cn">TRUE</span>,  <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;p1 =&quot;</span>, p1), <span class="at">xlab =</span> <span class="st">&quot;Sample Value&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Density&quot;</span>)</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(sample), <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>接下来测试不同概率下的直方图和密度曲线</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># 测试不同概率下的直方图和密度曲线</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="at">by =</span> <span class="fl">0.2</span>)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="cf">for</span> (p1 <span class="cf">in</span> p){</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  </span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co"># 生成混合正态分布样本</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, p1) <span class="co"># 生成概率为0.75的二项分布来决定样本是来自哪个正态分布的</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>sample <span class="ot">&lt;-</span> x <span class="sc">*</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> x) <span class="sc">*</span> <span class="fu">rnorm</span>(n, <span class="dv">3</span>, <span class="dv">1</span>) <span class="co"># 利用二项分布生成混合正态分布</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co"># 绘制直方图和密度曲线</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="fu">hist</span>(sample, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">probability =</span> <span class="cn">TRUE</span>,  <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;p1 =&quot;</span>, p1), <span class="at">xlab =</span> <span class="st">&quot;Sample Value&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Density&quot;</span>)</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(sample), <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>可以看出当<span class="math inline">\(p_1\)</span>=0.2,
0.4时图像较为明显地显示为双峰分布，猜想当<span class="math inline">\(p_1\)</span>越接近0.5时，图像越能明显的显现出双峰分布。</p>
</div>
<div id="question-3" class="section level2">
<h2>Question 3</h2>
<p>3.20</p>
<p>A compound Poisson process is a stochastic process {<span class="math inline">\(X(t), t \geq 0\)</span>} that can be represented
as the random sum <span class="math inline">\(X(t) = \sum_{i=1}^{N(t)}
Y_i, \quad t \geq 0\)</span> where {<span class="math inline">\(X(t), t
\geq 0\)</span>} is a Poisson process and <span class="math inline">\(Y_1\)</span>, <span class="math inline">\(Y_2\)</span>, . . . are iid and independent of
{<span class="math inline">\(X(t), t \geq 0\)</span>}. Write a program
to simulate a compound Poisson(λ)–Gamma process (Y has a Gamma
distribution). Estimate the mean and the variance of X(10) for several
choices of the parameters and compare with the theoretical values. Hint:
Show that <span class="math inline">\(E[X(t)] = λtE[Y_1]\)</span> and
<span class="math inline">\(Var(X(t)) = λtE[Y_1^2]\)</span>.</p>
</div>
<div id="answer-3" class="section level2">
<h2>Answer</h2>
<p>首先我们来给出泊松—伽马过程的理论均值和方差的表达式。 定义<span class="math inline">\(X(t) = \sum_{i=1}^{N(t)} Y_i, \quad t \geq
0\)</span>为泊松—伽马过程，由于 <span class="math inline">\(Y_i\)</span>
是独立同分布的且与 <span class="math inline">\(N(t)\)</span>
独立,我们得到： <span class="math display">\[
E[X(t)] = E\left[\sum_{i=1}^{N(t)} Y_i\right]\\
=E[N(t)] \cdot E[Y_1]\\
=\lambda t \cdot E[Y_1]
\]</span> <span class="math display">\[
Var(X(t)) = Var\left(\sum_{i=1}^{N(t)} Y_i\right)\\
= E[N(t)] \cdot Var(Y_1) + Var(N(t)) \cdot (E[Y_1])^2\\
= \lambda t \cdot Var(Y_1) + \lambda t \cdot (E[Y_1])^2
\]</span> 再由<span class="math inline">\(Var(Y_1) = E[Y_1^2] -
(E[Y_1])^2\)</span>得到: <span class="math display">\[
Var(X(t)) = \lambda t \cdot (E[Y_1^2] - (E[Y_1])^2) + \lambda t \cdot
(E[Y_1])^2\\
=\lambda t \cdot E[Y_1^2]
\]</span> 综上所述， <span class="math display">\[
E[X(t)] = \lambda t \cdot E[Y_1]\\
Var(X(t)) = \lambda t \cdot E[Y_1^2]
\]</span> 接下来计算<span class="math inline">\(E(Y_1^2)\)</span>:
我们知到 <span class="math display">\[
Var(Y_1) = \frac{\alpha}{\beta^2}
\]</span> 而 <span class="math display">\[
E(Y_1) = \frac{\alpha}{\beta}
\]</span> 再由方差和期望的公式得到 <span class="math display">\[
\frac{\alpha}{\beta^2} = E(Y_1^2) - \left(\frac{\alpha}{\beta}\right)^2
\]</span> 解得: <span class="math display">\[
E(Y_1^2)=\frac{\alpha (\alpha + 1)}{\beta^2}
\]</span></p>
<p>可知理论结果可以由伽马分布的均值和二阶矩得到。</p>
<p>接下来我们使用r语言模拟泊松—伽马过程。</p>
<p>步骤大致为:
用for循环设置3组不同的参数，再用function定义模拟复合泊松—伽马过程，再经过模拟求得不同参数下的结果。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)  <span class="co"># 设置随机数种子</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>lambda_p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>alpha_p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>beta_p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>) <span class="co"># 设置三组参数</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co"># 分别计算三组参数下的结果</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co"># 定义参数</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> lambda_p[i]  <span class="co"># 泊松过程的参数</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> alpha_p[i]   <span class="co"># 伽马分布的形状参数</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>beta <span class="ot">&lt;-</span> beta_p[i]   <span class="co"># 伽马分布的尺度参数</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">10</span>      <span class="co"># 时间</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># 模拟次数</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co"># 模拟复合泊松-伽马过程</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>poisson_gamma <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, alpha, beta, t, n_sim) {</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>  X_t <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)  <span class="co"># 初始化X(t)的存储向量</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>    N_t <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">1</span>, lambda <span class="sc">*</span> t)  <span class="co"># 模拟泊松过程N(t)</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>    Y_i <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(N_t, alpha, beta)  <span class="co"># 模拟伽马分布随机变量</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>    X_t[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(Y_i)  <span class="co"># 计算X(t)</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>  }</span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>  <span class="fu">return</span>(X_t)</span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>}</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a><span class="co"># 模拟过程并计算均值和方差</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>X_10 <span class="ot">&lt;-</span> <span class="fu">poisson_gamma</span>(lambda, alpha, beta, t, n)</span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a>s_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(X_10)</span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a>s_var <span class="ot">&lt;-</span> <span class="fu">var</span>(X_10)</span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a><span class="co"># 计算理论均值和方差</span></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a>E_Y1 <span class="ot">&lt;-</span> alpha <span class="sc">/</span> beta  <span class="co"># 伽马分布的均值</span></span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a>E_Y1_2 <span class="ot">&lt;-</span> (alpha<span class="sc">*</span>(alpha<span class="sc">+</span><span class="dv">1</span>)) <span class="sc">/</span> beta<span class="sc">^</span><span class="dv">2</span> <span class="co"># 伽马分布随机变量Y_1的二阶矩</span></span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a>t_mean <span class="ot">&lt;-</span> lambda <span class="sc">*</span> t <span class="sc">*</span> E_Y1</span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a>t_var <span class="ot">&lt;-</span> lambda <span class="sc">*</span> t <span class="sc">*</span> E_Y1_2</span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;参数设置为lambda=&quot;</span>,lambda_p[i],<span class="st">&quot;alpha=&quot;</span>, alpha_p[i], <span class="st">&quot;beta=&quot;</span>, beta_p[i], <span class="st">&quot;的结果&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;模拟得到的X(10)的均值:&quot;</span>, s_mean, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;模拟得到的X(10)的方差:&quot;</span>, s_var, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb11-42"><a href="#cb11-42" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;理论得到的X(10)的均值:&quot;</span>, t_mean, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb11-43"><a href="#cb11-43" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;理论得到的X(10)的方差:&quot;</span>, t_var, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb11-44"><a href="#cb11-44" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## 参数设置为lambda= 3 alpha= 2 beta= 1 的结果 
## 模拟得到的X(10)的均值: 59.95586 
## 模拟得到的X(10)的方差: 181.183 
## 理论得到的X(10)的均值: 60 
## 理论得到的X(10)的方差: 180 
## 参数设置为lambda= 5 alpha= 4 beta= 3 的结果 
## 模拟得到的X(10)的均值: 66.76788 
## 模拟得到的X(10)的方差: 112.2937 
## 理论得到的X(10)的均值: 66.66667 
## 理论得到的X(10)的方差: 111.1111 
## 参数设置为lambda= 7 alpha= 6 beta= 5 的结果 
## 模拟得到的X(10)的均值: 84.10536 
## 模拟得到的X(10)的方差: 118.2692 
## 理论得到的X(10)的均值: 84 
## 理论得到的X(10)的方差: 117.6</code></pre>
<p>易知，模拟结果接近理论计算值。</p>
</div>
</div>
<div id="a-sc24002027-2024-09-23" class="section level1">
<h1>A-SC24002027-2024-09-23</h1>
<div id="question-1-1" class="section level2">
<h2>Question 1</h2>
<p>For n = <span class="math inline">\(10^4\)</span>, 2 × <span class="math inline">\(10^4\)</span>, 4 × <span class="math inline">\(10^4\)</span>, 6 × <span class="math inline">\(10^4\)</span>, 8 × <span class="math inline">\(10^4\)</span>, apply the fast sorting algorithm to
randomly permuted numbers of 1, … , n. 2. Calculate computation time
averaged over 100 simulations, denoted by an. 3. Regress an on <span class="math inline">\(t_n\)</span> := nlog(n), and graphically show the
results (scatter plot and regression line).</p>
</div>
<div id="answer-4" class="section level2">
<h2>Answer</h2>
<p>先定义快速排序函数，再分别将n的值带入函数计算100次并得到平均时间，最后将时间进行线性回归。</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co"># 定义快速排序函数</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>quick_sort <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  num <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  <span class="cf">if</span> (num <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> num <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>    <span class="fu">return</span>(x)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    a <span class="ot">&lt;-</span> x[<span class="dv">1</span>]</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    y <span class="ot">&lt;-</span> x[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    lower <span class="ot">&lt;-</span> y[y <span class="sc">&lt;</span> a]</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    upper <span class="ot">&lt;-</span> y[y <span class="sc">&gt;=</span> a]</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">quick_sort</span>(lower), a, <span class="fu">quick_sort</span>(upper)))</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>  }</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>}</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co"># 生成数据</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co"># 定义n的取值</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>n_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1e4</span>, <span class="fl">2e4</span>, <span class="fl">4e4</span>, <span class="fl">6e4</span>, <span class="fl">8e4</span>)</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="co"># 初始化存储计算时间的向量</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>a_n <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(n_values))</span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="co"># 进行100次模拟并计算平均时间</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(n_values)) {</span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a>  n <span class="ot">&lt;-</span> n_values[i]</span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a>  times <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">100</span>)</span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a>    test <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a>    times[j] <span class="ot">&lt;-</span> <span class="fu">system.time</span>(<span class="fu">quick_sort</span>(test))[<span class="dv">1</span>]</span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a>  }</span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a>  a_n[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(times)</span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a>}</span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;平均时间分别为&quot;</span>,a_n)</span></code></pre></div>
<pre><code>## 平均时间分别为 0.016 0.0322 0.0713 0.1113 0.141</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># 计算tn = n * log(n)</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>t_n <span class="ot">&lt;-</span> n_values <span class="sc">*</span> <span class="fu">log</span>(n_values)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co"># 线性回归</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(a_n <span class="sc">~</span> t_n)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co"># 绘图</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="fu">plot</span>(t_n, a_n, <span class="at">main =</span> <span class="st">&quot;log(n)对应的平均时间&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;n log(n)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;平均时间 (a_n)&quot;</span>, <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="fu">abline</span>(model, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="question-2-1" class="section level2">
<h2>Question 2</h2>
<p>5.4</p>
<p>Write a function to compute a Monte Carlo estimate of the Beta(3, 3)
cdf, and use the function to estimate F (x) for x = 0.1, 0.2,…, 0.9.
Compare the estimates with the values returned by the pbeta function in
R.</p>
</div>
<div id="answer-5" class="section level2">
<h2>Answer</h2>
<p>先用用function定义一个函数使用蒙特卡洛法估计Beta(3,3)的累积分布函数，再定义x的值并使用这些值计算对应的蒙特卡洛法估计的值和函数pbeta对应的值。</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#生成数据</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co"># 定义蒙特卡洛法估计Beta(3, 3)的累积分布函数函数</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>mc_beta_cdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">n_sim =</span> <span class="dv">10000</span>) {</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(n_sim, <span class="dv">3</span>, <span class="dv">3</span>) <span class="co"># 生成Beta(3, 3)分布</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>  cdf_estimates <span class="ot">&lt;-</span> <span class="fu">sapply</span>(x, <span class="cf">function</span>(q) <span class="fu">mean</span>(samples <span class="sc">&lt;=</span> q)) <span class="co"># 生成Beta(3, 3)分布的累积分布函数</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>  <span class="fu">return</span>(cdf_estimates)</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>}</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co"># 定义x的取值</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>x_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co"># 计算蒙特卡洛估计的CDF值</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>mc_estimates <span class="ot">&lt;-</span> <span class="fu">mc_beta_cdf</span>(x_values)</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co"># 使用pbeta函数计算真实的CDF值</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>pbeta_values <span class="ot">&lt;-</span> <span class="fu">pbeta</span>(x_values, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x_values, <span class="at">MonteCarlo =</span> mc_estimates, <span class="at">Pbeta =</span> pbeta_values)</span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="fu">print</span>(results)</span></code></pre></div>
<pre><code>##     x MonteCarlo   Pbeta
## 1 0.1     0.0070 0.00856
## 2 0.2     0.0556 0.05792
## 3 0.3     0.1669 0.16308
## 4 0.4     0.3217 0.31744
## 5 0.5     0.5037 0.50000
## 6 0.6     0.6883 0.68256
## 7 0.7     0.8385 0.83692
## 8 0.8     0.9424 0.94208
## 9 0.9     0.9920 0.99144</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># 绘制比较图</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">plot</span>(x_values, mc_estimates, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">pch =</span> <span class="dv">1</span>, </span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;CDF&quot;</span>, <span class="at">main =</span> <span class="st">&quot;蒙特卡洛估计和pbeta函数得到的CDF&quot;</span>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="fu">lines</span>(x_values, pbeta_values, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">2</span>)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;蒙特卡洛估计&quot;</span>, <span class="st">&quot;pbeta函数&quot;</span>), </span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="question-3-1" class="section level2">
<h2>Question 3</h2>
<p>5.9</p>
<p>The Rayleigh density is <span class="math display">\[
f(x) = \frac { x } { \sigma ^ {2} }e ^ {- x ^ {2} / ( 2 \sigma ^ {2} )}
, \quad x \ge 0\quad  \sigma &gt; 0
\]</span> Implement a function to generate samples from a Rayleigh(σ)
distribution, using antithetic variables. What is the percent reduction
in variance of <span class="math inline">\(\frac
{X+X&#39;}{2}\)</span>compared with <span class="math inline">\(\frac
{X_1+X_2}{2}\)</span> for independent <span class="math inline">\(X_1\)</span>, <span class="math inline">\(X_2\)</span> ?</p>
</div>
<div id="answer-6" class="section level2">
<h2>Answer</h2>
<p>先用均匀分布分别定义生成简单估计量瑞利分布样本的函数和对偶估变量的瑞利分布样本函数，再分别计算<span class="math inline">\(\frac {X_1+X_2}{2}\)</span>和<span class="math inline">\(\frac {X+X&#39;}{2}\)</span>的样本均值和方差。</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>) <span class="co"># 种子</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co"># 生成数据</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co"># 瑞利分布</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>generate_rayleigh <span class="ot">&lt;-</span> <span class="cf">function</span>(sigma, n, <span class="at">antithetic =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n <span class="sc">/</span> <span class="dv">2</span>) <span class="co"># 生成 n/2 个均匀随机数 u</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  <span class="cf">if</span> (antithetic) { <span class="co">#生成对偶变量</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>    v <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> u</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>    v <span class="ot">&lt;-</span> <span class="fu">runif</span>(n <span class="sc">/</span> <span class="dv">2</span>) <span class="co"># 正常生成瑞利分布</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>  }</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">c</span>(u, v)</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>  rayleigh_samples <span class="ot">&lt;-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(u))</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>  <span class="fu">return</span>(rayleigh_samples)</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>}</span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a><span class="co"># 使用对偶变量生成样本</span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a>samples_antithetic <span class="ot">&lt;-</span> <span class="fu">replicate</span>(m, <span class="fu">mean</span>(<span class="fu">generate_rayleigh</span>(sigma, n, <span class="at">antithetic =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="co"># 使用独立变量生成样本</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>samples_independent <span class="ot">&lt;-</span> <span class="fu">replicate</span>(m, <span class="fu">mean</span>(<span class="fu">generate_rayleigh</span>(sigma, n, <span class="at">antithetic =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a><span class="co"># 计算方差</span></span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>var_antithetic <span class="ot">&lt;-</span> <span class="fu">var</span>(samples_antithetic)</span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a>var_independent <span class="ot">&lt;-</span> <span class="fu">var</span>(samples_independent)</span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a><span class="co"># 计算方差减少百分比</span></span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a>percent_reduction <span class="ot">&lt;-</span> (var_independent <span class="sc">-</span> var_antithetic) <span class="sc">/</span> var_independent <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a><span class="co">#输出结果</span></span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;方差减少百分比为：&quot;</span>, percent_reduction, <span class="st">&quot;%</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 方差减少百分比为： 94.95674 %</code></pre>
</div>
<div id="quwstion-4" class="section level2">
<h2>Quwstion 4</h2>
<p>5.13</p>
<p>Find two importance functions f1 and f2 that are supported on (1,
<span class="math inline">\(\infty\)</span>) and are ‘close’ to <span class="math display">\[
g(x)=\frac { x ^ 2 } { \sqrt {2\pi} }e ^ {- x ^ {2} /  2 } dx
\]</span> Which of your two importance functions should produce the
smaller variance in estimating <span class="math display">\[
\int_{1}^{\infty} \frac { x ^ 2 } { \sqrt {2\pi} }e ^ {- x ^ {2} /  2 }
dx
\]</span> by importance sampling? Explain.</p>
</div>
<div id="answer-7" class="section level2">
<h2>Answer</h2>
<p>对于给定的函数g(x)，根据重要抽样的原理 <span class="math display">\[
\theta =\int g(x) dx=\int \frac {g(x)} {f(x)} f(x)dx=E( \frac {g(x)}
{f(x)})=\frac {1} {m} \sum_{i=1}^{m}\frac {g(X_i)} {f(X_i)}
\]</span>
考虑到正态分布N(1,1)的概率密度函数与g(x)较为接近，以及指数分布e(1)的长尾特性，我们选择这两个分布的密度函数作为f(x),分别计算它们的权重后求期望得到结果。</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co"># 生成数据</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co"># 定义给定的函数 g(x)</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>  (x<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>}</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co"># 定义两个重要性函数 f1 和 f2</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>  <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="dv">1</span>)  <span class="co"># 正态分布，均值为2，标准差为1</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>}</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>  <span class="fu">dexp</span>(x <span class="sc">-</span> <span class="dv">1</span>, <span class="at">rate =</span> <span class="dv">1</span>)  <span class="co"># 指数分布，移位参数为1</span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>}</span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a><span class="co"># 计算积分的真实值</span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a>true_value <span class="ot">&lt;-</span> <span class="fu">integrate</span>(g, <span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="cn">Inf</span>)<span class="sc">$</span>value</span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a><span class="co"># 重要性抽样函数</span></span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a>importance_sampling <span class="ot">&lt;-</span> <span class="cf">function</span>(f, <span class="at">n =</span> <span class="dv">10000</span>) {</span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="at">rate =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># 生成样本</span></span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> <span class="fu">g</span>(samples) <span class="sc">/</span> <span class="fu">f</span>(samples)  <span class="co"># 计算权重</span></span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a>  estimate <span class="ot">&lt;-</span> <span class="fu">mean</span>(weights)  <span class="co"># 估计值</span></span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a>  variance <span class="ot">&lt;-</span> <span class="fu">var</span>(weights) <span class="sc">/</span> n  <span class="co"># 方差</span></span>
<span id="cb21-29"><a href="#cb21-29" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">estimate =</span> estimate, <span class="at">variance =</span> variance)</span>
<span id="cb21-30"><a href="#cb21-30" tabindex="-1"></a>}</span>
<span id="cb21-31"><a href="#cb21-31" tabindex="-1"></a></span>
<span id="cb21-32"><a href="#cb21-32" tabindex="-1"></a><span class="co"># 计算 f1 和 f2 的估计值和方差</span></span>
<span id="cb21-33"><a href="#cb21-33" tabindex="-1"></a>result_f1 <span class="ot">&lt;-</span> <span class="fu">importance_sampling</span>(f1)</span>
<span id="cb21-34"><a href="#cb21-34" tabindex="-1"></a>result_f2 <span class="ot">&lt;-</span> <span class="fu">importance_sampling</span>(f2)</span>
<span id="cb21-35"><a href="#cb21-35" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb21-37"><a href="#cb21-37" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;f1 的估计值:&quot;</span>, result_f1<span class="sc">$</span>estimate, <span class="st">&quot;方差:&quot;</span>, result_f1<span class="sc">$</span>variance, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## f1 的估计值: 0.7587088 方差: 1.951821e-06</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;f2 的估计值:&quot;</span>, result_f2<span class="sc">$</span>estimate, <span class="st">&quot;方差:&quot;</span>, result_f2<span class="sc">$</span>variance, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## f2 的估计值: 0.4005125 方差: 2.455116e-06</code></pre>
<p>可以看到，使用正态分布N(1,1)得到的方差更小。 下面解释原因。
首先我们画出g(x)和N(1,1)、e(1)的概率密度图像。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co"># 定义正态分布 N(1, 1) 的概率密度函数</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> (x <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>}</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co"># 定义指数分布 e(1) 的概率密度函数</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>  <span class="fu">ifelse</span>(x <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="fu">exp</span>(<span class="sc">-</span>(x <span class="sc">-</span> <span class="dv">1</span>)), <span class="dv">0</span>)</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>}</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a><span class="co"># 定义函数 g(x)</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>  (x<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>}</span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a><span class="co"># 创建数据用于绘图</span></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>x_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">1000</span>)</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>f1_values <span class="ot">&lt;-</span> <span class="fu">f1</span>(x_values)</span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>f2_values <span class="ot">&lt;-</span> <span class="fu">f2</span>(x_values)</span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>g_values <span class="ot">&lt;-</span> <span class="fu">g</span>(x_values)</span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a><span class="co"># 绘制对比图</span></span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a><span class="fu">plot</span>(x_values, f1_values, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), </span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Density&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">main =</span> <span class="st">&quot;正态分布 N(1, 1)、指数分布 e(1) 和函数 g(x) 的对比图 (x ≥ 1)&quot;</span>)</span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a><span class="fu">lines</span>(x_values, f2_values, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a><span class="fu">lines</span>(x_values, g_values, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;f1: N(1, 1)&quot;</span>, <span class="st">&quot;f2: e(1)&quot;</span>, <span class="st">&quot;g(x)&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>我们发现正态分布N(1,1)的图像最接近g(x)，可以认为正态分布密度函数组的权重波动较小更均匀，所以方差更小。</p>
</div>
</div>
<div id="a-sc24002027-2024-09-30" class="section level1">
<h1>A-SC24002027-2024-09-30</h1>
<div id="question-1-2" class="section level2">
<h2>Question 1</h2>
<p>If we obtain the powers for two methods under a particular simulation
setting with 10,000 experiments: say, 0.651 for one method and 0.676 for
another method. We want to know if the powers are different at 0.05
level.</p>
<ol style="list-style-type: decimal">
<li><p>What is the corresponding hypothesis test problem?</p></li>
<li><p>What test should we use? Z-test, two-sample t-test, paired-t test
or McNemar test? Why?</p></li>
<li><p>Please provide the least necessary information for hypothesis
testing.</p></li>
</ol>
</div>
<div id="answer-8" class="section level2">
<h2>Answer</h2>
<ol style="list-style-type: decimal">
<li><p>原假设(<span class="math inline">\(H_0\)</span>):
两种方法的统计功效相等。(<span class="math inline">\(P_1=P_2\)</span>)
备选假设(<span class="math inline">\(H_1\)</span>):
两种方法统计功效不同。(<span class="math inline">\(P_1\neq
P_2\)</span>)</p></li>
<li><p>适用的检验: 两样本比例的z检验。 原因:
样本量较大，且对比量为比例。两样本t检验和配对t检验适合比较均值，McNemar检验通常在前后研究设计中使用，不适合这里。</p></li>
<li><p>必要的信息:
(1)两个样本的统计功效值。(2)样本大小。(3)显著性水平。</p></li>
</ol>
</div>
<div id="question-2-2" class="section level2">
<h2>Question 2</h2>
<p>6.6</p>
<p>Estimate the 0.025, 0.05, 0.95, and 0.975 quantiles of the skewness
<span class="math inline">\(\sqrt {b_1}\)</span> under normality by a
Monte Carlo experiment. Compute the standard error of the estimates from
(2.14) using the normal approximation for the density (with exact
variance formula). Compare the estimated quantiles with the quantiles of
the large sample approximation <span class="math inline">\(\sqrt
{b_1}\)</span> ≈ N (0, 6/n).</p>
<p>其中(2.14)为: <span class="math display">\[
\mathrm{Var}(\hat{x}_{q}) = \frac{q(1 - q)}{nf(x_{q})^{2}}
\]</span> where f is the density of the sampled distribution.</p>
<p>思路：生成偏度的蒙特卡洛样本计算偏度，再使用quantile函数根据偏度计算分位数，再通过公式（2.14）以及标准误差公式<span class="math inline">\(se=\frac {sd}{\sqrt
{n}}\)</span>计算分位数的标准误差。</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co"># 数据生成</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="co"># 参数设置</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># 样本大小</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>num_simulations <span class="ot">&lt;-</span> <span class="dv">100000</span>  <span class="co"># 模拟次数</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a><span class="co"># 生成偏度的Monte Carlo样本</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>skewness_samples <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_simulations)</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_simulations) {</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>  sample <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>  skewness_samples[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((sample <span class="sc">-</span> <span class="fu">mean</span>(sample))<span class="sc">^</span><span class="dv">3</span>) <span class="sc">/</span> <span class="fu">sd</span>(sample)<span class="sc">^</span><span class="dv">3</span> <span class="co"># 计算偏度</span></span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>}</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a><span class="co"># 计算分位数</span></span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(skewness_samples, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.975</span>))</span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a><span class="co"># 计算标准误差</span></span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a>q_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.975</span>)</span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a>standard_errors <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(q_values))</span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(q_values)) {</span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>  f_q <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(<span class="fu">qnorm</span>(q_values[i]))</span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a>  standard_errors[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(q_values[i] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> q_values[i]) <span class="sc">/</span> (n <span class="sc">*</span> f_q<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">sqrt</span>(n) <span class="co"># 计算偏度标准误差</span></span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a>}</span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a><span class="co"># 大数近似下的分位数</span></span>
<span id="cb26-29"><a href="#cb26-29" tabindex="-1"></a>large_sample_quantiles <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(q_values, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">6</span><span class="sc">/</span>n))</span>
<span id="cb26-30"><a href="#cb26-30" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb26-32"><a href="#cb26-32" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Monte Carlo估计的分位数:</span><span class="sc">\n</span><span class="st">&quot;</span>,quantiles,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,<span class="st">&quot;标准误差:&quot;</span>,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,standard_errors,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,<span class="st">&quot;大样本近似的分位数:&quot;</span>,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,large_sample_quantiles)</span></code></pre></div>
<pre><code>## Monte Carlo估计的分位数:
##  -0.1503208 -0.1263732 0.1269625 0.1510232 
##  标准误差: 
##  0.002671311 0.002113188 0.002113188 0.002671311 
##  大样本近似的分位数: 
##  -0.1518182 -0.1274098 0.1274098 0.1518182</code></pre>
<p>对比可知，根据蒙特卡洛实验估计出的正态分布下偏度的分位数与根据大样本近似方法得到的分位数基本一致。</p>
</div>
<div id="question-3-2" class="section level2">
<h2>Question 3</h2>
<p>6.B</p>
<p>Tests for association based on Pearson product moment correlation
<span class="math inline">\(\rho\)</span>, Spearman’s rank correlation
coefficient <span class="math inline">\(\rho_s\)</span>, or Kendall’s
coefficient <span class="math inline">\(\tau\)</span>, are implemented
in cor.test. Show (empirically) that the nonparametric tests based on
<span class="math inline">\(\rho_s\)</span> or <span class="math inline">\(\tau\)</span> are less powerful than the
correlation test when the sampled distribution is bivariate normal. Find
an example of an alternative (a bivariate distribution (X, Y ) such that
X and Y are dependent) such that at least one of the nonparametric tests
have better empirical power than the correlation test against this
alternative.</p>
</div>
<div id="answer-9" class="section level2">
<h2>Answer</h2>
<p>思路:
生成数据后，使用三个变量来储存拒绝的次数，通过cor.test计算出三个检验方法的相关系数，通过if函数来判定模拟实验中的拒绝次数并记录在变量中，再通过总样本数计算出拒绝率，借此判断三者的功效。</p>
<p>首先先模拟实验对比双变量正态分布下的功效。</p>
<p>借助MASS库生成双变量正态分布。</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="co"># 数据生成</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="co"># 设置参数</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>num_simulations <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a><span class="co"># 存储拒绝次数</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>pearson_rejections <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a>spearman_rejections <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a>kendall_rejections <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a><span class="co"># 进行模拟实验</span></span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_simulations) {</span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>  data_normal <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n, mu, Sigma)</span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a>  </span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a>  pearson_test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(data_normal[,<span class="dv">1</span>], data_normal[,<span class="dv">2</span>], <span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a>  spearman_test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(data_normal[,<span class="dv">1</span>], data_normal[,<span class="dv">2</span>], <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb28-25"><a href="#cb28-25" tabindex="-1"></a>  kendall_test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(data_normal[,<span class="dv">1</span>], data_normal[,<span class="dv">2</span>], <span class="at">method =</span> <span class="st">&quot;kendall&quot;</span>) <span class="co"># 计算相关系数</span></span>
<span id="cb28-26"><a href="#cb28-26" tabindex="-1"></a>  </span>
<span id="cb28-27"><a href="#cb28-27" tabindex="-1"></a>  <span class="cf">if</span> (pearson_test<span class="sc">$</span>p.value <span class="sc">&lt;</span> alpha) pearson_rejections <span class="ot">&lt;-</span> pearson_rejections <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb28-28"><a href="#cb28-28" tabindex="-1"></a>  <span class="cf">if</span> (spearman_test<span class="sc">$</span>p.value <span class="sc">&lt;</span> alpha) spearman_rejections <span class="ot">&lt;-</span> spearman_rejections <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb28-29"><a href="#cb28-29" tabindex="-1"></a>  <span class="cf">if</span> (kendall_test<span class="sc">$</span>p.value <span class="sc">&lt;</span> alpha) kendall_rejections <span class="ot">&lt;-</span> kendall_rejections <span class="sc">+</span> <span class="dv">1</span> <span class="co"># 如果p值小于alpha，计入拒绝次数 </span></span>
<span id="cb28-30"><a href="#cb28-30" tabindex="-1"></a>}</span>
<span id="cb28-31"><a href="#cb28-31" tabindex="-1"></a></span>
<span id="cb28-32"><a href="#cb28-32" tabindex="-1"></a><span class="co"># 计算拒绝率</span></span>
<span id="cb28-33"><a href="#cb28-33" tabindex="-1"></a>pearson_power <span class="ot">&lt;-</span> pearson_rejections <span class="sc">/</span> num_simulations</span>
<span id="cb28-34"><a href="#cb28-34" tabindex="-1"></a>spearman_power <span class="ot">&lt;-</span> spearman_rejections <span class="sc">/</span> num_simulations</span>
<span id="cb28-35"><a href="#cb28-35" tabindex="-1"></a>kendall_power <span class="ot">&lt;-</span> kendall_rejections <span class="sc">/</span> num_simulations</span>
<span id="cb28-36"><a href="#cb28-36" tabindex="-1"></a></span>
<span id="cb28-37"><a href="#cb28-37" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb28-38"><a href="#cb28-38" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;双变量正态分布Pearson测试功效: &quot;</span>, pearson_power, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,<span class="st">&quot;双变量正态分布Spearman测试功效: &quot;</span>, spearman_power, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,<span class="st">&quot;双变量正态分布Kendall测试功效: &quot;</span>, kendall_power, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 双变量正态分布Pearson测试功效:  0.9997 
##  双变量正态分布Spearman测试功效:  0.9994 
##  双变量正态分布Kendall测试功效:  0.9994</code></pre>
<p>可以看出Pearson测试的功效高于Spearman和Kendall测试。
接下来我们生成相关的双变量分布来对比测试的功效。选择的分布为:X服从正态分布，Y是混合分布是X的线性变换与另一个服从对数正态分布的随机变量的和。</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co"># 存储结果</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>pearson_rejections2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>spearman_rejections2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>kendall_rejections2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="co"># 进行模拟实验</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_simulations) {</span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> X <span class="sc">+</span> <span class="fu">rlnorm</span>(n)  <span class="co"># 生成相关的双变量分布数据</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a>  </span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a>  pearson_test2 <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(X, Y, <span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>  spearman_test2 <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(X, Y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a>  kendall_test2 <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(X, Y, <span class="at">method =</span> <span class="st">&quot;kendall&quot;</span>) <span class="co"># 计算相关系数</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a>  </span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a>  <span class="cf">if</span> (pearson_test2<span class="sc">$</span>p.value <span class="sc">&lt;</span> alpha) pearson_rejections2 <span class="ot">&lt;-</span> pearson_rejections2 <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a>  <span class="cf">if</span> (spearman_test2<span class="sc">$</span>p.value <span class="sc">&lt;</span> alpha) spearman_rejections2 <span class="ot">&lt;-</span> spearman_rejections2 <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a>  <span class="cf">if</span> (kendall_test2<span class="sc">$</span>p.value <span class="sc">&lt;</span> alpha) kendall_rejections2 <span class="ot">&lt;-</span> kendall_rejections2 <span class="sc">+</span> <span class="dv">1</span> <span class="co"># # 如果p值小于alpha，计入拒绝次数</span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a>}</span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a><span class="co"># 计算拒绝率</span></span>
<span id="cb30-22"><a href="#cb30-22" tabindex="-1"></a>pearson_power2 <span class="ot">&lt;-</span> pearson_rejections2 <span class="sc">/</span> num_simulations</span>
<span id="cb30-23"><a href="#cb30-23" tabindex="-1"></a>spearman_power2 <span class="ot">&lt;-</span> spearman_rejections2 <span class="sc">/</span> num_simulations</span>
<span id="cb30-24"><a href="#cb30-24" tabindex="-1"></a>kendall_power2 <span class="ot">&lt;-</span> kendall_rejections2 <span class="sc">/</span> num_simulations</span>
<span id="cb30-25"><a href="#cb30-25" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb30-27"><a href="#cb30-27" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;相关的双变量分布Pearson测试功效: &quot;</span>, pearson_power2, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,<span class="st">&quot;相关的双变量分布Spearman测试功效: &quot;</span>, spearman_power2, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,<span class="st">&quot;相关的双变量分布Kendall测试功效: &quot;</span>, kendall_power2, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 相关的双变量分布Pearson测试功效:  0.9992 
##  相关的双变量分布Spearman测试功效:  1 
##  相关的双变量分布Kendall测试功效:  1</code></pre>
<p>可以看出Pearson测试的功效低于Spearman和Kendall测试。那么我们可以将所选择的分布作为备选方案。</p>
</div>
</div>
<div id="a-sc24002027-2024-10-14" class="section level1">
<h1>A-SC24002027-2024-10-14</h1>
<div id="question-1-3" class="section level2">
<h2>Question 1</h2>
<p>Of N = 1000 hypotheses, 950 are null and 50 are alternative. The
p-value under any null hypothesis is uniformly distributed (use runif),
and the p-value under any alternative hypothesis follows the beta
distribution with parameter 0.1 and 1 (use rbeta). Obtain Bonferroni
adjusted p-values and B-H adjusted p-values. Calculate FWER, FDR, and
TPR under nominal level α = 0.1 for each of the two adjustment methods
based on m = 10000 simulation replicates. You should output the 6
numbers (3) to a 3 × 2 table (column names: Bonferroni correction, B-H
correction; row names: FWER, FDR, TPR). Comment the results.</p>
</div>
<div id="answer-10" class="section level2">
<h2>Answer</h2>
<p>思路:
用runif和rbeta生成零假设和备择假设的p值，用p.adjust函数分别用两种方法来校正，我们得到校正后的p值后与α进行比较后得到被拒绝的所有假设，模拟10000次实验计算FWER、FDR和TPR，其中FWER是至少犯一个I型错误的概率，我们其进行计数并除以10000得到；FDR是在所有被拒绝的假设中错误拒绝的比例，我们计算前950个中被拒绝的假设的数量再除以所有被拒绝假设数量后得到；TPR是所有真实的备择假设中被正确识别的比例，我们计算后50个假设中被识别的数量除以50后得到。</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="co"># 数据生成</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="co"># 参数设置</span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a><span class="co"># 存储结果</span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>FWER_Bonferroni <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>FDR_Bonferroni <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>TPR_Bonferroni <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a>FWER_BH <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a>FDR_BH <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a>TPR_BH <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb32-19"><a href="#cb32-19" tabindex="-1"></a><span class="co"># 模拟过程</span></span>
<span id="cb32-20"><a href="#cb32-20" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb32-21"><a href="#cb32-21" tabindex="-1"></a>  </span>
<span id="cb32-22"><a href="#cb32-22" tabindex="-1"></a>  <span class="co"># 生成p值</span></span>
<span id="cb32-23"><a href="#cb32-23" tabindex="-1"></a>  null_p_values <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">950</span>)</span>
<span id="cb32-24"><a href="#cb32-24" tabindex="-1"></a>  alternative_p_values <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">50</span>, <span class="fl">0.1</span>, <span class="dv">1</span>)</span>
<span id="cb32-25"><a href="#cb32-25" tabindex="-1"></a>  p_values <span class="ot">&lt;-</span> <span class="fu">c</span>(null_p_values, alternative_p_values)</span>
<span id="cb32-26"><a href="#cb32-26" tabindex="-1"></a>  </span>
<span id="cb32-27"><a href="#cb32-27" tabindex="-1"></a>  <span class="co"># Bonferroni调整</span></span>
<span id="cb32-28"><a href="#cb32-28" tabindex="-1"></a>  bonferroni_p_values <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_values, <span class="at">method =</span> <span class="st">&quot;bonferroni&quot;</span>)</span>
<span id="cb32-29"><a href="#cb32-29" tabindex="-1"></a>  bonferroni_rejections <span class="ot">&lt;-</span> bonferroni_p_values <span class="sc">&lt;</span> alpha</span>
<span id="cb32-30"><a href="#cb32-30" tabindex="-1"></a>  </span>
<span id="cb32-31"><a href="#cb32-31" tabindex="-1"></a>  <span class="co"># 计算Bonferroni的FWER, FDR和TPR</span></span>
<span id="cb32-32"><a href="#cb32-32" tabindex="-1"></a>  FWER_Bonferroni <span class="ot">&lt;-</span> FWER_Bonferroni <span class="sc">+</span> (<span class="fu">sum</span>(bonferroni_rejections[<span class="dv">1</span><span class="sc">:</span><span class="dv">950</span>]) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">/</span> m</span>
<span id="cb32-33"><a href="#cb32-33" tabindex="-1"></a>  FDR_Bonferroni <span class="ot">&lt;-</span> FDR_Bonferroni <span class="sc">+</span> (<span class="fu">sum</span>(bonferroni_rejections[<span class="dv">1</span><span class="sc">:</span><span class="dv">950</span>]) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">sum</span>(bonferroni_rejections), <span class="dv">1</span>)) <span class="sc">/</span> m</span>
<span id="cb32-34"><a href="#cb32-34" tabindex="-1"></a>  TPR_Bonferroni <span class="ot">&lt;-</span> TPR_Bonferroni <span class="sc">+</span> (<span class="fu">sum</span>(bonferroni_rejections[<span class="dv">951</span><span class="sc">:</span><span class="dv">1000</span>]) <span class="sc">/</span> <span class="dv">50</span>) <span class="sc">/</span> m</span>
<span id="cb32-35"><a href="#cb32-35" tabindex="-1"></a>  </span>
<span id="cb32-36"><a href="#cb32-36" tabindex="-1"></a>  <span class="co"># Benjamini-Hochberg调整</span></span>
<span id="cb32-37"><a href="#cb32-37" tabindex="-1"></a>  bh_p_values <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_values, <span class="at">method =</span> <span class="st">&quot;BH&quot;</span>)</span>
<span id="cb32-38"><a href="#cb32-38" tabindex="-1"></a>  bh_rejections <span class="ot">&lt;-</span> bh_p_values <span class="sc">&lt;</span> alpha</span>
<span id="cb32-39"><a href="#cb32-39" tabindex="-1"></a>  </span>
<span id="cb32-40"><a href="#cb32-40" tabindex="-1"></a>  <span class="co"># 计算B-H的FWER, FDR和TPR</span></span>
<span id="cb32-41"><a href="#cb32-41" tabindex="-1"></a>  FWER_BH <span class="ot">&lt;-</span> FWER_BH <span class="sc">+</span> (<span class="fu">sum</span>(bh_rejections[<span class="dv">1</span><span class="sc">:</span><span class="dv">950</span>]) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">/</span> m</span>
<span id="cb32-42"><a href="#cb32-42" tabindex="-1"></a>  FDR_BH <span class="ot">&lt;-</span> FDR_BH <span class="sc">+</span> (<span class="fu">sum</span>(bh_rejections[<span class="dv">1</span><span class="sc">:</span><span class="dv">950</span>]) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">sum</span>(bh_rejections), <span class="dv">1</span>)) <span class="sc">/</span> m</span>
<span id="cb32-43"><a href="#cb32-43" tabindex="-1"></a>  TPR_BH <span class="ot">&lt;-</span> TPR_BH <span class="sc">+</span> (<span class="fu">sum</span>(bh_rejections[<span class="dv">951</span><span class="sc">:</span><span class="dv">1000</span>]) <span class="sc">/</span> <span class="dv">50</span>) <span class="sc">/</span> m</span>
<span id="cb32-44"><a href="#cb32-44" tabindex="-1"></a>}</span>
<span id="cb32-45"><a href="#cb32-45" tabindex="-1"></a></span>
<span id="cb32-46"><a href="#cb32-46" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb32-47"><a href="#cb32-47" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(FWER_Bonferroni, FDR_Bonferroni, TPR_Bonferroni,</span>
<span id="cb32-48"><a href="#cb32-48" tabindex="-1"></a>                   FWER_BH, FDR_BH, TPR_BH),</span>
<span id="cb32-49"><a href="#cb32-49" tabindex="-1"></a>                 <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb32-50"><a href="#cb32-50" tabindex="-1"></a>                 <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;FWER&quot;</span>, <span class="st">&quot;FDR&quot;</span>, <span class="st">&quot;TPR&quot;</span>), </span>
<span id="cb32-51"><a href="#cb32-51" tabindex="-1"></a>                                 <span class="fu">c</span>(<span class="st">&quot;Bonferroni correction&quot;</span>, <span class="st">&quot;B-H correction&quot;</span>)))</span>
<span id="cb32-52"><a href="#cb32-52" tabindex="-1"></a><span class="fu">print</span>(result)</span></code></pre></div>
<pre><code>##      Bonferroni correction B-H correction
## FWER           0.097600000     0.93040000
## FDR            0.004966883     0.09499023
## TPR            0.398672000     0.56290800</code></pre>
<p>结果分析 FWER:
Bonferroni方法通常比B-H方法更保守，因此在控制FWER方面更有效，因此Bonferroni方法更小，B-H方法更大。</p>
<p>FDR: B-H方法旨在控制FDR，通常比Bonferroni方法有更低的FDR。</p>
<p>TPR: B-H方法对多重比较的调整较少通常比Bonferroni方法有更高的TPR。</p>
</div>
<div id="question-2-3" class="section level2">
<h2>Question 2</h2>
<p>Refer to the air-conditioning data set aircondit provided in the boot
package. The 12 observations are the times in hours between failures of
airconditioning equipment [63, Example 1.1]:</p>
<p>3, 5, 7, 18, 43, 85, 91, 98, 100, 130, 230, 487.</p>
<p>Assume that the times between failures follow an exponential model
Exp(λ). Obtain the MLE of the hazard rate λ and use bootstrap to
estimate the bias and standard error of the estimate.</p>
</div>
<div id="answer-11" class="section level2">
<h2>Answer</h2>
<p>对于计算MLE: 对于指数分布，其概率密度函数为<span class="math inline">\(f(x; \lambda) = \lambda e^{-\lambda x}\)</span>,
其中<span class="math inline">\(\lambda\)</span>是速率参数。最大似然估计可以通过最大化似然函数来获得，对于指数分布，其对数似然函数为
<span class="math display">\[
\ell(\lambda) = n \ln(\lambda) - \lambda \sum_{i=1}^{n} x_i
\]</span> 其中n是样本大小，<span class="math inline">\(x_i\)</span>是观测值。对<span class="math inline">\(\lambda\)</span>求导并令导数为0，解得: <span class="math display">\[
\lambda = \frac{n}{\sum_{i=1} ^ {n}x_i}
\]</span> 对于用自举法估计偏差和标准误差:
对样本进行重抽样并计算每次重抽样的<span class="math inline">\(\lambda\)</span>估计值,最后计算估计偏差和标准误差。</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="fu">library</span> (boot)</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a><span class="co"># 生成数据</span></span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">18</span>, <span class="dv">43</span>, <span class="dv">85</span>, <span class="dv">91</span>, <span class="dv">98</span>, <span class="dv">100</span>, <span class="dv">130</span>, <span class="dv">230</span>, <span class="dv">487</span>)</span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a><span class="co"># 定义计算MLE的函数</span></span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a>lambda_mle <span class="ot">&lt;-</span> <span class="cf">function</span>(data, indices) {</span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>  d <span class="ot">&lt;-</span> data[indices]</span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">mean</span>(d))  <span class="co"># MLE for lambda</span></span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a>}</span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a><span class="co"># 设置自助法的参数</span></span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># 自助样本的数量</span></span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb34-19"><a href="#cb34-19" tabindex="-1"></a><span class="co"># 执行自助法</span></span>
<span id="cb34-20"><a href="#cb34-20" tabindex="-1"></a>boot_results <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data=</span>times, <span class="at">statistic=</span>lambda_mle, <span class="at">R=</span>R)</span>
<span id="cb34-21"><a href="#cb34-21" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" tabindex="-1"></a><span class="co"># 计算偏差和标准误差</span></span>
<span id="cb34-23"><a href="#cb34-23" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="fu">mean</span>(boot_results<span class="sc">$</span>t) <span class="sc">-</span> <span class="fu">lambda_mle</span>(times, <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(times)))</span>
<span id="cb34-24"><a href="#cb34-24" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sd</span>(boot_results<span class="sc">$</span>t)</span>
<span id="cb34-25"><a href="#cb34-25" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb34-27"><a href="#cb34-27" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;MLE:&quot;</span>, <span class="fu">lambda_mle</span>(times, <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(times))), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## MLE: 0.00925212</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Bias:&quot;</span>, bias, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Bias: 0.001526183</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Standard Error:&quot;</span>, se, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Standard Error: 0.004374413</code></pre>
</div>
<div id="question-3-3" class="section level2">
<h2>Question 3</h2>
<p>Refer to Exercise 7.4. Compute 95% bootstrap confidence intervals for
the mean time between failures 1/λ by the standard normal, basic,
percentile, and BCa methods. Compare the intervals and explain why they
may differ.</p>
</div>
</div>
<div id="answer-12" class="section level1">
<h1>Answer</h1>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="fu">library</span> (boot)</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a><span class="co"># 生成数据</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">18</span>, <span class="dv">43</span>, <span class="dv">85</span>, <span class="dv">91</span>, <span class="dv">98</span>, <span class="dv">100</span>, <span class="dv">130</span>, <span class="dv">230</span>, <span class="dv">487</span>)</span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a><span class="co"># 定义统计量函数，计算均值</span></span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a>mean_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(data, indices) {</span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(data[indices]))</span>
<span id="cb40-12"><a href="#cb40-12" tabindex="-1"></a>}</span>
<span id="cb40-13"><a href="#cb40-13" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" tabindex="-1"></a><span class="co"># 进行自助抽样</span></span>
<span id="cb40-15"><a href="#cb40-15" tabindex="-1"></a>boot_results <span class="ot">&lt;-</span> <span class="fu">boot</span>(data, <span class="at">statistic =</span> mean_fun, <span class="at">R =</span> <span class="dv">1000</span>)</span>
<span id="cb40-16"><a href="#cb40-16" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" tabindex="-1"></a><span class="co"># 计算95%置信区间</span></span>
<span id="cb40-18"><a href="#cb40-18" tabindex="-1"></a>ci_normal <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(boot_results, <span class="at">conf =</span> <span class="fl">0.95</span>, <span class="at">type =</span> <span class="st">&quot;norm&quot;</span>)</span>
<span id="cb40-19"><a href="#cb40-19" tabindex="-1"></a>ci_basic <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(boot_results, <span class="at">conf =</span> <span class="fl">0.95</span>, <span class="at">type =</span> <span class="st">&quot;basic&quot;</span>)</span>
<span id="cb40-20"><a href="#cb40-20" tabindex="-1"></a>ci_percentile <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(boot_results, <span class="at">conf =</span> <span class="fl">0.95</span>, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>)</span>
<span id="cb40-21"><a href="#cb40-21" tabindex="-1"></a>ci_bca <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(boot_results, <span class="at">conf =</span> <span class="fl">0.95</span>, <span class="at">type =</span> <span class="st">&quot;bca&quot;</span>)</span>
<span id="cb40-22"><a href="#cb40-22" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb40-24"><a href="#cb40-24" tabindex="-1"></a><span class="fu">print</span>(ci_normal)</span></code></pre></div>
<pre><code>## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 1000 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = boot_results, conf = 0.95, type = &quot;norm&quot;)
## 
## Intervals : 
## Level      Normal        
## 95%   ( 35.3, 184.2 )  
## Calculations and Intervals on Original Scale</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="fu">print</span>(ci_basic)</span></code></pre></div>
<pre><code>## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 1000 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = boot_results, conf = 0.95, type = &quot;basic&quot;)
## 
## Intervals : 
## Level      Basic         
## 95%   ( 21.7, 170.7 )  
## Calculations and Intervals on Original Scale</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="fu">print</span>(ci_percentile)</span></code></pre></div>
<pre><code>## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 1000 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = boot_results, conf = 0.95, type = &quot;perc&quot;)
## 
## Intervals : 
## Level     Percentile     
## 95%   ( 45.5, 194.5 )  
## Calculations and Intervals on Original Scale</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="fu">print</span>(ci_bca)</span></code></pre></div>
<pre><code>## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 1000 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = boot_results, conf = 0.95, type = &quot;bca&quot;)
## 
## Intervals : 
## Level       BCa          
## 95%   ( 57.4, 230.5 )  
## Calculations and Intervals on Original Scale
## Some BCa intervals may be unstable</code></pre>
<p>不同的原因: 标准正态方法:
假设了自助样本的统计量分布近似正态分布，使用标准正态分布的分位数来构建置信区间，适用于大样本的情况，当样本量较小或者统计量分布偏离正态分布时，这种方法可能不够准确。</p>
<p>基本方法:
不假设分布的形状，而是直接使用自助样本的分位数来构建置信区间，它通常比标准正态方法更保守，尤其是在样本量较小或分布偏斜时。基本方法不考虑统计量的偏差和加速，因此可能在某些情况下不够准确。</p>
<p>百分位数方法:
同样不假设分布的形状，通过选择自助样本的中间50%或其它百分位数来构建置信区间。这种方法简单直观，但可能不够精确，尤其是在样本量较小时。百分位数方法同样不考虑统计量的偏差和加速。</p>
<p>BCa方法:
这种方法是对百分位数方法的改进，它考虑了偏差（Bias）和加速（Acceleration）的校正。BCa方法在大多数情况下都是更可取的，因为它提供了更准确的置信区间，尤其是在样本量较小或分布偏斜时。BCa方法通过调整百分位数来校正偏差和加速，使得置信区间更加准确。</p>
</div>
<div id="a-sc24002027-2024-10-21" class="section level1">
<h1>A-SC24002027-2024-10-21</h1>
<div id="question-1-4" class="section level2">
<h2>Question 1</h2>
<p>7.8</p>
<p>Refer to Exercise 7.7. Obtain the jackknife estimates of bias and
standard error of <span class="math inline">\(\hat{\theta}\)</span>.</p>
</div>
<div id="answer-13" class="section level2">
<h2>Answer</h2>
<p>思路: 导入数据后定义函数计算协方差矩阵和特征值，再利用特征值求出<span class="math inline">\(\theta\)</span>，定义Jackknife抽样对于每个学生，我们从数据集中移除该学生的成绩，然后重新计算协方差矩阵和特征值，最后计算新的<span class="math inline">\(\hat{\theta}\)</span>，最后计算标准误差和偏差。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># 清理内存</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a><span class="co"># 加载数据</span></span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a><span class="fu">library</span>(bootstrap)</span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a><span class="fu">data</span>(scor)</span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a><span class="co"># 定义协方差矩阵和特征值的函数</span></span>
<span id="cb48-9"><a href="#cb48-9" tabindex="-1"></a>cov_eigen <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb48-10"><a href="#cb48-10" tabindex="-1"></a>  cov_mat <span class="ot">&lt;-</span> <span class="fu">cov</span>(data)</span>
<span id="cb48-11"><a href="#cb48-11" tabindex="-1"></a>  eigen_values <span class="ot">&lt;-</span> <span class="fu">eigen</span>(cov_mat)<span class="sc">$</span>values</span>
<span id="cb48-12"><a href="#cb48-12" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">cov =</span> cov_mat, <span class="at">eigen =</span> eigen_values))</span>
<span id="cb48-13"><a href="#cb48-13" tabindex="-1"></a>}</span>
<span id="cb48-14"><a href="#cb48-14" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" tabindex="-1"></a><span class="co"># 原始数据的协方差矩阵和特征值</span></span>
<span id="cb48-16"><a href="#cb48-16" tabindex="-1"></a>original_cov_eigen <span class="ot">&lt;-</span> <span class="fu">cov_eigen</span>(scor)</span>
<span id="cb48-17"><a href="#cb48-17" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" tabindex="-1"></a><span class="co"># 计算原始样本的 \(\hat{\theta}\)</span></span>
<span id="cb48-19"><a href="#cb48-19" tabindex="-1"></a>lambda1 <span class="ot">&lt;-</span> <span class="fu">max</span>(original_cov_eigen<span class="sc">$</span>eigen)</span>
<span id="cb48-20"><a href="#cb48-20" tabindex="-1"></a>sum_lambda <span class="ot">&lt;-</span> <span class="fu">sum</span>(original_cov_eigen<span class="sc">$</span>eigen)</span>
<span id="cb48-21"><a href="#cb48-21" tabindex="-1"></a>theta_hat <span class="ot">&lt;-</span> lambda1 <span class="sc">/</span> sum_lambda</span>
<span id="cb48-22"><a href="#cb48-22" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" tabindex="-1"></a><span class="co"># Jackknife函数</span></span>
<span id="cb48-24"><a href="#cb48-24" tabindex="-1"></a>jackknife_theta <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb48-25"><a href="#cb48-25" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb48-26"><a href="#cb48-26" tabindex="-1"></a>  theta_hats <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb48-27"><a href="#cb48-27" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb48-28"><a href="#cb48-28" tabindex="-1"></a>    data_minus_i <span class="ot">&lt;-</span> data[<span class="sc">-</span>i, ]</span>
<span id="cb48-29"><a href="#cb48-29" tabindex="-1"></a>    cov_eigen_data <span class="ot">&lt;-</span> <span class="fu">cov_eigen</span>(data_minus_i)</span>
<span id="cb48-30"><a href="#cb48-30" tabindex="-1"></a>    lambda1_jack <span class="ot">&lt;-</span> <span class="fu">max</span>(cov_eigen_data<span class="sc">$</span>eigen)</span>
<span id="cb48-31"><a href="#cb48-31" tabindex="-1"></a>    sum_lambda_jack <span class="ot">&lt;-</span> <span class="fu">sum</span>(cov_eigen_data<span class="sc">$</span>eigen)</span>
<span id="cb48-32"><a href="#cb48-32" tabindex="-1"></a>    theta_hats[i] <span class="ot">&lt;-</span> lambda1_jack <span class="sc">/</span> sum_lambda_jack</span>
<span id="cb48-33"><a href="#cb48-33" tabindex="-1"></a>  }</span>
<span id="cb48-34"><a href="#cb48-34" tabindex="-1"></a>  <span class="fu">return</span>(theta_hats)</span>
<span id="cb48-35"><a href="#cb48-35" tabindex="-1"></a>}</span>
<span id="cb48-36"><a href="#cb48-36" tabindex="-1"></a></span>
<span id="cb48-37"><a href="#cb48-37" tabindex="-1"></a><span class="co"># 执行Jackknife</span></span>
<span id="cb48-38"><a href="#cb48-38" tabindex="-1"></a>jackknife_results <span class="ot">&lt;-</span> <span class="fu">jackknife_theta</span>(scor)</span>
<span id="cb48-39"><a href="#cb48-39" tabindex="-1"></a></span>
<span id="cb48-40"><a href="#cb48-40" tabindex="-1"></a><span class="co"># 计算偏差和标准误差</span></span>
<span id="cb48-41"><a href="#cb48-41" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="fu">mean</span>(jackknife_results) <span class="sc">-</span> theta_hat</span>
<span id="cb48-42"><a href="#cb48-42" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sd</span>(jackknife_results)</span>
<span id="cb48-43"><a href="#cb48-43" tabindex="-1"></a></span>
<span id="cb48-44"><a href="#cb48-44" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb48-45"><a href="#cb48-45" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Jackknife Bias:&quot;</span>, bias, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Jackknife Bias: 1.228895e-05</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Jackknife Standard Error:&quot;</span>, se, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Jackknife Standard Error: 0.00534301</code></pre>
</div>
<div id="question-2-4" class="section level2">
<h2>Question 2</h2>
<p>7.10</p>
<p>In Example 7.18, leave-one-out (n-fold) cross validation was used to
select the best fitting model. Repeat the analysis replacing the Log-Log
model with a cubic polynomial model. Which of the four models is
selected by the cross validation procedure? Which model is selected
according to maximum adjusted <span class="math inline">\(R^2\)</span>?</p>
</div>
<div id="answer-14" class="section level2">
<h2>Answer</h2>
<p>思路:
根据例7.18中的代码，将原本的log-log拟合改为三次多项式拟合，并计算残差，再求出均方根误差找出最佳模型。对于最大调整<span class="math inline">\(R^2\)</span>，我们分别计算出每个模型的<span class="math inline">\(R^2\)</span>在做比较，得出最佳模型。</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># 清理内存</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a><span class="co"># 生成数据</span></span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a><span class="fu">library</span>(DAAG)</span></code></pre></div>
<pre><code>## 
## 载入程序包：&#39;DAAG&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:MASS&#39;:
## 
##     hills</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="fu">attach</span>(ironslag)</span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a><span class="co"># 获取磁性数据的长度</span></span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(magnetic)</span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a><span class="co"># 初始化残差向量</span></span>
<span id="cb55-5"><a href="#cb55-5" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> e2 <span class="ot">&lt;-</span> e3 <span class="ot">&lt;-</span> e4 <span class="ot">&lt;-</span> e5 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)  <span class="co"># 为 n-fold 交叉验证创建五个残差向量</span></span>
<span id="cb55-6"><a href="#cb55-6" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb55-8"><a href="#cb55-8" tabindex="-1"></a><span class="co"># 留一法交叉验证</span></span>
<span id="cb55-9"><a href="#cb55-9" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb55-10"><a href="#cb55-10" tabindex="-1"></a>    y <span class="ot">&lt;-</span> magnetic[<span class="sc">-</span>k]  <span class="co"># 除去第 k 个数据点的响应变量</span></span>
<span id="cb55-11"><a href="#cb55-11" tabindex="-1"></a>    x <span class="ot">&lt;-</span> chemical[<span class="sc">-</span>k]  <span class="co"># 除去第 k 个数据点的自变量</span></span>
<span id="cb55-12"><a href="#cb55-12" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" tabindex="-1"></a>    <span class="co"># 线性模型</span></span>
<span id="cb55-14"><a href="#cb55-14" tabindex="-1"></a>    J1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb55-15"><a href="#cb55-15" tabindex="-1"></a>    yhat1 <span class="ot">&lt;-</span> J1<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J1<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> chemical[k]</span>
<span id="cb55-16"><a href="#cb55-16" tabindex="-1"></a>    e1[k] <span class="ot">&lt;-</span> magnetic[k] <span class="sc">-</span> yhat1  <span class="co"># 计算残差</span></span>
<span id="cb55-17"><a href="#cb55-17" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" tabindex="-1"></a>    <span class="co"># 二次模型</span></span>
<span id="cb55-19"><a href="#cb55-19" tabindex="-1"></a>    J2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb55-20"><a href="#cb55-20" tabindex="-1"></a>    yhat2 <span class="ot">&lt;-</span> J2<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J2<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> chemical[k] <span class="sc">+</span> J2<span class="sc">$</span>coef[<span class="dv">3</span>] <span class="sc">*</span> chemical[k]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb55-21"><a href="#cb55-21" tabindex="-1"></a>    e2[k] <span class="ot">&lt;-</span> magnetic[k] <span class="sc">-</span> yhat2  <span class="co"># 计算残差</span></span>
<span id="cb55-22"><a href="#cb55-22" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" tabindex="-1"></a>    <span class="co"># 指数模型</span></span>
<span id="cb55-24"><a href="#cb55-24" tabindex="-1"></a>    J3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(y) <span class="sc">~</span> x)</span>
<span id="cb55-25"><a href="#cb55-25" tabindex="-1"></a>    logyhat3 <span class="ot">&lt;-</span> J3<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J3<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> chemical[k]</span>
<span id="cb55-26"><a href="#cb55-26" tabindex="-1"></a>    yhat3 <span class="ot">&lt;-</span> <span class="fu">exp</span>(logyhat3)</span>
<span id="cb55-27"><a href="#cb55-27" tabindex="-1"></a>    e3[k] <span class="ot">&lt;-</span> magnetic[k] <span class="sc">-</span> yhat3  <span class="co"># 计算残差</span></span>
<span id="cb55-28"><a href="#cb55-28" tabindex="-1"></a></span>
<span id="cb55-29"><a href="#cb55-29" tabindex="-1"></a>    <span class="co"># 三次多项式模型</span></span>
<span id="cb55-30"><a href="#cb55-30" tabindex="-1"></a>    J4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">3</span>))  <span class="co"># 新增三次多项式模型</span></span>
<span id="cb55-31"><a href="#cb55-31" tabindex="-1"></a>    yhat4 <span class="ot">&lt;-</span> J4<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J4<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> chemical[k] <span class="sc">+</span> J4<span class="sc">$</span>coef[<span class="dv">3</span>] <span class="sc">*</span> chemical[k]<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> J4<span class="sc">$</span>coef[<span class="dv">4</span>] <span class="sc">*</span> chemical[k]<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb55-32"><a href="#cb55-32" tabindex="-1"></a>    e4[k] <span class="ot">&lt;-</span> magnetic[k] <span class="sc">-</span> yhat4  <span class="co"># 计算残差</span></span>
<span id="cb55-33"><a href="#cb55-33" tabindex="-1"></a>}</span>
<span id="cb55-34"><a href="#cb55-34" tabindex="-1"></a></span>
<span id="cb55-35"><a href="#cb55-35" tabindex="-1"></a>    <span class="co"># 计算均方根误差 (RMSE)</span></span>
<span id="cb55-36"><a href="#cb55-36" tabindex="-1"></a>rmse1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(e1<span class="sc">^</span><span class="dv">2</span>))  <span class="co"># 线性模型</span></span>
<span id="cb55-37"><a href="#cb55-37" tabindex="-1"></a>rmse2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(e2<span class="sc">^</span><span class="dv">2</span>))  <span class="co"># 二次模型</span></span>
<span id="cb55-38"><a href="#cb55-38" tabindex="-1"></a>rmse3 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(e3<span class="sc">^</span><span class="dv">2</span>))  <span class="co"># 指数模型</span></span>
<span id="cb55-39"><a href="#cb55-39" tabindex="-1"></a>rmse4 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(e4<span class="sc">^</span><span class="dv">2</span>))  <span class="co"># 三次多项式模型</span></span>
<span id="cb55-40"><a href="#cb55-40" tabindex="-1"></a></span>
<span id="cb55-41"><a href="#cb55-41" tabindex="-1"></a></span>
<span id="cb55-42"><a href="#cb55-42" tabindex="-1"></a><span class="co"># 计算每个模型的调整 R^2</span></span>
<span id="cb55-43"><a href="#cb55-43" tabindex="-1"></a>adjusted_r2 <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb55-44"><a href="#cb55-44" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">summary</span>(model)<span class="sc">$</span>r.squared) <span class="sc">*</span> (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> (n <span class="sc">-</span> <span class="fu">length</span>(model<span class="sc">$</span>coefficients) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb55-45"><a href="#cb55-45" tabindex="-1"></a>}</span>
<span id="cb55-46"><a href="#cb55-46" tabindex="-1"></a></span>
<span id="cb55-47"><a href="#cb55-47" tabindex="-1"></a><span class="co"># 拟合每个模型并计算调整 R^2</span></span>
<span id="cb55-48"><a href="#cb55-48" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(magnetic <span class="sc">~</span> chemical)  <span class="co"># 线性模型</span></span>
<span id="cb55-49"><a href="#cb55-49" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(magnetic <span class="sc">~</span> chemical <span class="sc">+</span> <span class="fu">I</span>(chemical<span class="sc">^</span><span class="dv">2</span>))  <span class="co"># 二次模型</span></span>
<span id="cb55-50"><a href="#cb55-50" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(magnetic) <span class="sc">~</span> chemical)  <span class="co"># 指数模型</span></span>
<span id="cb55-51"><a href="#cb55-51" tabindex="-1"></a>model4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(magnetic <span class="sc">~</span> chemical <span class="sc">+</span> <span class="fu">I</span>(chemical<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(chemical<span class="sc">^</span><span class="dv">3</span>))  <span class="co"># 三次多项式模型</span></span>
<span id="cb55-52"><a href="#cb55-52" tabindex="-1"></a></span>
<span id="cb55-53"><a href="#cb55-53" tabindex="-1"></a><span class="co"># 计算调整 R^2</span></span>
<span id="cb55-54"><a href="#cb55-54" tabindex="-1"></a>adj_r2_1 <span class="ot">&lt;-</span> <span class="fu">adjusted_r2</span>(model1)</span>
<span id="cb55-55"><a href="#cb55-55" tabindex="-1"></a>adj_r2_2 <span class="ot">&lt;-</span> <span class="fu">adjusted_r2</span>(model2)</span>
<span id="cb55-56"><a href="#cb55-56" tabindex="-1"></a>adj_r2_3 <span class="ot">&lt;-</span> <span class="fu">adjusted_r2</span>(model3)</span>
<span id="cb55-57"><a href="#cb55-57" tabindex="-1"></a>adj_r2_4 <span class="ot">&lt;-</span> <span class="fu">adjusted_r2</span>(model4)</span>
<span id="cb55-58"><a href="#cb55-58" tabindex="-1"></a></span>
<span id="cb55-59"><a href="#cb55-59" tabindex="-1"></a><span class="co"># 打印结果</span></span>
<span id="cb55-60"><a href="#cb55-60" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;RMSE for Linear Model: &quot;</span>, rmse1, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## RMSE for Linear Model:  4.422267</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;RMSE for Quadratic Model: &quot;</span>, rmse2, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## RMSE for Quadratic Model:  4.225219</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;RMSE for Exponential Model: &quot;</span>, rmse3, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## RMSE for Exponential Model:  4.294401</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;RMSE for Cubic Polynomial Model: &quot;</span>, rmse4, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## RMSE for Cubic Polynomial Model:  4.263515</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a><span class="co"># 打印调整 R^2</span></span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Adjusted R^2 for Linear Model: &quot;</span>, adj_r2_1, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Adjusted R^2 for Linear Model:  0.5187176</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Adjusted R^2 for Quadratic Model: &quot;</span>, adj_r2_2, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Adjusted R^2 for Quadratic Model:  0.5681787</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Adjusted R^2 for Exponential Model: &quot;</span>, adj_r2_3, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Adjusted R^2 for Exponential Model:  0.5186167</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Adjusted R^2 for Cubic Polynomial Model: &quot;</span>, adj_r2_4, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Adjusted R^2 for Cubic Polynomial Model:  0.5651654</code></pre>
<p>分别对比RMSE和<span class="math inline">\(R^2\)</span>:
发现二次模型具有最低的RMSE和最高的<span class="math inline">\(R^2\)</span>，所以两个方法所选择的结果都是二次模型。</p>
</div>
<div id="question-3-4" class="section level2">
<h2>Question 3</h2>
<p>8.1</p>
<p>Implement the two-sample Cram ́er-von Mises test for equal
distributions as a permutation test. Apply the test to the data in
Examples 8.1 and 8.2.</p>
</div>
<div id="answer-15" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># 清理内存</span></span>
<span id="cb71-2"><a href="#cb71-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>) </span>
<span id="cb71-3"><a href="#cb71-3" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" tabindex="-1"></a><span class="co"># 生成数据</span></span>
<span id="cb71-5"><a href="#cb71-5" tabindex="-1"></a><span class="co"># 定义数据X和Y</span></span>
<span id="cb71-6"><a href="#cb71-6" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">158</span>, <span class="dv">171</span>, <span class="dv">193</span>, <span class="dv">199</span>, <span class="dv">230</span>, <span class="dv">243</span>, <span class="dv">248</span>, <span class="dv">248</span>, <span class="dv">250</span>, <span class="dv">267</span>, <span class="dv">271</span>, <span class="dv">316</span>, <span class="dv">327</span>, <span class="dv">329</span>)</span>
<span id="cb71-7"><a href="#cb71-7" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">141</span>, <span class="dv">148</span>, <span class="dv">169</span>, <span class="dv">181</span>, <span class="dv">203</span>, <span class="dv">213</span>, <span class="dv">229</span>, <span class="dv">244</span>, <span class="dv">257</span>, <span class="dv">260</span>, <span class="dv">271</span>, <span class="dv">309</span>)</span>
<span id="cb71-8"><a href="#cb71-8" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" tabindex="-1"></a><span class="co"># 设置置换次数</span></span>
<span id="cb71-10"><a href="#cb71-10" tabindex="-1"></a>num_permutations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb71-11"><a href="#cb71-11" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" tabindex="-1"></a><span class="co"># 初始化置换统计量的向量</span></span>
<span id="cb71-13"><a href="#cb71-13" tabindex="-1"></a>permuted_cvm <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_permutations)</span>
<span id="cb71-14"><a href="#cb71-14" tabindex="-1"></a></span>
<span id="cb71-15"><a href="#cb71-15" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb71-16"><a href="#cb71-16" tabindex="-1"></a><span class="co"># 合并样本</span></span>
<span id="cb71-17"><a href="#cb71-17" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">c</span>(X, Y)</span>
<span id="cb71-18"><a href="#cb71-18" tabindex="-1"></a></span>
<span id="cb71-19"><a href="#cb71-19" tabindex="-1"></a><span class="co"># 定义Cramér-von Mises统计量的函数</span></span>
<span id="cb71-20"><a href="#cb71-20" tabindex="-1"></a>cvm_statistic <span class="ot">&lt;-</span> <span class="cf">function</span>(sample1, sample2) {</span>
<span id="cb71-21"><a href="#cb71-21" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> <span class="fu">length</span>(sample1)</span>
<span id="cb71-22"><a href="#cb71-22" tabindex="-1"></a>  n2 <span class="ot">&lt;-</span> <span class="fu">length</span>(sample2)</span>
<span id="cb71-23"><a href="#cb71-23" tabindex="-1"></a>  ecdf1 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(sample1)</span>
<span id="cb71-24"><a href="#cb71-24" tabindex="-1"></a>  ecdf2 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(sample2)</span>
<span id="cb71-25"><a href="#cb71-25" tabindex="-1"></a>  cvm <span class="ot">&lt;-</span> <span class="fu">sum</span>((<span class="fu">ecdf1</span>(combined) <span class="sc">-</span> <span class="fu">ecdf2</span>(combined))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb71-26"><a href="#cb71-26" tabindex="-1"></a>  <span class="fu">return</span>(cvm)</span>
<span id="cb71-27"><a href="#cb71-27" tabindex="-1"></a>}</span>
<span id="cb71-28"><a href="#cb71-28" tabindex="-1"></a></span>
<span id="cb71-29"><a href="#cb71-29" tabindex="-1"></a><span class="co"># 计算原始Cramér-von Mises统计量</span></span>
<span id="cb71-30"><a href="#cb71-30" tabindex="-1"></a>original_cvm <span class="ot">&lt;-</span> <span class="fu">cvm_statistic</span>(X, Y)</span>
<span id="cb71-31"><a href="#cb71-31" tabindex="-1"></a></span>
<span id="cb71-32"><a href="#cb71-32" tabindex="-1"></a></span>
<span id="cb71-33"><a href="#cb71-33" tabindex="-1"></a><span class="co"># 进行置换检验</span></span>
<span id="cb71-34"><a href="#cb71-34" tabindex="-1"></a></span>
<span id="cb71-35"><a href="#cb71-35" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_permutations) {</span>
<span id="cb71-36"><a href="#cb71-36" tabindex="-1"></a>  <span class="co"># 随机置换合并样本</span></span>
<span id="cb71-37"><a href="#cb71-37" tabindex="-1"></a>  permuted_samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(combined)</span>
<span id="cb71-38"><a href="#cb71-38" tabindex="-1"></a>  <span class="co"># 将置换后的样本分成两部分</span></span>
<span id="cb71-39"><a href="#cb71-39" tabindex="-1"></a>  permuted_X <span class="ot">&lt;-</span> permuted_samples[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(X)]</span>
<span id="cb71-40"><a href="#cb71-40" tabindex="-1"></a>  permuted_Y <span class="ot">&lt;-</span> permuted_samples[(<span class="fu">length</span>(X) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(combined)]</span>
<span id="cb71-41"><a href="#cb71-41" tabindex="-1"></a>  <span class="co"># 计算置换后的Cramér-von Mises统计量</span></span>
<span id="cb71-42"><a href="#cb71-42" tabindex="-1"></a>  permuted_cvm[i] <span class="ot">&lt;-</span> <span class="fu">cvm_statistic</span>(permuted_X, permuted_Y)</span>
<span id="cb71-43"><a href="#cb71-43" tabindex="-1"></a>}</span>
<span id="cb71-44"><a href="#cb71-44" tabindex="-1"></a></span>
<span id="cb71-45"><a href="#cb71-45" tabindex="-1"></a><span class="co"># 计算p值</span></span>
<span id="cb71-46"><a href="#cb71-46" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(permuted_cvm <span class="sc">&gt;=</span> original_cvm)</span>
<span id="cb71-47"><a href="#cb71-47" tabindex="-1"></a></span>
<span id="cb71-48"><a href="#cb71-48" tabindex="-1"></a><span class="co"># 打印结果</span></span>
<span id="cb71-49"><a href="#cb71-49" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;原始Cramér-von Mises统计量:&quot;</span>, original_cvm, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 原始Cramér-von Mises统计量: 0.6096939</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;p值:&quot;</span>, p_value, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## p值: 0.39</code></pre>
<p>结果分析:p值远大于0.05，且检验统计量数值并不大，因此无法认为两个样本的分布存在显著差异。</p>
</div>
<div id="question-4" class="section level2">
<h2>Question 4</h2>
<p>Implement the bivariate Spearman rank correlation test for
independence [255] as a permutation test. The Spearman rank correlation
test statistic can be obtained from function cor with method =
“spearman”. Compare the achieved significance level of the permutation
test with the p-value reported by cor.test on the same samples.</p>
</div>
<div id="answer-16" class="section level2">
<h2>Answer</h2>
<p>思路:
我们先生成两个变量的随机样本，计算实际的Spearman秩相关系数，再通过打乱一个变量的顺序，重复计算秩相关系数，得到其分布，计算排列检验中的显著性水平，最后使用cor.test函数计算相同样本的p值，并与排列测试的显著性水平进行对比。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># 清理内存</span></span>
<span id="cb75-2"><a href="#cb75-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb75-3"><a href="#cb75-3" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" tabindex="-1"></a><span class="co"># 生成数据</span></span>
<span id="cb75-5"><a href="#cb75-5" tabindex="-1"></a><span class="co"># 生成两个变量的样本</span></span>
<span id="cb75-6"><a href="#cb75-6" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">30</span>)</span>
<span id="cb75-7"><a href="#cb75-7" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">30</span>)</span>
<span id="cb75-8"><a href="#cb75-8" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb75-10"><a href="#cb75-10" tabindex="-1"></a><span class="co"># 使用 cor 计算实际的 Spearman 秩相关系数</span></span>
<span id="cb75-11"><a href="#cb75-11" tabindex="-1"></a>actual_corr <span class="ot">&lt;-</span> <span class="fu">cor</span>(x, y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb75-12"><a href="#cb75-12" tabindex="-1"></a></span>
<span id="cb75-13"><a href="#cb75-13" tabindex="-1"></a><span class="co"># 定义排列测试函数</span></span>
<span id="cb75-14"><a href="#cb75-14" tabindex="-1"></a>perm_test <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">n_perm =</span> <span class="dv">1000</span>) {</span>
<span id="cb75-15"><a href="#cb75-15" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb75-16"><a href="#cb75-16" tabindex="-1"></a>  perm_corrs <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_perm)</span>
<span id="cb75-17"><a href="#cb75-17" tabindex="-1"></a>  </span>
<span id="cb75-18"><a href="#cb75-18" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_perm) {</span>
<span id="cb75-19"><a href="#cb75-19" tabindex="-1"></a>    <span class="co"># 随机打乱 y 的顺序</span></span>
<span id="cb75-20"><a href="#cb75-20" tabindex="-1"></a>    perm_y <span class="ot">&lt;-</span> <span class="fu">sample</span>(y)</span>
<span id="cb75-21"><a href="#cb75-21" tabindex="-1"></a>    <span class="co"># 计算排列后的秩相关系数</span></span>
<span id="cb75-22"><a href="#cb75-22" tabindex="-1"></a>    perm_corrs[i] <span class="ot">&lt;-</span> <span class="fu">cor</span>(x, perm_y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb75-23"><a href="#cb75-23" tabindex="-1"></a>  }</span>
<span id="cb75-24"><a href="#cb75-24" tabindex="-1"></a>  </span>
<span id="cb75-25"><a href="#cb75-25" tabindex="-1"></a>  <span class="co"># 计算显著性水平</span></span>
<span id="cb75-26"><a href="#cb75-26" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(perm_corrs) <span class="sc">&gt;=</span> <span class="fu">abs</span>(actual_corr))</span>
<span id="cb75-27"><a href="#cb75-27" tabindex="-1"></a>  <span class="fu">return</span>(p_value)</span>
<span id="cb75-28"><a href="#cb75-28" tabindex="-1"></a>}</span>
<span id="cb75-29"><a href="#cb75-29" tabindex="-1"></a></span>
<span id="cb75-30"><a href="#cb75-30" tabindex="-1"></a><span class="co"># 进行排列测试</span></span>
<span id="cb75-31"><a href="#cb75-31" tabindex="-1"></a>perm_p_value <span class="ot">&lt;-</span> <span class="fu">perm_test</span>(x, y)</span>
<span id="cb75-32"><a href="#cb75-32" tabindex="-1"></a></span>
<span id="cb75-33"><a href="#cb75-33" tabindex="-1"></a><span class="co"># 使用 cor.test 函数计算 p 值</span></span>
<span id="cb75-34"><a href="#cb75-34" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(x, y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb75-35"><a href="#cb75-35" tabindex="-1"></a>cor_test_p_value <span class="ot">&lt;-</span> test<span class="sc">$</span>p.value</span>
<span id="cb75-36"><a href="#cb75-36" tabindex="-1"></a></span>
<span id="cb75-37"><a href="#cb75-37" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb75-38"><a href="#cb75-38" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;排列测试的显著性水平 (p值):&quot;</span>, perm_p_value, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 排列测试的显著性水平 (p值): 0.562</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;cor.test 的 p 值:&quot;</span>, cor_test_p_value, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## cor.test 的 p 值: 0.5802045</code></pre>
<p>结果分析:</p>
<p>1.排列测试通过随机排列数据直接估计相关系数的分布，这种方法对数据的分布假设较少，适用于各种数据分布。</p>
<p>2.cor.test使用经典的统计方法来估计p值，通常会假设数据分布近似于正态。</p>
<p>3.两种方法得到的p值相近，都表示我们没有足够的证据拒绝“两个变量独立”的原假设，表明在此数据集下，两者都能提供相似的显著性水平。</p>
</div>
</div>
<div id="a-sc24002027-2024-10-28" class="section level1">
<h1>A-SC24002027-2024-10-28</h1>
<div id="question-1-5" class="section level2">
<h2>Question 1</h2>
<p>Proof the Stationarity of Metropolis-Hastings sampler Algorithm in
continuous situation.</p>
</div>
<div id="answer-17" class="section level2">
<h2>Answer</h2>
<p>如果$ r s $</p>
<p>那么 <span class="math display">\[
K(s,r)f(s) = \alpha (r,s)g(s \mid r)f(s) =
\alpha(s,r)=\min\{\frac{f(r)g(s|r)}{f(s)g(r|s)},1\}g(s,r)f(s)
\]</span></p>
<p>如果<span class="math inline">\(\frac{f(r)g(s|r)}{f(s)g(r|s)}&gt;1\)</span>, <span class="math inline">\(K(s,r)f(s) = g(s,r)f(s)\)</span></p>
<p>如果<span class="math inline">\(\frac{f(r)g(s|r)}{f(s)g(r|s)}&lt;1\)</span>, <span class="math inline">\(K(s,r)f(s) = g(r,s)f(r)\)</span></p>
<p>同理可以证明：</p>
<p><span class="math display">\[
K(r,s)f(r) = \alpha (s,r)g(r \mid s)f(r) =
\alpha(r,s)=\min\{\frac{f(s)g(r|s)}{f(r)g(s|r)},1\}g(r,s)f(r)
\]</span></p>
<p>如果<span class="math inline">\(\frac{f(r)g(s|r)}{f(s)g(r|s)}&gt;1\)</span>, <span class="math inline">\(K(r,s)f(r) = g(s,r)f(s)\)</span></p>
<p>如果<span class="math inline">\(\frac{f(r)g(s|r)}{f(s)g(r|s)}&lt;1\)</span>, <span class="math inline">\(K(r,s)f(r) = g(r,s)f(r)\)</span></p>
<p>所以<span class="math inline">\(K(s,r)f(s)=K(r,s)f(r)\)</span></p>
</div>
<div id="question-2-5" class="section level2">
<h2>Question 2</h2>
<p>9.3 Use the Metropolis-Hastings sampler to generate random variables
from a standard Cauchy distribution. Discard the first 1000 of the
chain, and compare the deciles of the generated observations with the
deciles of the standard Cauchy distribution (see qcauchy or qt with
df=1). Recall that a Cauchy(θ, η) distribution has density function
<span class="math display">\[
f(x)=\frac {1}{\theta \pi (1+[(\pi - \eta)/ \theta])} -\infty &lt; x
&lt; \infty, \theta &gt;0.
\]</span> The standard Cauchy has the Cauchy(θ = 1, η = 0) density.
(Note that the standard Cauchy density is equal to the Student t density
with one degree of freedom.)</p>
<p>思路: 1. 将提议分布设置为正态分布</p>
<ol start="2" style="list-style-type: decimal">
<li><p>从提议分布中生成<span class="math inline">\(X_1\)</span></p></li>
<li><p>重复 for i=2,…,N</p>
<ol style="list-style-type: lower-alpha">
<li>从提议分布中生成y</li>
<li>从0到1的均匀分布中生成U</li>
<li>计算 <span class="math inline">\(\beta(X_{i-1},Y)=\frac{f(Y)g(X_{i-1}|Y)}{f(X_{i-1})g(Y|X_{i-1})}\)</span>.
如果 <span class="math inline">\(U\leq \beta(X_{i-1},Y)\)</span> 接受
<span class="math inline">\(Y\)</span> 并且设定 <span class="math inline">\(X_i=Y\)</span>; 否则 <span class="math inline">\(X_{i}=X_{i-1}\)</span>.</li>
</ol></li>
<li><p>计算经验分位数和理论分位数</p></li>
</ol>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb79-2"><a href="#cb79-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb79-3"><a href="#cb79-3" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" tabindex="-1"></a><span class="co"># 生成数据</span></span>
<span id="cb79-5"><a href="#cb79-5" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb79-6"><a href="#cb79-6" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># 选择一个合适的sigma值</span></span>
<span id="cb79-7"><a href="#cb79-7" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m)</span>
<span id="cb79-8"><a href="#cb79-8" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)  <span class="co"># 初始值</span></span>
<span id="cb79-9"><a href="#cb79-9" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">runif</span>(m)</span>
<span id="cb79-10"><a href="#cb79-10" tabindex="-1"></a><span class="co"># 目标函数为dcauchy()</span></span>
<span id="cb79-11"><a href="#cb79-11" tabindex="-1"></a></span>
<span id="cb79-12"><a href="#cb79-12" tabindex="-1"></a><span class="co"># 统计推理</span></span>
<span id="cb79-13"><a href="#cb79-13" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>m) {</span>
<span id="cb79-14"><a href="#cb79-14" tabindex="-1"></a>  xt <span class="ot">=</span> x[i<span class="dv">-1</span>]</span>
<span id="cb79-15"><a href="#cb79-15" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> xt, <span class="at">sd =</span> sigma) <span class="co"># 从提议分布中获取一个值</span></span>
<span id="cb79-16"><a href="#cb79-16" tabindex="-1"></a>  num <span class="ot">&lt;-</span> (<span class="fu">dcauchy</span>(y) <span class="sc">*</span> <span class="fu">dnorm</span>(xt, <span class="at">mean =</span> y, <span class="at">sd =</span> sigma))</span>
<span id="cb79-17"><a href="#cb79-17" tabindex="-1"></a>  den <span class="ot">&lt;-</span> (<span class="fu">dcauchy</span>(xt) <span class="sc">*</span> <span class="fu">dnorm</span>(y, <span class="at">mean =</span> xt, <span class="at">sd =</span> sigma)) <span class="co"># 计算接受率</span></span>
<span id="cb79-18"><a href="#cb79-18" tabindex="-1"></a>  </span>
<span id="cb79-19"><a href="#cb79-19" tabindex="-1"></a>  <span class="co"># 判别是否接受</span></span>
<span id="cb79-20"><a href="#cb79-20" tabindex="-1"></a>  <span class="cf">if</span> (u[i] <span class="sc">&lt;=</span> num<span class="sc">/</span>den) { </span>
<span id="cb79-21"><a href="#cb79-21" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> y</span>
<span id="cb79-22"><a href="#cb79-22" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb79-23"><a href="#cb79-23" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> x[i<span class="dv">-1</span>]</span>
<span id="cb79-24"><a href="#cb79-24" tabindex="-1"></a>  }</span>
<span id="cb79-25"><a href="#cb79-25" tabindex="-1"></a>}</span>
<span id="cb79-26"><a href="#cb79-26" tabindex="-1"></a></span>
<span id="cb79-27"><a href="#cb79-27" tabindex="-1"></a><span class="co"># 丢弃前1000个样本</span></span>
<span id="cb79-28"><a href="#cb79-28" tabindex="-1"></a>x <span class="ot">&lt;-</span> x[<span class="dv">1001</span><span class="sc">:</span>m]</span>
<span id="cb79-29"><a href="#cb79-29" tabindex="-1"></a></span>
<span id="cb79-30"><a href="#cb79-30" tabindex="-1"></a><span class="co"># 计算分位数</span></span>
<span id="cb79-31"><a href="#cb79-31" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb79-32"><a href="#cb79-32" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="fu">quantile</span>(x, a)</span>
<span id="cb79-33"><a href="#cb79-33" tabindex="-1"></a>QR <span class="ot">&lt;-</span> <span class="fu">qcauchy</span>(a)  <span class="co"># 标准柯西分布的理论分位数</span></span>
<span id="cb79-34"><a href="#cb79-34" tabindex="-1"></a></span>
<span id="cb79-35"><a href="#cb79-35" tabindex="-1"></a><span class="co"># 打印结果</span></span>
<span id="cb79-36"><a href="#cb79-36" tabindex="-1"></a><span class="fu">print</span>(Q)</span></code></pre></div>
<pre><code>##         10%         20%         30%         40%         50%         60% 
## -2.53279710 -1.21151415 -0.68126205 -0.30855119  0.00243179  0.32712073 
##         70%         80%         90% 
##  0.70857930  1.30699717  2.79224880</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a><span class="fu">print</span>(QR)</span></code></pre></div>
<pre><code>## [1] -3.0776835 -1.3763819 -0.7265425 -0.3249197  0.0000000  0.3249197  0.7265425
## [8]  1.3763819  3.0776835</code></pre>
<p>结果分析:</p>
<p>样本分位数与理论分位数总体接近，尤其是中位数（50%分位数）附近。这表明
Metropolis-Hastings算法能够有效地生成接近标准柯西分布的样本。
在两侧尾部（10%和90%分位数）位置，样本分位数与理论分位数有较大偏差这是因为在极值处，柯西分布的重尾效应可能使采样更难覆盖到尾部区域。</p>
</div>
<div id="question-3-5" class="section level2">
<h2>Question 3</h2>
<p>9.8 This example appears in [40]. Consider the bivariate density
<span class="math display">\[
f(x,y) \propto \binom{n}{x} y^{x+a-1} (1-y)^{n-x+b-1}, \quad x = 0, 1,
\ldots, n, \; 0 \leq y \leq 1
\]</span> It can be shown (see e.g. [23]) that for fixed a, b, n, the
conditional distributions are Binomial(n, y) and Beta(x + a, n − x + b).
Use the Gibbs sampler to generate a chain with target joint density f
(x, y).</p>
</div>
<div id="answer-18" class="section level2">
<h2>Answer</h2>
<p>思路:</p>
<ol style="list-style-type: decimal">
<li><p>设置起始值</p></li>
<li><p>重复 for i=2,…,N</p>
<ol style="list-style-type: lower-alpha">
<li><p>(x1, x2) = X (t − 1)</p></li>
<li><p>从x条件概率分布中生成<span class="math inline">\(x^* (t) =
f_x(\cdot \mid x_{2})\)</span>, 从y条件概率分布中生成<span class="math inline">\(y^* (t) = f(\cdot \mid x^* (t))\)</span></p></li>
<li><p>x=(x^* (t), y^* (t))</p></li>
</ol></li>
</ol>
<p>为了方便编程，用<span class="math inline">\(x_1,
x_2\)</span>分别代替x和y。</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb83-2"><a href="#cb83-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb83-3"><a href="#cb83-3" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" tabindex="-1"></a><span class="co"># 设置参数</span></span>
<span id="cb83-5"><a href="#cb83-5" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span>  </span>
<span id="cb83-6"><a href="#cb83-6" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span>   </span>
<span id="cb83-7"><a href="#cb83-7" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">1</span>   </span>
<span id="cb83-8"><a href="#cb83-8" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10000</span> </span>
<span id="cb83-9"><a href="#cb83-9" tabindex="-1"></a>burn <span class="ot">&lt;-</span> <span class="dv">1000</span> </span>
<span id="cb83-10"><a href="#cb83-10" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, N, <span class="dv">2</span>) <span class="co"># 存储样本链的矩阵</span></span>
<span id="cb83-11"><a href="#cb83-11" tabindex="-1"></a></span>
<span id="cb83-12"><a href="#cb83-12" tabindex="-1"></a><span class="co"># 初始化</span></span>
<span id="cb83-13"><a href="#cb83-13" tabindex="-1"></a>X[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>) <span class="co"># 假设的初始值</span></span>
<span id="cb83-14"><a href="#cb83-14" tabindex="-1"></a></span>
<span id="cb83-15"><a href="#cb83-15" tabindex="-1"></a><span class="co"># the Gibbs sampler</span></span>
<span id="cb83-16"><a href="#cb83-16" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N) {</span>
<span id="cb83-17"><a href="#cb83-17" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> X[i<span class="dv">-1</span>, <span class="dv">2</span>]</span>
<span id="cb83-18"><a href="#cb83-18" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> X[i, <span class="dv">1</span>]</span>
<span id="cb83-19"><a href="#cb83-19" tabindex="-1"></a>   <span class="co"># 从条件分布 P(x|y) 中抽样得到新的 x 值</span></span>
<span id="cb83-20"><a href="#cb83-20" tabindex="-1"></a>  X[i, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, x2)</span>
<span id="cb83-21"><a href="#cb83-21" tabindex="-1"></a>  <span class="co"># 从条件分布 P(y|x) 中抽样得到新的 y 值</span></span>
<span id="cb83-22"><a href="#cb83-22" tabindex="-1"></a>  X[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, x1 <span class="sc">+</span> a, n <span class="sc">-</span> x1 <span class="sc">+</span> b)</span>
<span id="cb83-23"><a href="#cb83-23" tabindex="-1"></a></span>
<span id="cb83-24"><a href="#cb83-24" tabindex="-1"></a>}</span>
<span id="cb83-25"><a href="#cb83-25" tabindex="-1"></a></span>
<span id="cb83-26"><a href="#cb83-26" tabindex="-1"></a><span class="co"># 去除烧入</span></span>
<span id="cb83-27"><a href="#cb83-27" tabindex="-1"></a>b <span class="ot">&lt;-</span> burn <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb83-28"><a href="#cb83-28" tabindex="-1"></a>x <span class="ot">&lt;-</span> X[b<span class="sc">:</span>N, ]</span>
<span id="cb83-29"><a href="#cb83-29" tabindex="-1"></a></span>
<span id="cb83-30"><a href="#cb83-30" tabindex="-1"></a><span class="co"># 计算统计量</span></span>
<span id="cb83-31"><a href="#cb83-31" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(x)</span>
<span id="cb83-32"><a href="#cb83-32" tabindex="-1"></a>std_errors <span class="ot">&lt;-</span> <span class="fu">apply</span>(x, <span class="dv">2</span>, sd)</span>
<span id="cb83-33"><a href="#cb83-33" tabindex="-1"></a>correlation_coefficient <span class="ot">&lt;-</span> <span class="fu">cor</span>(x[,<span class="dv">1</span>], x[,<span class="dv">2</span>])</span>
<span id="cb83-34"><a href="#cb83-34" tabindex="-1"></a></span>
<span id="cb83-35"><a href="#cb83-35" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb83-36"><a href="#cb83-36" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;Means: &#39;</span>, <span class="fu">round</span>(means, <span class="dv">2</span>), <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<pre><code>## Means:  0.83 0.08</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;Standard errors: &#39;</span>, <span class="fu">round</span>(std_errors, <span class="dv">2</span>), <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<pre><code>## Standard errors:  1.14 0.08</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;Correlation coefficient: &#39;</span>, <span class="fu">round</span>(correlation_coefficient, <span class="dv">2</span>), <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<pre><code>## Correlation coefficient:  0</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" tabindex="-1"></a><span class="fu">plot</span>(x[,<span class="dv">1</span>],<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">col=</span><span class="dv">1</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">xlab=</span><span class="st">&#39;Index&#39;</span>,<span class="at">ylab=</span><span class="st">&#39;Random numbers&#39;</span>)</span>
<span id="cb89-2"><a href="#cb89-2" tabindex="-1"></a><span class="fu">lines</span>(x[,<span class="dv">2</span>],<span class="at">col=</span><span class="dv">2</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb89-3"><a href="#cb89-3" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;bottomright&#39;</span>,<span class="fu">c</span>(<span class="fu">expression</span>(X[<span class="dv">1</span>]),<span class="fu">expression</span>(X[<span class="dv">2</span>])), <span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>结果分析：</p>
<p>得到了目标分布随机数。</p>
</div>
<div id="question-4-1" class="section level2">
<h2>Question 4</h2>
<p>For each of the above exercise, use the Gelman-Rubin method to
monitor convergence of the chain, and run the chain until it converges
approximately to the target distribution according to <span class="math inline">\(\hat R &lt; 1.2\)</span>.</p>
</div>
<div id="answer-19" class="section level2">
<h2>Answer</h2>
<p>使用coda包完成计算<span class="math inline">\(\hat R\)</span>,
并将<span class="math inline">\(\hat R\)</span>的统计序列画出来。</p>
<p>首先是柯西分布的马尔科夫链</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb90-2"><a href="#cb90-2" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb90-3"><a href="#cb90-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb90-4"><a href="#cb90-4" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" tabindex="-1"></a>    normal.chain <span class="ot">&lt;-</span> <span class="cf">function</span>(sigma, N, X1) {</span>
<span id="cb90-6"><a href="#cb90-6" tabindex="-1"></a>      x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb90-7"><a href="#cb90-7" tabindex="-1"></a>      x[<span class="dv">1</span>]<span class="ot">=</span>X1</span>
<span id="cb90-8"><a href="#cb90-8" tabindex="-1"></a>      u <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb90-9"><a href="#cb90-9" tabindex="-1"></a>      </span>
<span id="cb90-10"><a href="#cb90-10" tabindex="-1"></a>     <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N) {</span>
<span id="cb90-11"><a href="#cb90-11" tabindex="-1"></a>     xt <span class="ot">&lt;-</span> x[i<span class="dv">-1</span>]</span>
<span id="cb90-12"><a href="#cb90-12" tabindex="-1"></a>     y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> xt, <span class="at">sd =</span> sigma)</span>
<span id="cb90-13"><a href="#cb90-13" tabindex="-1"></a>     num <span class="ot">&lt;-</span> (<span class="fu">dcauchy</span>(y,<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">dnorm</span>(xt, y, sigma))</span>
<span id="cb90-14"><a href="#cb90-14" tabindex="-1"></a>     den <span class="ot">&lt;-</span> (<span class="fu">dcauchy</span>(xt,<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">dnorm</span>(y, xt, sigma))</span>
<span id="cb90-15"><a href="#cb90-15" tabindex="-1"></a>     </span>
<span id="cb90-16"><a href="#cb90-16" tabindex="-1"></a>     <span class="cf">if</span> (u[i] <span class="sc">&lt;=</span> num <span class="sc">/</span> den) {</span>
<span id="cb90-17"><a href="#cb90-17" tabindex="-1"></a>       x[i] <span class="ot">&lt;-</span> y</span>
<span id="cb90-18"><a href="#cb90-18" tabindex="-1"></a>     }</span>
<span id="cb90-19"><a href="#cb90-19" tabindex="-1"></a>     <span class="cf">else</span> {</span>
<span id="cb90-20"><a href="#cb90-20" tabindex="-1"></a>       x[i] <span class="ot">&lt;-</span> x[i<span class="dv">-1</span>]</span>
<span id="cb90-21"><a href="#cb90-21" tabindex="-1"></a>     }</span>
<span id="cb90-22"><a href="#cb90-22" tabindex="-1"></a>     }</span>
<span id="cb90-23"><a href="#cb90-23" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb90-24"><a href="#cb90-24" tabindex="-1"></a>}</span>
<span id="cb90-25"><a href="#cb90-25" tabindex="-1"></a></span>
<span id="cb90-26"><a href="#cb90-26" tabindex="-1"></a>  <span class="co"># 设置参数</span></span>
<span id="cb90-27"><a href="#cb90-27" tabindex="-1"></a>burn_in <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb90-28"><a href="#cb90-28" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb90-29"><a href="#cb90-29" tabindex="-1"></a>initial_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="sc">-</span><span class="dv">5</span>)  <span class="co"># 初始值，用于生成多条链</span></span>
<span id="cb90-30"><a href="#cb90-30" tabindex="-1"></a></span>
<span id="cb90-31"><a href="#cb90-31" tabindex="-1"></a><span class="co"># 定义样本数范围</span></span>
<span id="cb90-32"><a href="#cb90-32" tabindex="-1"></a>sample_sizes <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1000</span>, <span class="dv">10000</span>, <span class="at">by =</span> <span class="dv">100</span>)  <span class="co"># 每次增加500个样本</span></span>
<span id="cb90-33"><a href="#cb90-33" tabindex="-1"></a>r_hat_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(sample_sizes))  <span class="co"># 存储每个N下的R_hat值</span></span>
<span id="cb90-34"><a href="#cb90-34" tabindex="-1"></a></span>
<span id="cb90-35"><a href="#cb90-35" tabindex="-1"></a><span class="co"># 计算每个样本数下的R_hat值</span></span>
<span id="cb90-36"><a href="#cb90-36" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(sample_sizes)) {</span>
<span id="cb90-37"><a href="#cb90-37" tabindex="-1"></a>  N <span class="ot">&lt;-</span> sample_sizes[i]</span>
<span id="cb90-38"><a href="#cb90-38" tabindex="-1"></a>  </span>
<span id="cb90-39"><a href="#cb90-39" tabindex="-1"></a>  <span class="co"># 生成多条链</span></span>
<span id="cb90-40"><a href="#cb90-40" tabindex="-1"></a>  chains <span class="ot">&lt;-</span> <span class="fu">lapply</span>(initial_values, <span class="cf">function</span>(init) <span class="fu">normal.chain</span>(sigma, N, init))</span>
<span id="cb90-41"><a href="#cb90-41" tabindex="-1"></a>  </span>
<span id="cb90-42"><a href="#cb90-42" tabindex="-1"></a>  <span class="co"># 将每条链转换为mcmc对象并丢弃Burn-in部分</span></span>
<span id="cb90-43"><a href="#cb90-43" tabindex="-1"></a>  chains <span class="ot">&lt;-</span> <span class="fu">lapply</span>(chains, <span class="cf">function</span>(chain) <span class="fu">mcmc</span>(chain[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span>burn_in)]))</span>
<span id="cb90-44"><a href="#cb90-44" tabindex="-1"></a>  </span>
<span id="cb90-45"><a href="#cb90-45" tabindex="-1"></a>  <span class="co"># 创建mcmc.list对象</span></span>
<span id="cb90-46"><a href="#cb90-46" tabindex="-1"></a>  mcmc_chains <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(chains)</span>
<span id="cb90-47"><a href="#cb90-47" tabindex="-1"></a>  </span>
<span id="cb90-48"><a href="#cb90-48" tabindex="-1"></a>  <span class="co"># 计算Gelman-Rubin诊断的点估计值 (Point est.)</span></span>
<span id="cb90-49"><a href="#cb90-49" tabindex="-1"></a>  r_hat_values[i] <span class="ot">&lt;-</span> <span class="fu">gelman.diag</span>(mcmc_chains)<span class="sc">$</span>psrf[, <span class="st">&quot;Point est.&quot;</span>][<span class="dv">1</span>]</span>
<span id="cb90-50"><a href="#cb90-50" tabindex="-1"></a>}</span>
<span id="cb90-51"><a href="#cb90-51" tabindex="-1"></a></span>
<span id="cb90-52"><a href="#cb90-52" tabindex="-1"></a><span class="co"># 绘制N与R_hat的关系图</span></span>
<span id="cb90-53"><a href="#cb90-53" tabindex="-1"></a><span class="fu">plot</span>(sample_sizes, r_hat_values, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb90-54"><a href="#cb90-54" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;样本数 (N)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;R_hat 值&quot;</span>,</span>
<span id="cb90-55"><a href="#cb90-55" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;样本数与Gelman-Rubin R_hat的关系&quot;</span>)</span>
<span id="cb90-56"><a href="#cb90-56" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">1.2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)  <span class="co"># 添加1.2的参考线</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- -->
结果分析：</p>
<p>柯西分布的样本往往会出现极端值或离群值，这些值会使链在不同初始位置的波动较大，从而导致不同链之间的差异很难缩小，导致数据难以收敛。</p>
<p>对于练习9.8</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb91-2"><a href="#cb91-2" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb91-3"><a href="#cb91-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb91-4"><a href="#cb91-4" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" tabindex="-1"></a><span class="co"># 设置Gibbs采样参数</span></span>
<span id="cb91-6"><a href="#cb91-6" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb91-7"><a href="#cb91-7" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb91-8"><a href="#cb91-8" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb91-9"><a href="#cb91-9" tabindex="-1"></a>burn <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb91-10"><a href="#cb91-10" tabindex="-1"></a>initial_values <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">0.8</span>), <span class="fu">c</span>(<span class="dv">9</span>, <span class="fl">0.2</span>))  <span class="co"># 初始值，用于生成多条链</span></span>
<span id="cb91-11"><a href="#cb91-11" tabindex="-1"></a></span>
<span id="cb91-12"><a href="#cb91-12" tabindex="-1"></a><span class="co"># 定义样本数范围</span></span>
<span id="cb91-13"><a href="#cb91-13" tabindex="-1"></a>sample_sizes <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1000</span>, <span class="dv">1500</span>, <span class="at">by =</span> <span class="dv">5</span>)  <span class="co"># 每次增加500个样本</span></span>
<span id="cb91-14"><a href="#cb91-14" tabindex="-1"></a>r_hat_x1_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(sample_sizes))  <span class="co"># 存储每个样本数下X1的R_hat值</span></span>
<span id="cb91-15"><a href="#cb91-15" tabindex="-1"></a>r_hat_x2_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(sample_sizes))  <span class="co"># 存储每个样本数下X2的R_hat值</span></span>
<span id="cb91-16"><a href="#cb91-16" tabindex="-1"></a></span>
<span id="cb91-17"><a href="#cb91-17" tabindex="-1"></a><span class="co"># 定义Gibbs采样函数</span></span>
<span id="cb91-18"><a href="#cb91-18" tabindex="-1"></a>gibbs_sampler <span class="ot">&lt;-</span> <span class="cf">function</span>(n, a, b, N, init) {</span>
<span id="cb91-19"><a href="#cb91-19" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, N, <span class="dv">2</span>)  <span class="co"># 存储样本链的矩阵</span></span>
<span id="cb91-20"><a href="#cb91-20" tabindex="-1"></a>  X[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> init         <span class="co"># 设置初始值</span></span>
<span id="cb91-21"><a href="#cb91-21" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N) {</span>
<span id="cb91-22"><a href="#cb91-22" tabindex="-1"></a>    x2 <span class="ot">&lt;-</span> X[i<span class="dv">-1</span>, <span class="dv">2</span>]</span>
<span id="cb91-23"><a href="#cb91-23" tabindex="-1"></a>    <span class="co"># 从条件分布 P(x|y) 中抽样得到新的 x 值</span></span>
<span id="cb91-24"><a href="#cb91-24" tabindex="-1"></a>    X[i, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, x2)</span>
<span id="cb91-25"><a href="#cb91-25" tabindex="-1"></a>    x1 <span class="ot">&lt;-</span> X[i, <span class="dv">1</span>]</span>
<span id="cb91-26"><a href="#cb91-26" tabindex="-1"></a>    <span class="co"># 从条件分布 P(y|x) 中抽样得到新的 y 值</span></span>
<span id="cb91-27"><a href="#cb91-27" tabindex="-1"></a>    X[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, x1 <span class="sc">+</span> a, n <span class="sc">-</span> x1 <span class="sc">+</span> b)</span>
<span id="cb91-28"><a href="#cb91-28" tabindex="-1"></a>  }</span>
<span id="cb91-29"><a href="#cb91-29" tabindex="-1"></a>  <span class="fu">return</span>(X)</span>
<span id="cb91-30"><a href="#cb91-30" tabindex="-1"></a>}</span>
<span id="cb91-31"><a href="#cb91-31" tabindex="-1"></a></span>
<span id="cb91-32"><a href="#cb91-32" tabindex="-1"></a><span class="co"># 计算每个样本数下的R_hat值</span></span>
<span id="cb91-33"><a href="#cb91-33" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(sample_sizes)) {</span>
<span id="cb91-34"><a href="#cb91-34" tabindex="-1"></a>  N <span class="ot">&lt;-</span> sample_sizes[i]</span>
<span id="cb91-35"><a href="#cb91-35" tabindex="-1"></a>  </span>
<span id="cb91-36"><a href="#cb91-36" tabindex="-1"></a>  <span class="co"># 生成多条链</span></span>
<span id="cb91-37"><a href="#cb91-37" tabindex="-1"></a>  chains <span class="ot">&lt;-</span> <span class="fu">lapply</span>(initial_values, <span class="cf">function</span>(init) <span class="fu">gibbs_sampler</span>(n, a, b, N, init))</span>
<span id="cb91-38"><a href="#cb91-38" tabindex="-1"></a>  </span>
<span id="cb91-39"><a href="#cb91-39" tabindex="-1"></a>  <span class="co"># 将每条链的后半段（去除burn-in）分别转化为mcmc对象</span></span>
<span id="cb91-40"><a href="#cb91-40" tabindex="-1"></a>  chains_x1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(chains, <span class="cf">function</span>(chain) <span class="fu">mcmc</span>(chain[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span>burn), <span class="dv">1</span>]))</span>
<span id="cb91-41"><a href="#cb91-41" tabindex="-1"></a>  chains_x2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(chains, <span class="cf">function</span>(chain) <span class="fu">mcmc</span>(chain[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span>burn), <span class="dv">2</span>]))</span>
<span id="cb91-42"><a href="#cb91-42" tabindex="-1"></a>  </span>
<span id="cb91-43"><a href="#cb91-43" tabindex="-1"></a>  <span class="co"># 创建mcmc.list对象</span></span>
<span id="cb91-44"><a href="#cb91-44" tabindex="-1"></a>  mcmc_chains_x1 <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(chains_x1)</span>
<span id="cb91-45"><a href="#cb91-45" tabindex="-1"></a>  mcmc_chains_x2 <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(chains_x2)</span>
<span id="cb91-46"><a href="#cb91-46" tabindex="-1"></a>  </span>
<span id="cb91-47"><a href="#cb91-47" tabindex="-1"></a>  <span class="co"># 计算Gelman-Rubin诊断的点估计值 (Point est.)</span></span>
<span id="cb91-48"><a href="#cb91-48" tabindex="-1"></a>  r_hat_x1_values[i] <span class="ot">&lt;-</span> <span class="fu">gelman.diag</span>(mcmc_chains_x1)<span class="sc">$</span>psrf[, <span class="st">&quot;Point est.&quot;</span>][<span class="dv">1</span>]</span>
<span id="cb91-49"><a href="#cb91-49" tabindex="-1"></a>  r_hat_x2_values[i] <span class="ot">&lt;-</span> <span class="fu">gelman.diag</span>(mcmc_chains_x2)<span class="sc">$</span>psrf[, <span class="st">&quot;Point est.&quot;</span>][<span class="dv">1</span>]</span>
<span id="cb91-50"><a href="#cb91-50" tabindex="-1"></a>}</span>
<span id="cb91-51"><a href="#cb91-51" tabindex="-1"></a></span>
<span id="cb91-52"><a href="#cb91-52" tabindex="-1"></a><span class="co"># 绘制N与R_hat的关系图</span></span>
<span id="cb91-53"><a href="#cb91-53" tabindex="-1"></a><span class="fu">plot</span>(sample_sizes, r_hat_x1_values, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb91-54"><a href="#cb91-54" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;样本数 (N)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;R_hat 值&quot;</span>,</span>
<span id="cb91-55"><a href="#cb91-55" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;样本数与Gelman-Rubin R_hat的关系 (X1 和 X2)&quot;</span>)</span>
<span id="cb91-56"><a href="#cb91-56" tabindex="-1"></a><span class="fu">lines</span>(sample_sizes, r_hat_x2_values, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb91-57"><a href="#cb91-57" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;X1&quot;</span>, <span class="st">&quot;X2&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>), <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb91-58"><a href="#cb91-58" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">1.2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)  <span class="co"># 添加1.2的参考线</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- -->
结果分析；</p>
<p>可以看出使用Gibbs采样得到的数据很快收敛。</p>
<p>附：
不引入包的情况下模仿书上的代码监视练习9.3柯西分布随机数的收敛。</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co">#清理内存</span></span>
<span id="cb92-2"><a href="#cb92-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb92-3"><a href="#cb92-3" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" tabindex="-1"></a>Gelman.Rubin <span class="ot">&lt;-</span> <span class="cf">function</span>(psi) {</span>
<span id="cb92-5"><a href="#cb92-5" tabindex="-1"></a>        <span class="co"># psi[i,j] is the statistic psi(X[i,1:j])</span></span>
<span id="cb92-6"><a href="#cb92-6" tabindex="-1"></a>        <span class="co"># for chain in i-th row of X</span></span>
<span id="cb92-7"><a href="#cb92-7" tabindex="-1"></a>        psi <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(psi)</span>
<span id="cb92-8"><a href="#cb92-8" tabindex="-1"></a>        n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(psi)</span>
<span id="cb92-9"><a href="#cb92-9" tabindex="-1"></a>        k <span class="ot">&lt;-</span> <span class="fu">nrow</span>(psi)</span>
<span id="cb92-10"><a href="#cb92-10" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" tabindex="-1"></a>        psi.means <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(psi)     <span class="co">#row means</span></span>
<span id="cb92-12"><a href="#cb92-12" tabindex="-1"></a>        B <span class="ot">&lt;-</span> n <span class="sc">*</span> <span class="fu">var</span>(psi.means)        <span class="co">#between variance est.</span></span>
<span id="cb92-13"><a href="#cb92-13" tabindex="-1"></a>        psi.w <span class="ot">&lt;-</span> <span class="fu">apply</span>(psi, <span class="dv">1</span>, <span class="st">&quot;var&quot;</span>)  <span class="co">#within variances</span></span>
<span id="cb92-14"><a href="#cb92-14" tabindex="-1"></a>        W <span class="ot">&lt;-</span> <span class="fu">mean</span>(psi.w)               <span class="co">#within est.</span></span>
<span id="cb92-15"><a href="#cb92-15" tabindex="-1"></a>        v.hat <span class="ot">&lt;-</span> W<span class="sc">*</span>(n<span class="dv">-1</span>)<span class="sc">/</span>n <span class="sc">+</span> (B<span class="sc">/</span>n)     <span class="co">#upper variance est.</span></span>
<span id="cb92-16"><a href="#cb92-16" tabindex="-1"></a>        r.hat <span class="ot">&lt;-</span> v.hat <span class="sc">/</span> W             <span class="co">#G-R statistic</span></span>
<span id="cb92-17"><a href="#cb92-17" tabindex="-1"></a>        <span class="fu">return</span>(r.hat)</span>
<span id="cb92-18"><a href="#cb92-18" tabindex="-1"></a>        }</span>
<span id="cb92-19"><a href="#cb92-19" tabindex="-1"></a></span>
<span id="cb92-20"><a href="#cb92-20" tabindex="-1"></a> </span>
<span id="cb92-21"><a href="#cb92-21" tabindex="-1"></a>  </span>
<span id="cb92-22"><a href="#cb92-22" tabindex="-1"></a>    normal.chain <span class="ot">&lt;-</span> <span class="cf">function</span>(sigma, N, X1) {</span>
<span id="cb92-23"><a href="#cb92-23" tabindex="-1"></a>      x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb92-24"><a href="#cb92-24" tabindex="-1"></a>      x[<span class="dv">1</span>]<span class="ot">=</span>X1</span>
<span id="cb92-25"><a href="#cb92-25" tabindex="-1"></a>      u <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb92-26"><a href="#cb92-26" tabindex="-1"></a>      </span>
<span id="cb92-27"><a href="#cb92-27" tabindex="-1"></a>     <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>N) {</span>
<span id="cb92-28"><a href="#cb92-28" tabindex="-1"></a>     xt <span class="ot">&lt;-</span> x[i<span class="dv">-1</span>]</span>
<span id="cb92-29"><a href="#cb92-29" tabindex="-1"></a>     y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> xt, <span class="at">sd =</span> sigma)</span>
<span id="cb92-30"><a href="#cb92-30" tabindex="-1"></a>     num <span class="ot">&lt;-</span> (<span class="fu">dcauchy</span>(y,<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">dnorm</span>(xt, y, sigma))</span>
<span id="cb92-31"><a href="#cb92-31" tabindex="-1"></a>     den <span class="ot">&lt;-</span> (<span class="fu">dcauchy</span>(xt,<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">dnorm</span>(y, xt, sigma))</span>
<span id="cb92-32"><a href="#cb92-32" tabindex="-1"></a>     </span>
<span id="cb92-33"><a href="#cb92-33" tabindex="-1"></a>     <span class="cf">if</span> (u[i] <span class="sc">&lt;=</span> num <span class="sc">/</span> den) {</span>
<span id="cb92-34"><a href="#cb92-34" tabindex="-1"></a>       x[i] <span class="ot">&lt;-</span> y</span>
<span id="cb92-35"><a href="#cb92-35" tabindex="-1"></a>     }</span>
<span id="cb92-36"><a href="#cb92-36" tabindex="-1"></a>     <span class="cf">else</span> {</span>
<span id="cb92-37"><a href="#cb92-37" tabindex="-1"></a>       x[i] <span class="ot">&lt;-</span> x[i<span class="dv">-1</span>]</span>
<span id="cb92-38"><a href="#cb92-38" tabindex="-1"></a>     }</span>
<span id="cb92-39"><a href="#cb92-39" tabindex="-1"></a>     }</span>
<span id="cb92-40"><a href="#cb92-40" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb92-41"><a href="#cb92-41" tabindex="-1"></a>}</span>
<span id="cb92-42"><a href="#cb92-42" tabindex="-1"></a></span>
<span id="cb92-43"><a href="#cb92-43" tabindex="-1"></a>    </span>
<span id="cb92-44"><a href="#cb92-44" tabindex="-1"></a>    </span>
<span id="cb92-45"><a href="#cb92-45" tabindex="-1"></a>    sigma <span class="ot">&lt;-</span> <span class="dv">1</span>     <span class="co">#parameter of proposal distribution</span></span>
<span id="cb92-46"><a href="#cb92-46" tabindex="-1"></a>    k <span class="ot">&lt;-</span> <span class="dv">4</span>          <span class="co">#number of chains to generate</span></span>
<span id="cb92-47"><a href="#cb92-47" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="dv">20000</span>      <span class="co">#length of chains</span></span>
<span id="cb92-48"><a href="#cb92-48" tabindex="-1"></a>    b <span class="ot">&lt;-</span> <span class="dv">1000</span>       <span class="co">#burn-in length</span></span>
<span id="cb92-49"><a href="#cb92-49" tabindex="-1"></a></span>
<span id="cb92-50"><a href="#cb92-50" tabindex="-1"></a>    <span class="co"># 初始值</span></span>
<span id="cb92-51"><a href="#cb92-51" tabindex="-1"></a>    x0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="sc">-</span><span class="dv">5</span> ,<span class="dv">5</span> , <span class="dv">10</span>)</span>
<span id="cb92-52"><a href="#cb92-52" tabindex="-1"></a></span>
<span id="cb92-53"><a href="#cb92-53" tabindex="-1"></a>    <span class="co">#生成链</span></span>
<span id="cb92-54"><a href="#cb92-54" tabindex="-1"></a>    <span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb92-55"><a href="#cb92-55" tabindex="-1"></a>    X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>k, <span class="at">ncol=</span>n)</span>
<span id="cb92-56"><a href="#cb92-56" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb92-57"><a href="#cb92-57" tabindex="-1"></a>        X[i, ] <span class="ot">&lt;-</span> <span class="fu">normal.chain</span>(sigma, n, x0[i])</span>
<span id="cb92-58"><a href="#cb92-58" tabindex="-1"></a>}</span>
<span id="cb92-59"><a href="#cb92-59" tabindex="-1"></a>    <span class="co">#compute diagnostic statistics</span></span>
<span id="cb92-60"><a href="#cb92-60" tabindex="-1"></a>    psi <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(X, <span class="dv">1</span>, cumsum))</span>
<span id="cb92-61"><a href="#cb92-61" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(psi)){</span>
<span id="cb92-62"><a href="#cb92-62" tabindex="-1"></a>        psi[i,] <span class="ot">&lt;-</span> psi[i,] <span class="sc">/</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(psi))</span>
<span id="cb92-63"><a href="#cb92-63" tabindex="-1"></a>}</span>
<span id="cb92-64"><a href="#cb92-64" tabindex="-1"></a>    <span class="co">#plot psi for the four chains</span></span>
<span id="cb92-65"><a href="#cb92-65" tabindex="-1"></a><span class="co">#    par(mfrow=c(2,2))</span></span>
<span id="cb92-66"><a href="#cb92-66" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k)</span>
<span id="cb92-67"><a href="#cb92-67" tabindex="-1"></a>      <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb92-68"><a href="#cb92-68" tabindex="-1"></a>        <span class="fu">plot</span>((b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n,psi[i, (b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n],<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>), <span class="at">type=</span><span class="st">&quot;l&quot;</span>,</span>
<span id="cb92-69"><a href="#cb92-69" tabindex="-1"></a>            <span class="at">xlab=</span><span class="st">&#39;Index&#39;</span>, <span class="at">ylab=</span><span class="fu">bquote</span>(phi))</span>
<span id="cb92-70"><a href="#cb92-70" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb92-71"><a href="#cb92-71" tabindex="-1"></a>        <span class="fu">lines</span>(psi[i, (b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n], <span class="at">col=</span>i)</span>
<span id="cb92-72"><a href="#cb92-72" tabindex="-1"></a>    }</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)) <span class="co">#restore default</span></span></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a>    <span class="co"># 计算R_hat的统计序列</span></span>
<span id="cb94-2"><a href="#cb94-2" tabindex="-1"></a>    rhat <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb94-3"><a href="#cb94-3" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> (b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n)</span>
<span id="cb94-4"><a href="#cb94-4" tabindex="-1"></a>        rhat[j] <span class="ot">&lt;-</span> <span class="fu">Gelman.Rubin</span>(psi[,<span class="dv">1</span><span class="sc">:</span>j])</span>
<span id="cb94-5"><a href="#cb94-5" tabindex="-1"></a>    <span class="fu">plot</span>(rhat[(b<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n], <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;R&quot;</span>)</span>
<span id="cb94-6"><a href="#cb94-6" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h=</span><span class="fl">1.1</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAASFBMVEUAAAAAADoAAGYAOpAAZrY6AAA6ADo6AGY6Ojo6kNtmAABmtv+QOgCQ2/+2ZgC2///bkDrbkJDb////tmb/25D//7b//9v///8ii+Y3AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAFNUlEQVR4nO3d63aaSgBAYdraS4wxtkbz/m9aFEmDOG6mzjCge/859HTWYL4FCEFs9W5Xq0q/gKknECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkEBQHtF9Vx76+Zno50ysKaFM9NQvbduH+iwHarz5YNt/+ZHgxUywGaLd8bhe3D7OTuQVBkceg0ybkMSjQbtm8iwW3n2o25QEae7p8CQTlBtoE3sUECswSvWuXzl0MEgjKBLSpd6LjqZDHoIttvrzUp0KLd4Eu11xq7Ff1aaJAl2ovVtff/gh0qY+L1fVCoIu1LPUlmUAXay/n9yuBMq+3dAJBAkECQQJBAkECQQJBAkECQQJBAkECQWWBZnD3p/AWJBBMF96EpnJzsfSd1QDD8X9PQqj8QfoCQ6s2BaHyQL2N6NOfJyA0AaAzog5KeaFJAH2C6G9Oadcb3USAWpi+R2mhqQA1Epc0CgtNByh45lNWaEJA4bElheYAFDqbHKVZAJXciGYCVG4jmgtQsavX+QC9lzGaFdD76dcBSV8JrTD5wPzTjfpJ9ExA+MzqzT/fWEp5gPiZ1dS/f0v1nFNvQBagAU8clr5ID+L2hg2eL2LdA55ZLQ80sBuAfgcf153FFjSwaKDN6cgb/PxqM4ieWW035+n/NxJo++Xl8AH6+ie/+rguP7M6dL2liwTarxbHQ8ymqqFGWW/pIoF2y6eD0q9qMdZ6SxcNdDi4rIc/Df9oz2qcgP776xTgNG2C/R/QrTvY3W9BAoUGCgQD2/ObQzd98c29Ag1rAONjA12/DomfrmTZfmEGh6lHB6qv1Z6v/v3DA408Xb4EggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEgkYGuvs7q+Ovt3QCQQJBAkECQQJBAkECQQJBAkECQQJBAkECQdk+YQYf9HxwoLEeyRyhLEAP/UDdkHwkE3ILogY8khkzXckyvYs97COZ46+3dAJBuYEe7ZHMm1fnjcMy0+VLIMiLVciLVajYpcZsygE04GI1dtL0rzP1Npx4C4qd9L6ABlysxk56Z0B8sRo76b0BJZ9UoFQjBRp9YKH5IicVKNXI+wK6pwSCBIIEggSCBIIEggSCBIIEggSCBIIEgtIDbavw15o3v7JdfB7VX4jo7edrhlk7JQc6fDv+NvSa3n68nI3qL0S0Wx7vPiWetVtqoObWUOh7hdvbaR+j+gsRbU/3wNPOelZqoLfvhztDoY8PbRZno/oLw1e1rZ4amqSznpcc6Li5h268rn9Vx3+X4mNUfyFqbc341LN2Sg3U7PCB3X63PNxQWz/9G9VfiFvb4UdPPmunUYFOQ76+JgVKPmuncXexZsj357S7WOpZO417kG6G/HhJdTj9DJRu1k6jvs03r7f+qVK9IR+Bks/aadwTxeNLrQ+nqU7pTu9iiWftlP5SY3Pt5H5dvyE/d0b1FyI67WKJZ+3kxSokECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQ9Bf0V5co/0MgpAAAAABJRU5ErkJggg==" /><!-- --></p>
<p>分析：</p>
<p>可以看出，psi基本上收敛到一个值，但是R_hat却始终不能小于1.2，原因可能是柯西分布的性质导致其难以收敛。</p>
</div>
</div>
<div id="a-sc24002027-2024-11-04" class="section level1">
<h1>A-SC24002027-2024-11-04</h1>
<div id="question-1-6" class="section level2">
<h2>Question 1</h2>
<ol style="list-style-type: lower-alpha">
<li>Write a function to compute the <span class="math inline">\(k^{\text{th}}\)</span> term in</li>
</ol>
<p><span class="math display">\[
\sum_{k=0}^{\infty}\frac{(-1)^{k}}{k! 2^{k}}\frac{\|a\|^{2 k+2}}{(2
k+1)(2
k+2)}\frac{\Gamma\left(\frac{d+1}{2}\right)\Gamma\left(k+\frac{3}{2}\right)}{\Gamma\left(k+\frac{d}{2}+1\right)},
\]</span></p>
<p>where <span class="math inline">\(d \geq 1\)</span> is an integer, a
is a vector in <span class="math inline">\(R^{d}\)</span>, and <span class="math inline">\(\|\cdot\|\)</span> denotes the Euclidean norm.
Perform the arithmetic so that the coefficients can be computed for
(almost) arbitrarily large k and d. (This sum converges for all <span class="math inline">\(a \in R^d\)</span>).</p>
<ol start="2" style="list-style-type: lower-alpha">
<li><p>Modify the function so that it computes and returns the
sum.</p></li>
<li><p>Evaluate the sum when <span class="math inline">\(a = (1,
2)^T\)</span>.</p></li>
</ol>
</div>
<div id="answer-20" class="section level2">
<h2>Answer</h2>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb95-2"><a href="#cb95-2" tabindex="-1"></a><span class="co"># 计算第k项</span></span>
<span id="cb95-3"><a href="#cb95-3" tabindex="-1"></a>compute_kth_term <span class="ot">&lt;-</span> <span class="cf">function</span>(k, d, a) {</span>
<span id="cb95-4"><a href="#cb95-4" tabindex="-1"></a>  norm_a <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(a<span class="sc">^</span><span class="dv">2</span>)) <span class="co"># 计算a的欧几里得范数</span></span>
<span id="cb95-5"><a href="#cb95-5" tabindex="-1"></a>  term <span class="ot">&lt;-</span> ((<span class="sc">-</span><span class="dv">1</span>)<span class="sc">^</span>k <span class="sc">/</span> (<span class="fu">factorial</span>(k) <span class="sc">*</span> <span class="dv">2</span><span class="sc">^</span>k)) <span class="sc">*</span> ((norm_a<span class="sc">^</span>(<span class="dv">2</span><span class="sc">*</span>k <span class="sc">+</span> <span class="dv">2</span>)) <span class="sc">/</span> ((<span class="dv">2</span><span class="sc">*</span>k <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> (<span class="dv">2</span><span class="sc">*</span>k <span class="sc">+</span> <span class="dv">2</span>))) <span class="sc">*</span> </span>
<span id="cb95-6"><a href="#cb95-6" tabindex="-1"></a>    <span class="fu">gamma</span>((d <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">gamma</span>(k <span class="sc">+</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">gamma</span>(k <span class="sc">+</span> d<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb95-7"><a href="#cb95-7" tabindex="-1"></a>  <span class="fu">return</span>(term)</span>
<span id="cb95-8"><a href="#cb95-8" tabindex="-1"></a>}</span>
<span id="cb95-9"><a href="#cb95-9" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" tabindex="-1"></a><span class="co"># 计算前k项和</span></span>
<span id="cb95-11"><a href="#cb95-11" tabindex="-1"></a>compute_series_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(max_k, d, a) {</span>
<span id="cb95-12"><a href="#cb95-12" tabindex="-1"></a>  sum_value <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb95-13"><a href="#cb95-13" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>max_k) {</span>
<span id="cb95-14"><a href="#cb95-14" tabindex="-1"></a>    sum_value <span class="ot">&lt;-</span> sum_value <span class="sc">+</span> <span class="fu">compute_kth_term</span>(k, d, a)</span>
<span id="cb95-15"><a href="#cb95-15" tabindex="-1"></a>  }</span>
<span id="cb95-16"><a href="#cb95-16" tabindex="-1"></a>  <span class="fu">return</span>(sum_value)</span>
<span id="cb95-17"><a href="#cb95-17" tabindex="-1"></a>}</span>
<span id="cb95-18"><a href="#cb95-18" tabindex="-1"></a></span>
<span id="cb95-19"><a href="#cb95-19" tabindex="-1"></a><span class="co"># 给定a计算总和</span></span>
<span id="cb95-20"><a href="#cb95-20" tabindex="-1"></a>a<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb95-21"><a href="#cb95-21" tabindex="-1"></a>max_k <span class="ot">&lt;-</span> <span class="dv">100</span> </span>
<span id="cb95-22"><a href="#cb95-22" tabindex="-1"></a>sum_result <span class="ot">&lt;-</span> <span class="fu">compute_series_sum</span>(max_k, <span class="fu">length</span>(a), a)</span>
<span id="cb95-23"><a href="#cb95-23" tabindex="-1"></a><span class="fu">print</span>(sum_result)</span></code></pre></div>
<pre><code>## [1] 1.532164</code></pre>
<p>结果：1.532164</p>
</div>
<div id="question-2-6" class="section level2">
<h2>Question 2</h2>
<p>Write a function to solve the equation</p>
<p><span class="math display">\[
\begin{align*}
\frac{2\Gamma\left(\frac{k}{2}\right)}{\sqrt{\pi(k-1)}\Gamma\left(\frac{k-1}{2}\right)}
&amp;\int_{0}^{c_{k-1}}\left(1+\frac{u^{2}}{k-1}\right)^{-k/2} du \\
&amp;= \frac{2\Gamma\left(\frac{k+1}{2}\right)}{\sqrt{\pi
k}\Gamma\left(\frac{k}{2}\right)}\int_{0}^{c_{k}}\left(1+\frac{u^{2}}{k}\right)^{-(k+1)/2}
du
\end{align*}
\]</span></p>
<p>for a, where</p>
<p><span class="math display">\[
c_k = \sqrt{\frac{a^2 k}{k+1-a^2}}.
\]</span> Compare the solutions with the points <span class="math inline">\(A(k)\)</span> in Exercise 11.4.</p>
</div>
<div id="answer-21" class="section level2">
<h2>Answer</h2>
<p>步骤： 1. 写出c_k、积分部分的函数。 2.
由于方程两边形式相同，仅取决于k还是k+1，列出左边或右边的函数。 3.
左边减右边，并使用uniroot找零点，零点就是方程的根。</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb97-2"><a href="#cb97-2" tabindex="-1"></a>solve_equation <span class="ot">=</span> <span class="cf">function</span> (k) {</span>
<span id="cb97-3"><a href="#cb97-3" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" tabindex="-1"></a>  <span class="co"># 函数中的积分部分</span></span>
<span id="cb97-5"><a href="#cb97-5" tabindex="-1"></a>  integration <span class="ot">=</span> <span class="cf">function</span>(u, n) {</span>
<span id="cb97-6"><a href="#cb97-6" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">+</span> u<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>(n<span class="dv">-1</span>))<span class="sc">^</span>(<span class="sc">-</span>n<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb97-7"><a href="#cb97-7" tabindex="-1"></a>  }</span>
<span id="cb97-8"><a href="#cb97-8" tabindex="-1"></a>  </span>
<span id="cb97-9"><a href="#cb97-9" tabindex="-1"></a>  <span class="co"># c_k</span></span>
<span id="cb97-10"><a href="#cb97-10" tabindex="-1"></a>  c_k <span class="ot">=</span> <span class="cf">function</span> (n, a) {</span>
<span id="cb97-11"><a href="#cb97-11" tabindex="-1"></a>    <span class="fu">sqrt</span>(a<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> n <span class="sc">/</span> (n <span class="sc">+</span> <span class="dv">1</span> <span class="sc">-</span> a<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb97-12"><a href="#cb97-12" tabindex="-1"></a>  }</span>
<span id="cb97-13"><a href="#cb97-13" tabindex="-1"></a>  </span>
<span id="cb97-14"><a href="#cb97-14" tabindex="-1"></a>  <span class="co"># 等号两边的函数有相同的形式，区别在于k或者k+1</span></span>
<span id="cb97-15"><a href="#cb97-15" tabindex="-1"></a>  left_right <span class="ot">=</span> <span class="cf">function</span> (n, a) {</span>
<span id="cb97-16"><a href="#cb97-16" tabindex="-1"></a>    </span>
<span id="cb97-17"><a href="#cb97-17" tabindex="-1"></a>    this_integral <span class="ot">=</span> <span class="cf">function</span> (u) {</span>
<span id="cb97-18"><a href="#cb97-18" tabindex="-1"></a>      <span class="fu">integration</span>(u, n)</span>
<span id="cb97-19"><a href="#cb97-19" tabindex="-1"></a>    }</span>
<span id="cb97-20"><a href="#cb97-20" tabindex="-1"></a>    </span>
<span id="cb97-21"><a href="#cb97-21" tabindex="-1"></a>    c <span class="ot">=</span> <span class="fu">c_k</span>(n <span class="sc">-</span> <span class="dv">1</span>, a)</span>
<span id="cb97-22"><a href="#cb97-22" tabindex="-1"></a>    </span>
<span id="cb97-23"><a href="#cb97-23" tabindex="-1"></a>    <span class="dv">2</span><span class="sc">/</span><span class="fu">sqrt</span>(pi<span class="sc">*</span>(n<span class="dv">-1</span>)) <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">lgamma</span>(n<span class="sc">/</span><span class="dv">2</span>)<span class="sc">-</span><span class="fu">lgamma</span>((n<span class="dv">-1</span>)<span class="sc">/</span><span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">integrate</span>(this_integral, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> c)<span class="sc">$</span>value</span>
<span id="cb97-24"><a href="#cb97-24" tabindex="-1"></a>  }</span>
<span id="cb97-25"><a href="#cb97-25" tabindex="-1"></a>  </span>
<span id="cb97-26"><a href="#cb97-26" tabindex="-1"></a><span class="co"># 计算等号两边函数的差</span></span>
<span id="cb97-27"><a href="#cb97-27" tabindex="-1"></a>  f <span class="ot">=</span> <span class="cf">function</span> (a) {</span>
<span id="cb97-28"><a href="#cb97-28" tabindex="-1"></a>    left <span class="ot">=</span> <span class="fu">left_right</span>(k, a)</span>
<span id="cb97-29"><a href="#cb97-29" tabindex="-1"></a>    right <span class="ot">=</span> <span class="fu">left_right</span>(k <span class="sc">+</span> <span class="dv">1</span>, a)</span>
<span id="cb97-30"><a href="#cb97-30" tabindex="-1"></a>    <span class="fu">return</span> (left <span class="sc">-</span> right)</span>
<span id="cb97-31"><a href="#cb97-31" tabindex="-1"></a>  }</span>
<span id="cb97-32"><a href="#cb97-32" tabindex="-1"></a>  </span>
<span id="cb97-33"><a href="#cb97-33" tabindex="-1"></a><span class="co"># 找零点，计算根</span></span>
<span id="cb97-34"><a href="#cb97-34" tabindex="-1"></a>  eps <span class="ot">=</span> <span class="fl">1e-2</span></span>
<span id="cb97-35"><a href="#cb97-35" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">f</span>(eps) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">f</span>(<span class="fu">sqrt</span>(k) <span class="sc">-</span> eps) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">f</span>(eps) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">f</span>(<span class="fu">sqrt</span>(k) <span class="sc">-</span> eps) <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb97-36"><a href="#cb97-36" tabindex="-1"></a>    r <span class="ot">=</span> <span class="fu">uniroot</span>(f, <span class="at">interval =</span> <span class="fu">c</span>(eps, <span class="fu">sqrt</span>(k)<span class="sc">-</span>eps))<span class="sc">$</span>root</span>
<span id="cb97-37"><a href="#cb97-37" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb97-38"><a href="#cb97-38" tabindex="-1"></a>    r <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb97-39"><a href="#cb97-39" tabindex="-1"></a>  }</span>
<span id="cb97-40"><a href="#cb97-40" tabindex="-1"></a>  <span class="fu">return</span>(r)</span>
<span id="cb97-41"><a href="#cb97-41" tabindex="-1"></a>}</span>
<span id="cb97-42"><a href="#cb97-42" tabindex="-1"></a></span>
<span id="cb97-43"><a href="#cb97-43" tabindex="-1"></a><span class="co"># 把11.4中的值带入</span></span>
<span id="cb97-44"><a href="#cb97-44" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">sapply</span>(<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">25</span>, <span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1000</span>), <span class="cf">function</span> (k) {</span>
<span id="cb97-45"><a href="#cb97-45" tabindex="-1"></a>  <span class="fu">solve_equation</span>(k)</span>
<span id="cb97-46"><a href="#cb97-46" tabindex="-1"></a>})</span>
<span id="cb97-47"><a href="#cb97-47" tabindex="-1"></a><span class="fu">print</span>(result)</span></code></pre></div>
<pre><code>##  [1] 1.492073 1.533555 1.562745 1.584429 1.601184 1.614516 1.625389 1.634418
##  [9] 1.642026 1.648552 1.654175 1.659099 1.663454 1.667287       NA 1.673832
## [17] 1.676605 1.679148 1.681468 1.683593 1.685546 1.687366       NA       NA
## [25] 1.730903</code></pre>
</div>
<div id="question-3-6" class="section level2">
<h2>Question 3</h2>
<p>Suppose $ T_1, , T_n $ are i.i.d. samples drawn from the exponential
distribution with expectation $ $. Those values greater than $ $ are not
observed due to right censorship, so that the observed values are $ Y_i
= T_i I(T_i ) + I(T_i &gt; ) $, $ i = 1, , n $. Suppose $ = 1 $ and the
observed $ Y_i $ values are as follows:</p>
<p>0.54, 0.48, 0.33, 0.43, 1.00, 1.00, 0.91, 1.00, 0.21, 0.85</p>
<p>Use the E-M algorithm to estimate $ $, compare your result with the
observed data MLE (note: $ Y_i $ follows a mixture distribution).</p>
</div>
<div id="answer-22" class="section level2">
<h2>Answer</h2>
<p>步骤： 1. 设定<span class="math inline">\(\lambda\)</span>初始值，和其他数据。 2.
数用期望来处理被截去数据 3. 更新参数 4. 循环3，4直到收敛 5. 计算结果</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb99-2"><a href="#cb99-2" tabindex="-1"></a><span class="co"># 观测到的数据</span></span>
<span id="cb99-3"><a href="#cb99-3" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.54</span>, <span class="fl">0.48</span>, <span class="fl">0.33</span>, <span class="fl">0.43</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">0.91</span>, <span class="fl">1.00</span>, <span class="fl">0.21</span>, <span class="fl">0.85</span>)</span>
<span id="cb99-4"><a href="#cb99-4" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" tabindex="-1"></a><span class="co"># 截断值</span></span>
<span id="cb99-6"><a href="#cb99-6" tabindex="-1"></a>tau <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb99-7"><a href="#cb99-7" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" tabindex="-1"></a><span class="co"># 初始化lambda的值，使用没有被截断的数据的均值</span></span>
<span id="cb99-9"><a href="#cb99-9" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y[Y <span class="sc">&lt;</span> tau])</span>
<span id="cb99-10"><a href="#cb99-10" tabindex="-1"></a></span>
<span id="cb99-11"><a href="#cb99-11" tabindex="-1"></a><span class="co"># 设置EM算法的参数</span></span>
<span id="cb99-12"><a href="#cb99-12" tabindex="-1"></a>tolerance <span class="ot">&lt;-</span> <span class="fl">1e-6</span></span>
<span id="cb99-13"><a href="#cb99-13" tabindex="-1"></a>max_iter <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb99-14"><a href="#cb99-14" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb99-15"><a href="#cb99-15" tabindex="-1"></a>diff <span class="ot">&lt;-</span> tolerance <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb99-16"><a href="#cb99-16" tabindex="-1"></a></span>
<span id="cb99-17"><a href="#cb99-17" tabindex="-1"></a><span class="co"># EM算法</span></span>
<span id="cb99-18"><a href="#cb99-18" tabindex="-1"></a><span class="cf">while</span> (diff <span class="sc">&gt;</span> tolerance <span class="sc">&amp;&amp;</span> iter <span class="sc">&lt;</span> max_iter) {</span>
<span id="cb99-19"><a href="#cb99-19" tabindex="-1"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb99-20"><a href="#cb99-20" tabindex="-1"></a>  lambda_old <span class="ot">&lt;-</span> lambda</span>
<span id="cb99-21"><a href="#cb99-21" tabindex="-1"></a>  </span>
<span id="cb99-22"><a href="#cb99-22" tabindex="-1"></a>  <span class="co"># E步骤：计算被截断的概率</span></span>
<span id="cb99-23"><a href="#cb99-23" tabindex="-1"></a>  uncensored <span class="ot">&lt;-</span> Y[Y <span class="sc">&lt;</span> tau] <span class="co"># 没有被截断的数据</span></span>
<span id="cb99-24"><a href="#cb99-24" tabindex="-1"></a>  censored <span class="ot">&lt;-</span> Y[Y <span class="sc">==</span> tau]  <span class="co"># 被截断的数据</span></span>
<span id="cb99-25"><a href="#cb99-25" tabindex="-1"></a>  </span>
<span id="cb99-26"><a href="#cb99-26" tabindex="-1"></a>  <span class="co"># 对于指数分布的数据计算被截断数据的期望</span></span>
<span id="cb99-27"><a href="#cb99-27" tabindex="-1"></a>  E_censored <span class="ot">&lt;-</span> tau <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> lambda_old</span>
<span id="cb99-28"><a href="#cb99-28" tabindex="-1"></a>  </span>
<span id="cb99-29"><a href="#cb99-29" tabindex="-1"></a>  <span class="co"># M步骤：更新lambda</span></span>
<span id="cb99-30"><a href="#cb99-30" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> <span class="fu">length</span>(Y) <span class="sc">/</span> (<span class="fu">sum</span>(uncensored) <span class="sc">+</span> <span class="fu">length</span>(censored) <span class="sc">*</span> E_censored)</span>
<span id="cb99-31"><a href="#cb99-31" tabindex="-1"></a>  </span>
<span id="cb99-32"><a href="#cb99-32" tabindex="-1"></a>  <span class="co"># 检查收敛性</span></span>
<span id="cb99-33"><a href="#cb99-33" tabindex="-1"></a>  diff <span class="ot">&lt;-</span> <span class="fu">abs</span>(lambda <span class="sc">-</span> lambda_old)</span>
<span id="cb99-34"><a href="#cb99-34" tabindex="-1"></a>}</span>
<span id="cb99-35"><a href="#cb99-35" tabindex="-1"></a></span>
<span id="cb99-36"><a href="#cb99-36" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb99-37"><a href="#cb99-37" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;通过EM算法估计的lambda:&quot;</span>, lambda, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 通过EM算法估计的lambda: 1.037037</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" tabindex="-1"></a><span class="co"># 使用观测数据的MLE估计</span></span>
<span id="cb101-2"><a href="#cb101-2" tabindex="-1"></a>lambda_mle <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">mean</span>(Y)</span>
<span id="cb101-3"><a href="#cb101-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;观测数据的MLE估计的lambda:&quot;</span>, lambda_mle, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 观测数据的MLE估计的lambda: 1.481481</code></pre>
<p>对比两个结果可以看出，法EM算法能够更准确地估计<span class="math inline">\(\lambda\)</span>，因为它利用了截断数据的隐含信息，修正了MLE估计的偏差。</p>
</div>
</div>
<div id="a-sc24002027-2024-11-11" class="section level1">
<h1>A-SC24002027-2024-11-11</h1>
<div id="question-1-7" class="section level2">
<h2>Question 1</h2>
<p>11.7</p>
<p>Use the simplex algorithm to solve the following problem. Minimize
<span class="math inline">\(4x + 2y + 9z\)</span> subject to <span class="math display">\[
2x + y + z \leq 2 \\
x - y + 3z \leq 3 \\
x \geq 0, \quad y \geq 0, \quad z \geq 0.
\]</span></p>
</div>
<div id="answer-23" class="section level2">
<h2>Answer</h2>
<p>思路：使用lp包解决线性规划问题。</p>
<ol style="list-style-type: decimal">
<li><p>定义目标函数的系数
(最小化目标)，定义约束矩阵，定义约束的右侧值，定义约束方向</p></li>
<li><p>用lp求解线性规划</p></li>
</ol>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># 清理缓存</span></span>
<span id="cb103-2"><a href="#cb103-2" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" tabindex="-1"></a><span class="co"># 加载 lpSolve 包</span></span>
<span id="cb103-4"><a href="#cb103-4" tabindex="-1"></a><span class="fu">library</span>(lpSolve)</span>
<span id="cb103-5"><a href="#cb103-5" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" tabindex="-1"></a><span class="co"># 定义目标函数的系数 (最小化目标)</span></span>
<span id="cb103-7"><a href="#cb103-7" tabindex="-1"></a>obj_coef <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">9</span>)</span>
<span id="cb103-8"><a href="#cb103-8" tabindex="-1"></a></span>
<span id="cb103-9"><a href="#cb103-9" tabindex="-1"></a><span class="co"># 定义约束矩阵</span></span>
<span id="cb103-10"><a href="#cb103-10" tabindex="-1"></a>constraints <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb103-11"><a href="#cb103-11" tabindex="-1"></a>  <span class="dv">2</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="co"># 2x + y + z &lt;= 2</span></span>
<span id="cb103-12"><a href="#cb103-12" tabindex="-1"></a>  <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>,  <span class="dv">3</span>   <span class="co"># x - y + 3z &lt;= 3</span></span>
<span id="cb103-13"><a href="#cb103-13" tabindex="-1"></a>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-14"><a href="#cb103-14" tabindex="-1"></a></span>
<span id="cb103-15"><a href="#cb103-15" tabindex="-1"></a><span class="co"># 定义约束的右侧值</span></span>
<span id="cb103-16"><a href="#cb103-16" tabindex="-1"></a>rhs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb103-17"><a href="#cb103-17" tabindex="-1"></a></span>
<span id="cb103-18"><a href="#cb103-18" tabindex="-1"></a><span class="co"># 定义约束方向</span></span>
<span id="cb103-19"><a href="#cb103-19" tabindex="-1"></a>directions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;&lt;=&quot;</span>, <span class="st">&quot;&lt;=&quot;</span>)</span>
<span id="cb103-20"><a href="#cb103-20" tabindex="-1"></a></span>
<span id="cb103-21"><a href="#cb103-21" tabindex="-1"></a><span class="co"># 求解线性规划</span></span>
<span id="cb103-22"><a href="#cb103-22" tabindex="-1"></a>solution <span class="ot">&lt;-</span> <span class="fu">lp</span>(<span class="st">&quot;min&quot;</span>, obj_coef, constraints, directions, rhs, <span class="at">compute.sens =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-23"><a href="#cb103-23" tabindex="-1"></a></span>
<span id="cb103-24"><a href="#cb103-24" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb103-25"><a href="#cb103-25" tabindex="-1"></a><span class="cf">if</span> (solution<span class="sc">$</span>status <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb103-26"><a href="#cb103-26" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;目标函数最小值：&quot;</span>, solution<span class="sc">$</span>objval, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb103-27"><a href="#cb103-27" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;决策变量的取值：</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb103-28"><a href="#cb103-28" tabindex="-1"></a>  <span class="fu">print</span>(solution<span class="sc">$</span>solution)</span>
<span id="cb103-29"><a href="#cb103-29" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb103-30"><a href="#cb103-30" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;未找到最优解。</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb103-31"><a href="#cb103-31" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## 目标函数最小值： 0 
## 决策变量的取值：
## [1] 0 0 0</code></pre>
<p>结果：根据结果可知，目标函数最小值为0，此时x、y、z的取值均为零。</p>
</div>
<div id="question-2-7" class="section level2">
<h2>Question 2</h2>
<ol start="3" style="list-style-type: decimal">
<li>Use both for loops and lapply() to fit linear models to the mtcars
using the formulas stored in this list:</li>
</ol>
<p>formulas &lt;- list( mpg ~ disp, mpg ~ I(1 / disp), mpg ~ disp + wt,
mpg ~ I(1 / disp) + wt )</p>
<ol start="4" style="list-style-type: decimal">
<li>Fit the model mpg ~ disp to each of the bootstrap replicates of
mtcars in the list below by using a for loop and lapply(). Can you do it
without an anonymous function?</li>
</ol>
<p>bootstraps &lt;- lapply(1:10, function(i) { rows &lt;-
sample(1:nrow(mtcars), rep = TRUE) mtcars[rows, ] })</p>
<ol start="5" style="list-style-type: decimal">
<li>For each model in the previous two exercises, extract <span class="math inline">\(R^2\)</span> using the function below.</li>
</ol>
<p>rsq &lt;- function(mod) summary(mod)$r.squared</p>
</div>
<div id="answer-24" class="section level2">
<h2>Answer</h2>
<ol start="3" style="list-style-type: decimal">
<li>使用 for 循环和 lapply 分别对公式中的公式线性拟合。</li>
</ol>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># 清理缓存</span></span>
<span id="cb105-2"><a href="#cb105-2" tabindex="-1"></a><span class="co"># 准备数据和公式</span></span>
<span id="cb105-3"><a href="#cb105-3" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb105-4"><a href="#cb105-4" tabindex="-1"></a>formulas <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb105-5"><a href="#cb105-5" tabindex="-1"></a>  mpg <span class="sc">~</span> disp,</span>
<span id="cb105-6"><a href="#cb105-6" tabindex="-1"></a>  mpg <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">/</span> disp),</span>
<span id="cb105-7"><a href="#cb105-7" tabindex="-1"></a>  mpg <span class="sc">~</span> disp <span class="sc">+</span> wt,</span>
<span id="cb105-8"><a href="#cb105-8" tabindex="-1"></a>  mpg <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">/</span> disp) <span class="sc">+</span> wt</span>
<span id="cb105-9"><a href="#cb105-9" tabindex="-1"></a>)</span>
<span id="cb105-10"><a href="#cb105-10" tabindex="-1"></a></span>
<span id="cb105-11"><a href="#cb105-11" tabindex="-1"></a><span class="co"># 使用 for 循环</span></span>
<span id="cb105-12"><a href="#cb105-12" tabindex="-1"></a>models_for <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb105-13"><a href="#cb105-13" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(formulas)) {</span>
<span id="cb105-14"><a href="#cb105-14" tabindex="-1"></a>  models_for[[i]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(formulas[[i]], <span class="at">data =</span> mtcars)</span>
<span id="cb105-15"><a href="#cb105-15" tabindex="-1"></a>}</span>
<span id="cb105-16"><a href="#cb105-16" tabindex="-1"></a></span>
<span id="cb105-17"><a href="#cb105-17" tabindex="-1"></a><span class="co"># 使用 lapply()</span></span>
<span id="cb105-18"><a href="#cb105-18" tabindex="-1"></a>models_lapply <span class="ot">&lt;-</span> <span class="fu">lapply</span>(formulas, <span class="cf">function</span>(formula) <span class="fu">lm</span>(formula, <span class="at">data =</span> mtcars))</span>
<span id="cb105-19"><a href="#cb105-19" tabindex="-1"></a></span>
<span id="cb105-20"><a href="#cb105-20" tabindex="-1"></a><span class="co"># 查看结果</span></span>
<span id="cb105-21"><a href="#cb105-21" tabindex="-1"></a>models_for</span></code></pre></div>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = formulas[[i]], data = mtcars)
## 
## Coefficients:
## (Intercept)         disp  
##    29.59985     -0.04122  
## 
## 
## [[2]]
## 
## Call:
## lm(formula = formulas[[i]], data = mtcars)
## 
## Coefficients:
## (Intercept)    I(1/disp)  
##       10.75      1557.67  
## 
## 
## [[3]]
## 
## Call:
## lm(formula = formulas[[i]], data = mtcars)
## 
## Coefficients:
## (Intercept)         disp           wt  
##    34.96055     -0.01772     -3.35083  
## 
## 
## [[4]]
## 
## Call:
## lm(formula = formulas[[i]], data = mtcars)
## 
## Coefficients:
## (Intercept)    I(1/disp)           wt  
##      19.024     1142.560       -1.798</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" tabindex="-1"></a>models_lapply</span></code></pre></div>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = formula, data = mtcars)
## 
## Coefficients:
## (Intercept)         disp  
##    29.59985     -0.04122  
## 
## 
## [[2]]
## 
## Call:
## lm(formula = formula, data = mtcars)
## 
## Coefficients:
## (Intercept)    I(1/disp)  
##       10.75      1557.67  
## 
## 
## [[3]]
## 
## Call:
## lm(formula = formula, data = mtcars)
## 
## Coefficients:
## (Intercept)         disp           wt  
##    34.96055     -0.01772     -3.35083  
## 
## 
## [[4]]
## 
## Call:
## lm(formula = formula, data = mtcars)
## 
## Coefficients:
## (Intercept)    I(1/disp)           wt  
##      19.024     1142.560       -1.798</code></pre>
<p>二者得到的结果相同。</p>
<ol start="4" style="list-style-type: decimal">
<li>使用 for 循环和 lapply() 对 bootstraps 中的每个样本拟合线性模型</li>
</ol>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" tabindex="-1"></a><span class="co"># 创建 bootstrap 样本</span></span>
<span id="cb109-2"><a href="#cb109-2" tabindex="-1"></a>bootstraps <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(i) {</span>
<span id="cb109-3"><a href="#cb109-3" tabindex="-1"></a>  rows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mtcars), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb109-4"><a href="#cb109-4" tabindex="-1"></a>  mtcars[rows, ]</span>
<span id="cb109-5"><a href="#cb109-5" tabindex="-1"></a>})</span>
<span id="cb109-6"><a href="#cb109-6" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" tabindex="-1"></a><span class="co"># 使用 for 循环</span></span>
<span id="cb109-8"><a href="#cb109-8" tabindex="-1"></a>bootstrap_models_for <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb109-9"><a href="#cb109-9" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(bootstraps)) {</span>
<span id="cb109-10"><a href="#cb109-10" tabindex="-1"></a>  bootstrap_models_for[[i]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> disp, <span class="at">data =</span> bootstraps[[i]])</span>
<span id="cb109-11"><a href="#cb109-11" tabindex="-1"></a>}</span>
<span id="cb109-12"><a href="#cb109-12" tabindex="-1"></a></span>
<span id="cb109-13"><a href="#cb109-13" tabindex="-1"></a><span class="co"># 使用 lapply()</span></span>
<span id="cb109-14"><a href="#cb109-14" tabindex="-1"></a>bootstrap_models_lapply <span class="ot">&lt;-</span> <span class="fu">lapply</span>(bootstraps, lm, <span class="at">formula =</span> mpg <span class="sc">~</span> disp)</span>
<span id="cb109-15"><a href="#cb109-15" tabindex="-1"></a></span>
<span id="cb109-16"><a href="#cb109-16" tabindex="-1"></a><span class="co"># 查看结果</span></span>
<span id="cb109-17"><a href="#cb109-17" tabindex="-1"></a>bootstrap_models_for</span></code></pre></div>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = mpg ~ disp, data = bootstraps[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    30.71583     -0.04754  
## 
## 
## [[2]]
## 
## Call:
## lm(formula = mpg ~ disp, data = bootstraps[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    29.12901     -0.03887  
## 
## 
## [[3]]
## 
## Call:
## lm(formula = mpg ~ disp, data = bootstraps[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    28.92955     -0.03931  
## 
## 
## [[4]]
## 
## Call:
## lm(formula = mpg ~ disp, data = bootstraps[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    29.00030     -0.04009  
## 
## 
## [[5]]
## 
## Call:
## lm(formula = mpg ~ disp, data = bootstraps[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    29.77164     -0.04595  
## 
## 
## [[6]]
## 
## Call:
## lm(formula = mpg ~ disp, data = bootstraps[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    30.87715     -0.04654  
## 
## 
## [[7]]
## 
## Call:
## lm(formula = mpg ~ disp, data = bootstraps[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    29.39201     -0.04136  
## 
## 
## [[8]]
## 
## Call:
## lm(formula = mpg ~ disp, data = bootstraps[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    28.69369     -0.03786  
## 
## 
## [[9]]
## 
## Call:
## lm(formula = mpg ~ disp, data = bootstraps[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##     28.7887      -0.0385  
## 
## 
## [[10]]
## 
## Call:
## lm(formula = mpg ~ disp, data = bootstraps[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    28.74223     -0.03774</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" tabindex="-1"></a>bootstrap_models_lapply</span></code></pre></div>
<pre><code>## [[1]]
## 
## Call:
## FUN(formula = ..1, data = X[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    30.71583     -0.04754  
## 
## 
## [[2]]
## 
## Call:
## FUN(formula = ..1, data = X[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    29.12901     -0.03887  
## 
## 
## [[3]]
## 
## Call:
## FUN(formula = ..1, data = X[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    28.92955     -0.03931  
## 
## 
## [[4]]
## 
## Call:
## FUN(formula = ..1, data = X[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    29.00030     -0.04009  
## 
## 
## [[5]]
## 
## Call:
## FUN(formula = ..1, data = X[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    29.77164     -0.04595  
## 
## 
## [[6]]
## 
## Call:
## FUN(formula = ..1, data = X[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    30.87715     -0.04654  
## 
## 
## [[7]]
## 
## Call:
## FUN(formula = ..1, data = X[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    29.39201     -0.04136  
## 
## 
## [[8]]
## 
## Call:
## FUN(formula = ..1, data = X[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    28.69369     -0.03786  
## 
## 
## [[9]]
## 
## Call:
## FUN(formula = ..1, data = X[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##     28.7887      -0.0385  
## 
## 
## [[10]]
## 
## Call:
## FUN(formula = ..1, data = X[[i]])
## 
## Coefficients:
## (Intercept)         disp  
##    28.74223     -0.03774</code></pre>
<p>二者得到的结果相同。</p>
<ol start="5" style="list-style-type: decimal">
<li>提取 <span class="math inline">\(R^2\)</span></li>
</ol>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a><span class="co"># 定义 R^2 提取函数</span></span>
<span id="cb113-2"><a href="#cb113-2" tabindex="-1"></a>rsq <span class="ot">&lt;-</span> <span class="cf">function</span>(mod) <span class="fu">summary</span>(mod)<span class="sc">$</span>r.squared</span>
<span id="cb113-3"><a href="#cb113-3" tabindex="-1"></a></span>
<span id="cb113-4"><a href="#cb113-4" tabindex="-1"></a><span class="co"># 提取 for 循环中模型的 R^2</span></span>
<span id="cb113-5"><a href="#cb113-5" tabindex="-1"></a>rsq_for <span class="ot">&lt;-</span> <span class="fu">sapply</span>(models_for, rsq)</span>
<span id="cb113-6"><a href="#cb113-6" tabindex="-1"></a>rsq_for_bootstrap <span class="ot">&lt;-</span> <span class="fu">sapply</span>(bootstrap_models_for, rsq)</span>
<span id="cb113-7"><a href="#cb113-7" tabindex="-1"></a></span>
<span id="cb113-8"><a href="#cb113-8" tabindex="-1"></a><span class="co"># 提取 lapply() 中模型的 R^2</span></span>
<span id="cb113-9"><a href="#cb113-9" tabindex="-1"></a>rsq_lapply <span class="ot">&lt;-</span> <span class="fu">sapply</span>(models_lapply, rsq)</span>
<span id="cb113-10"><a href="#cb113-10" tabindex="-1"></a>rsq_lapply_bootstrap <span class="ot">&lt;-</span> <span class="fu">sapply</span>(bootstrap_models_lapply, rsq)</span>
<span id="cb113-11"><a href="#cb113-11" tabindex="-1"></a></span>
<span id="cb113-12"><a href="#cb113-12" tabindex="-1"></a><span class="co"># 查看结果</span></span>
<span id="cb113-13"><a href="#cb113-13" tabindex="-1"></a>rsq_for</span></code></pre></div>
<pre><code>## [1] 0.7183433 0.8596865 0.7809306 0.8838038</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" tabindex="-1"></a>rsq_for_bootstrap</span></code></pre></div>
<pre><code>##  [1] 0.7752766 0.7015322 0.7007053 0.7369189 0.7505659 0.8380117 0.7274341
##  [8] 0.6195316 0.6468874 0.6376037</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" tabindex="-1"></a>rsq_lapply</span></code></pre></div>
<pre><code>## [1] 0.7183433 0.8596865 0.7809306 0.8838038</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" tabindex="-1"></a>rsq_lapply_bootstrap</span></code></pre></div>
<pre><code>##  [1] 0.7752766 0.7015322 0.7007053 0.7369189 0.7505659 0.8380117 0.7274341
##  [8] 0.6195316 0.6468874 0.6376037</code></pre>
<p>结果分析：</p>
<p>for循环与lapply()得到了相同的结果，但总体来说，使用lapply()能减少内存的使用，并使代码更简洁清晰。</p>
</div>
<div id="question-3-7" class="section level2">
<h2>Question 3</h2>
<ol start="3" style="list-style-type: decimal">
<li>The following code simulates the performance of a t-test for
non-normal data. Use sapply() and an anonymous function to extract the
p-value from every trial.</li>
</ol>
<p>trials &lt;- replicate( 100, t.test(rpois(10, 10), rpois(7, 10)),
simplify = FALSE )</p>
<ol start="6" style="list-style-type: decimal">
<li>Implement a combination of Map() and vapply() to create an lapply()
variant that iterates in parallel over all of its inputs and stores its
outputs in a vector (or a matrix). What arguments should the function
take?</li>
</ol>
</div>
<div id="answer-25" class="section level2">
<h2>Answer</h2>
<ol start="3" style="list-style-type: decimal">
<li>使用中 sapply() 和匿名函数提取每次试验的 p
值，并对提取的p值可视化。</li>
</ol>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># 清理缓存</span></span>
<span id="cb121-2"><a href="#cb121-2" tabindex="-1"></a><span class="co"># 模拟数据</span></span>
<span id="cb121-3"><a href="#cb121-3" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="fu">replicate</span>(</span>
<span id="cb121-4"><a href="#cb121-4" tabindex="-1"></a>  <span class="dv">100</span>, </span>
<span id="cb121-5"><a href="#cb121-5" tabindex="-1"></a>  <span class="fu">t.test</span>(<span class="fu">rpois</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="fu">rpois</span>(<span class="dv">7</span>, <span class="dv">10</span>)), </span>
<span id="cb121-6"><a href="#cb121-6" tabindex="-1"></a>  <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb121-7"><a href="#cb121-7" tabindex="-1"></a>)</span>
<span id="cb121-8"><a href="#cb121-8" tabindex="-1"></a></span>
<span id="cb121-9"><a href="#cb121-9" tabindex="-1"></a><span class="co"># 使用 sapply() 和匿名函数提取 p 值</span></span>
<span id="cb121-10"><a href="#cb121-10" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(trials, <span class="cf">function</span>(test) test<span class="sc">$</span>p.value)</span>
<span id="cb121-11"><a href="#cb121-11" tabindex="-1"></a></span>
<span id="cb121-12"><a href="#cb121-12" tabindex="-1"></a><span class="co"># 查看结果</span></span>
<span id="cb121-13"><a href="#cb121-13" tabindex="-1"></a>p_values</span></code></pre></div>
<pre><code>##   [1] 0.467948775 0.616526328 0.518824931 0.216111945 0.516725823 0.110632293
##   [7] 0.151041451 0.975556000 0.652972890 0.560291972 0.389067690 0.139455063
##  [13] 0.154889462 0.666677905 0.314295640 0.386475142 0.732188028 0.899059830
##  [19] 0.400342442 0.211813576 0.126554302 0.734072607 0.372516395 0.758383737
##  [25] 0.894606354 0.786102245 0.395417828 0.705332428 0.476841647 0.424505951
##  [31] 0.462699357 0.041379404 0.935706478 0.281034275 0.741782786 0.215408287
##  [37] 0.912870499 0.418138397 0.622740955 0.361132201 0.610680817 0.084276976
##  [43] 0.060233931 0.276964680 0.154853290 0.719288150 0.428581525 0.140505714
##  [49] 0.610766041 0.470915665 0.726661182 0.914502669 0.040754344 0.351725517
##  [55] 0.454925832 0.388902300 0.963932425 0.568374352 0.678338620 0.504387389
##  [61] 0.954459928 0.447554174 0.187153969 0.977221079 0.896124616 0.581159392
##  [67] 0.395337135 0.401755679 0.525189922 0.260343628 0.653171281 0.838498497
##  [73] 0.745202289 0.309526928 0.233912286 0.213751345 0.109408771 0.892547265
##  [79] 0.231590558 0.452297314 0.773179927 0.942408177 0.321515623 0.571209869
##  [85] 0.923409231 0.220408345 0.006523058 0.036237785 0.405659799 0.728172959
##  [91] 0.598782800 0.572148297 0.560927617 0.717504596 0.818230597 0.205145629
##  [97] 0.015699982 0.229720880 0.154728560 0.530439876</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" tabindex="-1"></a><span class="fu">hist</span>(p_values, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">&quot;P-value Distribution&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;P-value&quot;</span>, <span class="at">col =</span> <span class="st">&quot;skyblue&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<ol start="6" style="list-style-type: decimal">
<li>Map() 和 vapply() 可以结合使用，创建一个类似于 lapply()
的函数，并使用。</li>
</ol>
<p>思路：</p>
<p>Map()：将多个输入列表逐元素并行传递给目标函数
FUN，并返回一个列表。</p>
<p>vapply()：对 Map() 的输出列表进行转换，并强制结果符合指定的 FUN.VALUE
类型。</p>
<p>identity：用于在 vapply() 中直接返回列表中的元素。</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" tabindex="-1"></a><span class="co"># 自定义函数：结合 Map() 和 vapply()</span></span>
<span id="cb124-2"><a href="#cb124-2" tabindex="-1"></a>parallel_lapply <span class="ot">&lt;-</span> <span class="cf">function</span>(FUN, ..., FUN.VALUE) {</span>
<span id="cb124-3"><a href="#cb124-3" tabindex="-1"></a>  <span class="co"># 使用 Map() 并行迭代所有输入</span></span>
<span id="cb124-4"><a href="#cb124-4" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">Map</span>(FUN, ...)</span>
<span id="cb124-5"><a href="#cb124-5" tabindex="-1"></a>  <span class="co"># 使用 vapply() 将结果强制转换为指定类型（向量或矩阵）</span></span>
<span id="cb124-6"><a href="#cb124-6" tabindex="-1"></a>  <span class="fu">vapply</span>(results, identity, FUN.VALUE)</span>
<span id="cb124-7"><a href="#cb124-7" tabindex="-1"></a>}</span>
<span id="cb124-8"><a href="#cb124-8" tabindex="-1"></a></span>
<span id="cb124-9"><a href="#cb124-9" tabindex="-1"></a><span class="co"># 示例 1：并行迭代两个列表并计算它们的和</span></span>
<span id="cb124-10"><a href="#cb124-10" tabindex="-1"></a>list1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb124-11"><a href="#cb124-11" tabindex="-1"></a>list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb124-12"><a href="#cb124-12" tabindex="-1"></a></span>
<span id="cb124-13"><a href="#cb124-13" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">parallel_lapply</span>(</span>
<span id="cb124-14"><a href="#cb124-14" tabindex="-1"></a>  <span class="at">FUN =</span> <span class="cf">function</span>(x, y) x <span class="sc">+</span> y,  <span class="co"># 目标函数</span></span>
<span id="cb124-15"><a href="#cb124-15" tabindex="-1"></a>  list1, list2,               <span class="co"># 多个输入</span></span>
<span id="cb124-16"><a href="#cb124-16" tabindex="-1"></a>  <span class="at">FUN.VALUE =</span> <span class="fu">numeric</span>(<span class="dv">1</span>)      <span class="co"># 输出为数值向量</span></span>
<span id="cb124-17"><a href="#cb124-17" tabindex="-1"></a>)</span>
<span id="cb124-18"><a href="#cb124-18" tabindex="-1"></a><span class="fu">print</span>(result)</span></code></pre></div>
<pre><code>## [1] 5 7 9</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" tabindex="-1"></a><span class="co"># 示例 2：生成矩阵输出</span></span>
<span id="cb126-2"><a href="#cb126-2" tabindex="-1"></a>list3 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb126-3"><a href="#cb126-3" tabindex="-1"></a></span>
<span id="cb126-4"><a href="#cb126-4" tabindex="-1"></a>result_matrix <span class="ot">&lt;-</span> <span class="fu">parallel_lapply</span>(</span>
<span id="cb126-5"><a href="#cb126-5" tabindex="-1"></a>  <span class="at">FUN =</span> <span class="cf">function</span>(x, y, z) <span class="fu">c</span>(x, y, z),  <span class="co"># 目标函数，返回向量</span></span>
<span id="cb126-6"><a href="#cb126-6" tabindex="-1"></a>  list1, list2, list3,                <span class="co"># 多个输入</span></span>
<span id="cb126-7"><a href="#cb126-7" tabindex="-1"></a>  <span class="at">FUN.VALUE =</span> <span class="fu">numeric</span>(<span class="dv">3</span>)              <span class="co"># 输出为矩阵</span></span>
<span id="cb126-8"><a href="#cb126-8" tabindex="-1"></a>)</span>
<span id="cb126-9"><a href="#cb126-9" tabindex="-1"></a><span class="fu">print</span>(result_matrix)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    4    5    6
## [3,]    7    8    9</code></pre>
<p>参数： FUN：目标函数，定义对输入如何处理。</p>
<p>…：多个输入列表，这些列表将在 Map() 中并行迭代。</p>
<p>FUN.VALUE：定义目标函数输出的模板，用于 vapply()
检查和强制结果的格式。它决定了输出是向量还是矩阵：</p>
<p>numeric(1)：结果为数值向量。</p>
<p>numeric(n)：结果为矩阵，n 是每个结果的长度。</p>
</div>
<div id="question-4-2" class="section level2">
<h2>Question 4</h2>
<ol start="4" style="list-style-type: decimal">
<li><p>Make a faster version of chisq.test() that only computes the
chi-square test statistic when the input is two numeric vectors with no
missing values. You can try simplifying chisq.test() or by coding from
the mathematical definition (<a href="http://en" class="uri">http://en</a>.
wikipedia.org/wiki/Pearson%27s_chi-squared_test).</p></li>
<li><p>Can you make a faster version of table() for the case of an input
of two integer vectors with no missing values? Can you use it to speed
up your chi-square test?</p></li>
</ol>
</div>
<div id="answer-26" class="section level2">
<h2>Answer</h2>
<ol start="4" style="list-style-type: decimal">
<li></li>
</ol>
<p>对于两个数值向量x和y,
我们可以直接根据其频数分布计算卡方检验统计量的观察值和期望值。</p>
<p>函数思路：</p>
<ol style="list-style-type: decimal">
<li>输入检查：</li>
</ol>
<p>确保输入是两个数值向量。</p>
<p>确保输入中没有缺失值。</p>
<ol start="2" style="list-style-type: decimal">
<li>计算步骤：</li>
</ol>
<p>使用 table() 计算二维列联表作为观察值。</p>
<p>根据行和列的总和计算期望值。</p>
<p>根据公式计算卡方统计量。</p>
<ol start="3" style="list-style-type: decimal">
<li>输出：</li>
</ol>
<p>返回卡方检验统计量。</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># 清理缓存</span></span>
<span id="cb128-2"><a href="#cb128-2" tabindex="-1"></a><span class="co"># 更快的卡方检验函数</span></span>
<span id="cb128-3"><a href="#cb128-3" tabindex="-1"></a>fast_chisq <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb128-4"><a href="#cb128-4" tabindex="-1"></a>  <span class="co"># 确保输入为数值向量，且无缺失值</span></span>
<span id="cb128-5"><a href="#cb128-5" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(x), <span class="fu">is.numeric</span>(y), <span class="sc">!</span><span class="fu">anyNA</span>(x), <span class="sc">!</span><span class="fu">anyNA</span>(y))</span>
<span id="cb128-6"><a href="#cb128-6" tabindex="-1"></a>  </span>
<span id="cb128-7"><a href="#cb128-7" tabindex="-1"></a>  <span class="co"># 构建二维列联表</span></span>
<span id="cb128-8"><a href="#cb128-8" tabindex="-1"></a>  observed <span class="ot">&lt;-</span> <span class="fu">table</span>(x, y)</span>
<span id="cb128-9"><a href="#cb128-9" tabindex="-1"></a>  </span>
<span id="cb128-10"><a href="#cb128-10" tabindex="-1"></a>  <span class="co"># 计算期望值</span></span>
<span id="cb128-11"><a href="#cb128-11" tabindex="-1"></a>  row_totals <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(observed)</span>
<span id="cb128-12"><a href="#cb128-12" tabindex="-1"></a>  col_totals <span class="ot">&lt;-</span> <span class="fu">colSums</span>(observed)</span>
<span id="cb128-13"><a href="#cb128-13" tabindex="-1"></a>  grand_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(observed)</span>
<span id="cb128-14"><a href="#cb128-14" tabindex="-1"></a>  expected <span class="ot">&lt;-</span> <span class="fu">outer</span>(row_totals, col_totals) <span class="sc">/</span> grand_total</span>
<span id="cb128-15"><a href="#cb128-15" tabindex="-1"></a>  </span>
<span id="cb128-16"><a href="#cb128-16" tabindex="-1"></a>  <span class="co"># 计算卡方检验统计量</span></span>
<span id="cb128-17"><a href="#cb128-17" tabindex="-1"></a>  chisq_stat <span class="ot">&lt;-</span> <span class="fu">sum</span>((observed <span class="sc">-</span> expected)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> expected)</span>
<span id="cb128-18"><a href="#cb128-18" tabindex="-1"></a>  </span>
<span id="cb128-19"><a href="#cb128-19" tabindex="-1"></a>  <span class="fu">return</span>(chisq_stat)</span>
<span id="cb128-20"><a href="#cb128-20" tabindex="-1"></a>}</span>
<span id="cb128-21"><a href="#cb128-21" tabindex="-1"></a></span>
<span id="cb128-22"><a href="#cb128-22" tabindex="-1"></a><span class="co"># 示例数据</span></span>
<span id="cb128-23"><a href="#cb128-23" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb128-24"><a href="#cb128-24" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb128-25"><a href="#cb128-25" tabindex="-1"></a></span>
<span id="cb128-26"><a href="#cb128-26" tabindex="-1"></a><span class="co"># 调用函数</span></span>
<span id="cb128-27"><a href="#cb128-27" tabindex="-1"></a><span class="fu">fast_chisq</span>(x, y)</span></code></pre></div>
<pre><code>## [1] 4.833333</code></pre>
<p>结果与使用chisq.test() 得到的相同。</p>
<ol start="5" style="list-style-type: decimal">
<li>我们可以通过实现一个针对两个整数向量优化的 table()
函数来加速生成列联表。</li>
</ol>
<p>思路：</p>
<ol style="list-style-type: decimal">
<li><p>针对整数向量，可以避免了标准 table()
中的类型转换和其他检查步骤。</p></li>
<li><p>利用 match() 定位值在唯一值中的位置，填充矩阵。</p></li>
</ol>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" tabindex="-1"></a><span class="co"># 自定义快速 table() 函数</span></span>
<span id="cb130-2"><a href="#cb130-2" tabindex="-1"></a>fast_table <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb130-3"><a href="#cb130-3" tabindex="-1"></a>  <span class="co"># 确保输入为整数向量，且无缺失值</span></span>
<span id="cb130-4"><a href="#cb130-4" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(x), <span class="fu">is.integer</span>(y), <span class="sc">!</span><span class="fu">anyNA</span>(x), <span class="sc">!</span><span class="fu">anyNA</span>(y))</span>
<span id="cb130-5"><a href="#cb130-5" tabindex="-1"></a>  </span>
<span id="cb130-6"><a href="#cb130-6" tabindex="-1"></a>  <span class="co"># 确定唯一值及其范围</span></span>
<span id="cb130-7"><a href="#cb130-7" tabindex="-1"></a>  x_levels <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(x))</span>
<span id="cb130-8"><a href="#cb130-8" tabindex="-1"></a>  y_levels <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(y))</span>
<span id="cb130-9"><a href="#cb130-9" tabindex="-1"></a>  </span>
<span id="cb130-10"><a href="#cb130-10" tabindex="-1"></a>  <span class="co"># 创建结果矩阵</span></span>
<span id="cb130-11"><a href="#cb130-11" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span><span class="dt">L</span>, <span class="at">nrow =</span> <span class="fu">length</span>(x_levels), <span class="at">ncol =</span> <span class="fu">length</span>(y_levels))</span>
<span id="cb130-12"><a href="#cb130-12" tabindex="-1"></a>  <span class="fu">rownames</span>(result) <span class="ot">&lt;-</span> x_levels</span>
<span id="cb130-13"><a href="#cb130-13" tabindex="-1"></a>  <span class="fu">colnames</span>(result) <span class="ot">&lt;-</span> y_levels</span>
<span id="cb130-14"><a href="#cb130-14" tabindex="-1"></a>  </span>
<span id="cb130-15"><a href="#cb130-15" tabindex="-1"></a>  <span class="co"># 填充计数</span></span>
<span id="cb130-16"><a href="#cb130-16" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(x)) {</span>
<span id="cb130-17"><a href="#cb130-17" tabindex="-1"></a>    result[<span class="fu">match</span>(x[i], x_levels), <span class="fu">match</span>(y[i], y_levels)] <span class="ot">&lt;-</span> </span>
<span id="cb130-18"><a href="#cb130-18" tabindex="-1"></a>      result[<span class="fu">match</span>(x[i], x_levels), <span class="fu">match</span>(y[i], y_levels)] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb130-19"><a href="#cb130-19" tabindex="-1"></a>  }</span>
<span id="cb130-20"><a href="#cb130-20" tabindex="-1"></a>  </span>
<span id="cb130-21"><a href="#cb130-21" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb130-22"><a href="#cb130-22" tabindex="-1"></a>}</span>
<span id="cb130-23"><a href="#cb130-23" tabindex="-1"></a></span>
<span id="cb130-24"><a href="#cb130-24" tabindex="-1"></a><span class="co"># 引入到卡方检验</span></span>
<span id="cb130-25"><a href="#cb130-25" tabindex="-1"></a>fast_chisq_optimized <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb130-26"><a href="#cb130-26" tabindex="-1"></a>  <span class="co"># 确保输入为整数向量</span></span>
<span id="cb130-27"><a href="#cb130-27" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(x), <span class="fu">is.integer</span>(y), <span class="sc">!</span><span class="fu">anyNA</span>(x), <span class="sc">!</span><span class="fu">anyNA</span>(y))</span>
<span id="cb130-28"><a href="#cb130-28" tabindex="-1"></a>  </span>
<span id="cb130-29"><a href="#cb130-29" tabindex="-1"></a>  <span class="co"># 使用快速 table 生成列联表</span></span>
<span id="cb130-30"><a href="#cb130-30" tabindex="-1"></a>  observed <span class="ot">&lt;-</span> <span class="fu">fast_table</span>(x, y)</span>
<span id="cb130-31"><a href="#cb130-31" tabindex="-1"></a>  </span>
<span id="cb130-32"><a href="#cb130-32" tabindex="-1"></a>  <span class="co"># 计算期望值</span></span>
<span id="cb130-33"><a href="#cb130-33" tabindex="-1"></a>  row_totals <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(observed)</span>
<span id="cb130-34"><a href="#cb130-34" tabindex="-1"></a>  col_totals <span class="ot">&lt;-</span> <span class="fu">colSums</span>(observed)</span>
<span id="cb130-35"><a href="#cb130-35" tabindex="-1"></a>  grand_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(observed)</span>
<span id="cb130-36"><a href="#cb130-36" tabindex="-1"></a>  expected <span class="ot">&lt;-</span> <span class="fu">outer</span>(row_totals, col_totals) <span class="sc">/</span> grand_total</span>
<span id="cb130-37"><a href="#cb130-37" tabindex="-1"></a>  </span>
<span id="cb130-38"><a href="#cb130-38" tabindex="-1"></a>  <span class="co"># 计算卡方检验统计量</span></span>
<span id="cb130-39"><a href="#cb130-39" tabindex="-1"></a>  chisq_stat <span class="ot">&lt;-</span> <span class="fu">sum</span>((observed <span class="sc">-</span> expected)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> expected)</span>
<span id="cb130-40"><a href="#cb130-40" tabindex="-1"></a>  </span>
<span id="cb130-41"><a href="#cb130-41" tabindex="-1"></a>  <span class="fu">return</span>(chisq_stat)</span>
<span id="cb130-42"><a href="#cb130-42" tabindex="-1"></a>}</span>
<span id="cb130-43"><a href="#cb130-43" tabindex="-1"></a></span>
<span id="cb130-44"><a href="#cb130-44" tabindex="-1"></a><span class="co"># 示例数据（整数向量）</span></span>
<span id="cb130-45"><a href="#cb130-45" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb130-46"><a href="#cb130-46" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb130-47"><a href="#cb130-47" tabindex="-1"></a></span>
<span id="cb130-48"><a href="#cb130-48" tabindex="-1"></a><span class="co"># 调用优化后的卡方检验函数</span></span>
<span id="cb130-49"><a href="#cb130-49" tabindex="-1"></a><span class="fu">fast_chisq_optimized</span>(x, y)</span></code></pre></div>
<pre><code>## [1] 4.833333</code></pre>
<p>结果分析：得到的结果与前面相同。</p>
</div>
</div>
<div id="a-sc24002027-2024-11-18" class="section level1">
<h1>A-SC24002027-2024-11-18</h1>
<div id="question-1-8" class="section level2">
<h2>Question 1</h2>
<p>9.8</p>
<p>This example appears in [40]. Consider the bivariate density <span class="math display">\[
f(x, y) \propto \binom{n}{x} y^{x+a-1}(1-y)^{n-x+b-1}, \quad
x=0,1,\ldots, n, \quad 0 \leq y \leq 1.
\]</span> It can be shown (see e.g. [23]) that for fixed a, b, n, the
conditional distributions are Binomial(n, y) and Beta(x + a, n − x + b).
Use the Gibbs sampler to generate a chain with target joint density f
(x, y).</p>
<ol style="list-style-type: decimal">
<li><p>Write an Rcpp function for Exercise 9.8 (page 278, Statistical
Computing with R)</p></li>
<li><p>Compare the corresponding generated random numbers with those by
the R function you wrote using the function “qqplot”.</p></li>
<li><p>Campare the computation time of the two functions with the
function “microbenchmark”.</p></li>
<li><p>Comments your results.</p></li>
</ol>
</div>
<div id="answer-27" class="section level2">
<h2>Answer</h2>
<p>思路:</p>
<p>Gibbs 采样器</p>
<ol style="list-style-type: decimal">
<li><p>设置起始值</p></li>
<li><p>重复 for i=2,…,N</p>
<ol style="list-style-type: lower-alpha">
<li><p>从x条件概率分布中生成<span class="math inline">\(x^* (t) =
f_x(\cdot \mid x_{2})\)</span>, 从y条件概率分布中生成<span class="math inline">\(y^* (t) = f(\cdot \mid x^* (t))\)</span></p></li>
<li><p>x=(x^* (t), y^* (t))</p></li>
<li><p>除去烧入</p></li>
</ol></li>
</ol>
<p>分别用cpp和r语言编写函数，再用qq图对比结果，再比较消耗时间。</p>
<p>1.分别用cpp和r语言编写函数</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># 清理内存</span></span>
<span id="cb132-2"><a href="#cb132-2" tabindex="-1"></a></span>
<span id="cb132-3"><a href="#cb132-3" tabindex="-1"></a><span class="co"># r语言Gibbs 采样器</span></span>
<span id="cb132-4"><a href="#cb132-4" tabindex="-1"></a>gibbs_r <span class="ot">&lt;-</span> <span class="cf">function</span>(n_iter, n, a, b, burn) {</span>
<span id="cb132-5"><a href="#cb132-5" tabindex="-1"></a>  chain <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n_iter, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="co"># 存储最终保留的样本</span></span>
<span id="cb132-6"><a href="#cb132-6" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># 初始化 x</span></span>
<span id="cb132-7"><a href="#cb132-7" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fl">0.5</span>  <span class="co"># 初始化 y</span></span>
<span id="cb132-8"><a href="#cb132-8" tabindex="-1"></a>  </span>
<span id="cb132-9"><a href="#cb132-9" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n_iter <span class="sc">+</span> burn)) {</span>
<span id="cb132-10"><a href="#cb132-10" tabindex="-1"></a>    <span class="co"># 从条件分布 x | y (二项分布) 采样</span></span>
<span id="cb132-11"><a href="#cb132-11" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, y)</span>
<span id="cb132-12"><a href="#cb132-12" tabindex="-1"></a>    </span>
<span id="cb132-13"><a href="#cb132-13" tabindex="-1"></a>    <span class="co"># 从条件分布 y | x (Beta 分布) 采样</span></span>
<span id="cb132-14"><a href="#cb132-14" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, x <span class="sc">+</span> a, n <span class="sc">-</span> x <span class="sc">+</span> b)</span>
<span id="cb132-15"><a href="#cb132-15" tabindex="-1"></a>    </span>
<span id="cb132-16"><a href="#cb132-16" tabindex="-1"></a>    <span class="co"># 如果超出 burn-in 阶段，则存储样本</span></span>
<span id="cb132-17"><a href="#cb132-17" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">&gt;</span> burn) {</span>
<span id="cb132-18"><a href="#cb132-18" tabindex="-1"></a>      chain[i <span class="sc">-</span> burn, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)</span>
<span id="cb132-19"><a href="#cb132-19" tabindex="-1"></a>    }</span>
<span id="cb132-20"><a href="#cb132-20" tabindex="-1"></a>  }</span>
<span id="cb132-21"><a href="#cb132-21" tabindex="-1"></a>  <span class="fu">return</span>(chain) <span class="co"># 返回最终样本链</span></span>
<span id="cb132-22"><a href="#cb132-22" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" tabindex="-1"></a><span class="fu">library</span>(Rcpp)</span>
<span id="cb133-2"><a href="#cb133-2" tabindex="-1"></a><span class="fu">cppFunction</span>(<span class="st">&#39;NumericMatrix gibbs_cpp(int n_iter, int n, double a, double b, int burn) {</span></span>
<span id="cb133-3"><a href="#cb133-3" tabindex="-1"></a><span class="st">  NumericMatrix chain(n_iter, 2); // 存储最终保留的 (x, y) 样本</span></span>
<span id="cb133-4"><a href="#cb133-4" tabindex="-1"></a><span class="st">  double x = 0;                  // 初始化 x</span></span>
<span id="cb133-5"><a href="#cb133-5" tabindex="-1"></a><span class="st">  double y = 0.5;                // 初始化 y</span></span>
<span id="cb133-6"><a href="#cb133-6" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb133-7"><a href="#cb133-7" tabindex="-1"></a><span class="st">  for (int i = 0; i &lt; n_iter + burn; i++) {</span></span>
<span id="cb133-8"><a href="#cb133-8" tabindex="-1"></a><span class="st">    // 从条件分布 x | y (二项分布) 采样</span></span>
<span id="cb133-9"><a href="#cb133-9" tabindex="-1"></a><span class="st">    x = R::rbinom(n, y);</span></span>
<span id="cb133-10"><a href="#cb133-10" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb133-11"><a href="#cb133-11" tabindex="-1"></a><span class="st">    // 从条件分布 y | x (Beta 分布) 采样</span></span>
<span id="cb133-12"><a href="#cb133-12" tabindex="-1"></a><span class="st">    y = R::rbeta(x + a, n - x + b);</span></span>
<span id="cb133-13"><a href="#cb133-13" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb133-14"><a href="#cb133-14" tabindex="-1"></a><span class="st">    // 如果超出 burn-in 阶段，则存储样本</span></span>
<span id="cb133-15"><a href="#cb133-15" tabindex="-1"></a><span class="st">    if (i &gt;= burn) {</span></span>
<span id="cb133-16"><a href="#cb133-16" tabindex="-1"></a><span class="st">      chain(i - burn, 0) = x; // 存储 x</span></span>
<span id="cb133-17"><a href="#cb133-17" tabindex="-1"></a><span class="st">      chain(i - burn, 1) = y; // 存储 y</span></span>
<span id="cb133-18"><a href="#cb133-18" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb133-19"><a href="#cb133-19" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb133-20"><a href="#cb133-20" tabindex="-1"></a><span class="st">  return chain; // 返回最终样本链</span></span>
<span id="cb133-21"><a href="#cb133-21" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb133-22"><a href="#cb133-22" tabindex="-1"></a><span class="st">&#39;</span>)</span></code></pre></div>
<p>2.计算并比较结果</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24002027</span>)</span>
<span id="cb134-2"><a href="#cb134-2" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" tabindex="-1"></a></span>
<span id="cb134-4"><a href="#cb134-4" tabindex="-1"></a><span class="co"># 设置参数</span></span>
<span id="cb134-5"><a href="#cb134-5" tabindex="-1"></a>n_iter <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb134-6"><a href="#cb134-6" tabindex="-1"></a>burn <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb134-7"><a href="#cb134-7" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb134-8"><a href="#cb134-8" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb134-9"><a href="#cb134-9" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb134-10"><a href="#cb134-10" tabindex="-1"></a></span>
<span id="cb134-11"><a href="#cb134-11" tabindex="-1"></a><span class="co"># 生成数据</span></span>
<span id="cb134-12"><a href="#cb134-12" tabindex="-1"></a>chain_r <span class="ot">&lt;-</span> <span class="fu">gibbs_r</span>(n_iter, n, a, b, burn)</span>
<span id="cb134-13"><a href="#cb134-13" tabindex="-1"></a>chain_cpp <span class="ot">&lt;-</span> <span class="fu">gibbs_cpp</span>(n_iter, n, a, b, burn)</span>
<span id="cb134-14"><a href="#cb134-14" tabindex="-1"></a></span>
<span id="cb134-15"><a href="#cb134-15" tabindex="-1"></a><span class="co"># 对比x</span></span>
<span id="cb134-16"><a href="#cb134-16" tabindex="-1"></a><span class="fu">qqplot</span>(chain_r[, <span class="dv">1</span>], chain_cpp[, <span class="dv">1</span>], <span class="at">main =</span> <span class="st">&quot;QQ Plot for x&quot;</span>,</span>
<span id="cb134-17"><a href="#cb134-17" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;R samples&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Rcpp samples&quot;</span>)</span>
<span id="cb134-18"><a href="#cb134-18" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" tabindex="-1"></a><span class="co"># 对比y</span></span>
<span id="cb135-2"><a href="#cb135-2" tabindex="-1"></a><span class="fu">qqplot</span>(chain_r[, <span class="dv">2</span>], chain_cpp[, <span class="dv">2</span>], <span class="at">main =</span> <span class="st">&quot;QQ Plot for y&quot;</span>,</span>
<span id="cb135-3"><a href="#cb135-3" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;R samples&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Rcpp samples&quot;</span>)</span>
<span id="cb135-4"><a href="#cb135-4" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>3.比较时间</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb136-2"><a href="#cb136-2" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(</span>
<span id="cb136-4"><a href="#cb136-4" tabindex="-1"></a>  <span class="at">R =</span> <span class="fu">gibbs_r</span>(n_iter, n, a, b, burn),</span>
<span id="cb136-5"><a href="#cb136-5" tabindex="-1"></a>  <span class="at">Rcpp =</span> <span class="fu">gibbs_cpp</span>(n_iter, n, a, b, burn),</span>
<span id="cb136-6"><a href="#cb136-6" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">10</span></span>
<span id="cb136-7"><a href="#cb136-7" tabindex="-1"></a>)</span>
<span id="cb136-8"><a href="#cb136-8" tabindex="-1"></a></span>
<span id="cb136-9"><a href="#cb136-9" tabindex="-1"></a><span class="fu">print</span>(time)</span></code></pre></div>
<pre><code>## Unit: milliseconds
##  expr     min      lq     mean  median      uq     max neval
##     R 27.1166 27.3688 29.11744 27.7064 29.8797 34.4568    10
##  Rcpp  2.4120  2.4182  2.54025  2.4255  2.4391  3.5656    10</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>结果分析</li>
</ol>
<p>随机数生成：通过 QQ 图，我们可以看出它们的随机数高度一致,
符合预期。</p>
<p>计算性能：microbenchmark 的结果表明 Rcpp 的实现速度通常显著优于 R
的实现，说明C++语言在随机数生成和循环方面的优化较好。</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
